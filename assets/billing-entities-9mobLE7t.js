import{r as u,j as e,B as y,d as _,e as L,t as M,a as se}from"./index-LjicKyT0.js";import{H as ne,S as ie,a as le,T as ae,P as re,M as oe}from"./theme-switch-cMSK6cqB.js";import{B as E}from"./badge-4kjocfwo.js";import{C as k}from"./checkbox-w55iTThu.js";import{D as f}from"./data-table-column-header-NxjSLUJQ.js";import{L as D}from"./long-text-BEJQdRNd.js";import{D as ce,e as de,f as me,i as S,h as xe}from"./avatar-ZyuV-nlZ.js";import{E as he,P as ue}from"./pencil-CMl5EI2J.js";import{E as pe}from"./eye-D5U1iGxZ.js";import{T as je}from"./trash-2-BnkWnZhX.js";import{u as q,a as z,F as H,b as o,c,d,e as m,f as x}from"./form-Bf5yBnbc.js";import{D as A,a as I,b as B,c as T,d as P,e as V}from"./command-X9JjFxyP.js";import{I as v}from"./input-Dlu4Ie9G.js";import{S as K,a as R,b as U,c as $,d as C}from"./select-w6OWzPxW.js";import{T as Q}from"./textarea-1eidY_GF.js";import{u as ge,A as Z,a as ye,b as fe,c as ve,d as be}from"./use-billing-entities-ByZUxDCE.js";import{C as G}from"./company-select-YLwP_2QB.js";import{o as J,s as p,e as Ne}from"./types-Wky072k2.js";import{C as Ee}from"./confirm-dialog-BIN9Mtx0.js";import{S as F}from"./separator-CLg1W5b9.js";import{P as Ce}from"./plus-D8USiGGy.js";import{u as we,D as De}from"./use-data-table-Bb2GNchX.js";import"./createReactComponent-Dm51iCRd.js";import"./index-CVPNRdpP.js";import"./index-BvwaI8vX.js";import"./index-DgBTolnX.js";import"./index-BWm_iZMh.js";import"./check-D7e09AXV.js";import"./react-icons.esm-_L3V94na.js";import"./popover-Bpz0jySH.js";import"./index-BqMrZ-WO.js";import"./index-BK3YptDx.js";import"./index-CJhIcW8r.js";import"./index-DbJ88n5W.js";import"./index-DVkuEz9K.js";import"./map-pin-Drz5NG2-.js";import"./alert-dialog-DavZlUbV.js";import"./table-zh_l_sMN.js";const W=u.createContext(void 0);function N(){const t=u.useContext(W);if(!t)throw new Error("useBillingEntitiesContext must be used within BillingEntitiesProvider");return t}function Se({row:t}){const n=t.original,{setViewingEntity:s,setIsViewDialogOpen:l,setEditingEntity:r,setIsEditDialogOpen:i,setDeletingEntity:g,setIsDeleteDialogOpen:j}=N(),a=()=>{s(n),l(!0)},h=()=>{r(n),i(!0)},b=()=>{g(n),j(!0)};return e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsxs(y,{variant:"ghost",className:"data-[state=open]:bg-muted h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(he,{className:"h-4 w-4"})]})}),e.jsxs(me,{align:"end",className:"w-[160px]",children:[e.jsxs(S,{onClick:a,children:[e.jsx(pe,{className:"mr-2 h-4 w-4"}),"View"]}),e.jsxs(S,{onClick:h,children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsx(xe,{}),e.jsxs(S,{onClick:b,className:"text-destructive focus:text-destructive",children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})}const Ae=[{id:"select",header:({table:t})=>e.jsx(k,{checked:t.getIsAllPageRowsSelected()||t.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:n=>t.toggleAllPageRowsSelected(!!n),"aria-label":"Select all",className:"translate-y-[2px]"}),meta:{className:_("sticky md:table-cell left-0 z-10 rounded-tl","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted")},cell:({row:t})=>e.jsx(k,{checked:t.getIsSelected(),onCheckedChange:n=>t.toggleSelected(!!n),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"entityName",header:({column:t})=>e.jsx(f,{column:t,title:"Entity Name"}),cell:({row:t})=>e.jsx(D,{className:"max-w-48 font-medium",children:t.getValue("entityName")}),meta:{className:_("drop-shadow-[0_1px_2px_rgb(0_0_0_/_0.1)] dark:drop-shadow-[0_1px_2px_rgb(255_255_255_/_0.1)] lg:drop-shadow-none","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted","sticky left-6 md:table-cell")},enableHiding:!1},{accessorKey:"entityType",header:({column:t})=>e.jsx(f,{column:t,title:"Type"}),cell:({row:t})=>{const n=t.getValue("entityType");return e.jsx(E,{variant:n==="business"?"default":"secondary",children:n==="business"?"Business":"Individual"})},filterFn:(t,n,s)=>{const l=t.getValue("entityType");return s.includes(l)}},{accessorKey:"email",header:({column:t})=>e.jsx(f,{column:t,title:"Email"}),cell:({row:t})=>{const n=t.getValue("email");return n?e.jsx("a",{href:`mailto:${n}`,className:"text-blue-600 hover:underline",children:e.jsx(D,{className:"max-w-48",children:n})}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}},{accessorKey:"phone",header:({column:t})=>e.jsx(f,{column:t,title:"Phone"}),cell:({row:t})=>{const n=t.getValue("phone");return n?e.jsx("div",{className:"text-nowrap",children:n}):e.jsx("span",{className:"text-muted-foreground",children:"-"})},enableSorting:!1},{id:"billingAddress",header:({column:t})=>e.jsx(f,{column:t,title:"Billing Address"}),cell:({row:t})=>{const{billingAddress:n}=t.original;if(!n||!n.city&&!n.state&&!n.country)return e.jsx("span",{className:"text-muted-foreground",children:"-"});const s=[n.city,n.state,n.country].filter(Boolean);return e.jsx(D,{className:"max-w-48",children:s.join(", ")})},filterFn:(t,n,s)=>{const{billingAddress:l}=t.original;if(!l)return!1;const r=s.toLowerCase();return l.city?.toLowerCase().includes(r)||l.state?.toLowerCase().includes(r)||l.country?.toLowerCase().includes(r)||!1}},{accessorKey:"taxId",header:({column:t})=>e.jsx(f,{column:t,title:"Tax ID"}),cell:({row:t})=>{const n=t.getValue("taxId");return n?e.jsx("div",{className:"text-nowrap",children:n}):e.jsx("span",{className:"text-muted-foreground",children:"-"})},enableSorting:!1},{accessorKey:"isActive",header:({column:t})=>e.jsx(f,{column:t,title:"Status"}),cell:({row:t})=>{const n=t.getValue("isActive");return e.jsx(E,{variant:n?"default":"destructive",children:n?"Active":"Inactive"})},filterFn:(t,n,s)=>{const l=t.getValue("isActive");return s.includes(l?"active":"inactive")}},{id:"actions",cell:Se}],Ie=J({street:p().min(1,"Street is required"),city:p().min(1,"City is required"),state:p().min(1,"State is required"),zipCode:p().min(1,"Zip code is required"),country:p().min(1,"Country is required")}),Be=Ne(["individual","business"],{errorMap:()=>({message:"Entity type must be either individual or business"})}),X=J({entityName:p().min(1,"Entity name is required").trim(),entityType:Be,email:p().email("Invalid email address"),phone:p().min(1,"Phone number is required"),billingAddress:Ie,taxId:p().optional(),notes:p().optional(),company:p().min(1,"Company is required")});X.partial().extend({_id:p().min(1,"ID is required")});const Y=X;function Te(){const{isCreateDialogOpen:t,setIsCreateDialogOpen:n}=N(),s=ge(),l=q({resolver:z(Y),defaultValues:{entityName:"",entityType:"individual",email:"",phone:"",billingAddress:{street:"",city:"",state:"",zipCode:"",country:""},company:"",notes:""}}),r=async i=>{if(!i.company){M.error("Please select a company");return}try{await s.mutateAsync(i),l.reset(),n(!1)}catch{}};return e.jsx(A,{open:t,onOpenChange:n,children:e.jsxs(I,{className:"sm:max-w-[625px]",children:[e.jsxs(B,{children:[e.jsx(T,{children:"Create Billing Entity"}),e.jsx(P,{children:"Add a new billing entity to your system. Fill in the entity details below."})]}),e.jsx(H,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(r),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{control:l.control,name:"entityName",render:({field:i})=>e.jsxs(c,{className:"col-span-2",children:[e.jsx(d,{children:"Entity Name *"}),e.jsx(m,{children:e.jsx(v,{placeholder:"Enter entity name",...i})}),e.jsx(x,{})]})}),e.jsx(o,{control:l.control,name:"entityType",render:({field:i})=>e.jsxs(c,{children:[e.jsx(d,{children:"Entity Type *"}),e.jsxs(K,{onValueChange:i.onChange,value:i.value,children:[e.jsx(m,{children:e.jsx(R,{children:e.jsx(U,{placeholder:"Select entity type"})})}),e.jsxs($,{children:[e.jsx(C,{value:"individual",children:"Individual"}),e.jsx(C,{value:"business",children:"Business"})]})]}),e.jsx(x,{})]})}),e.jsx(o,{control:l.control,name:"company",render:({field:i})=>e.jsxs(c,{children:[e.jsx(d,{children:"Company *"}),e.jsx(m,{children:e.jsx(G,{value:i.value,onValueChange:i.onChange,placeholder:"Select company",includeNone:!1})}),e.jsx(x,{})]})}),e.jsx(o,{control:l.control,name:"email",render:({field:i})=>e.jsxs(c,{children:[e.jsx(d,{children:"Email *"}),e.jsx(m,{children:e.jsx(v,{type:"email",placeholder:"entity@example.com",...i})}),e.jsx(x,{})]})}),e.jsx(o,{control:l.control,name:"phone",render:({field:i})=>e.jsxs(c,{children:[e.jsx(d,{children:"Phone *"}),e.jsx(m,{children:e.jsx(v,{placeholder:"+1 (555) 000-0000",...i})}),e.jsx(x,{})]})}),e.jsx(o,{control:l.control,name:"billingAddress",render:({field:i})=>e.jsxs(c,{className:"col-span-2",children:[e.jsx(d,{children:"Billing Address *"}),e.jsx(m,{children:e.jsx(Z,{value:i.value,onChange:i.onChange,placeholder:"Start typing an address..."})}),e.jsx(x,{})]})}),e.jsx(o,{control:l.control,name:"notes",render:({field:i})=>e.jsxs(c,{className:"col-span-2",children:[e.jsx(d,{children:"Notes"}),e.jsx(m,{children:e.jsx(Q,{placeholder:"Additional notes about this billing entity...",className:"resize-none",...i})}),e.jsx(x,{})]})})]}),e.jsxs(V,{children:[e.jsx(y,{type:"button",variant:"outline",onClick:()=>n(!1),children:"Cancel"}),e.jsxs(y,{type:"submit",disabled:s.isPending,children:[s.isPending&&e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Entity"]})]})]})})]})})}function Pe(){const{deletingEntity:t,isDeleteDialogOpen:n,setIsDeleteDialogOpen:s}=N(),l=ye(),r=async()=>{if(t)try{await l.mutateAsync(t._id),s(!1)}catch{}};return e.jsx(Ee,{open:n,onOpenChange:s,title:"Delete Billing Entity",desc:`Are you sure you want to delete "${t?.entityName}"? This action cannot be undone.`,confirmText:"Delete",destructive:!0,isLoading:l.isPending,handleConfirm:r})}function Ve(){const{isEditDialogOpen:t,setIsEditDialogOpen:n,editingEntity:s,setEditingEntity:l}=N(),r=fe(),i=q({resolver:z(Y),defaultValues:{entityName:"",entityType:"individual",email:"",phone:"",billingAddress:{street:"",city:"",state:"",zipCode:"",country:""},taxId:"",notes:"",company:""}});u.useEffect(()=>{s&&i.reset({entityName:s.entityName||"",entityType:s.entityType||"individual",email:s.email||"",phone:s.phone||"",billingAddress:{street:s.billingAddress?.street||"",city:s.billingAddress?.city||"",state:s.billingAddress?.state||"",zipCode:s.billingAddress?.zipCode||"",country:s.billingAddress?.country||""},taxId:s.taxId||"",notes:s.notes||"",company:s.company||""})},[s,i]);const g=async a=>{if(s){if(!a.company){M.error("Please select a company");return}try{await r.mutateAsync({_id:s._id,...a}),i.reset(),n(!1),l(null)}catch{}}},j=()=>{n(!1),l(null),i.reset()};return e.jsx(A,{open:t,onOpenChange:j,children:e.jsxs(I,{className:"sm:max-w-[625px]",children:[e.jsxs(B,{children:[e.jsx(T,{children:"Edit Billing Entity"}),e.jsx(P,{children:"Update the billing entity information. Make your changes and save."})]}),e.jsx(H,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(g),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(o,{control:i.control,name:"entityName",render:({field:a})=>e.jsxs(c,{className:"col-span-2",children:[e.jsx(d,{children:"Entity Name *"}),e.jsx(m,{children:e.jsx(v,{placeholder:"Enter entity name",...a})}),e.jsx(x,{})]})}),e.jsx(o,{control:i.control,name:"entityType",render:({field:a})=>e.jsxs(c,{children:[e.jsx(d,{children:"Entity Type *"}),e.jsxs(K,{onValueChange:a.onChange,value:a.value,children:[e.jsx(m,{children:e.jsx(R,{children:e.jsx(U,{placeholder:"Select entity type"})})}),e.jsxs($,{children:[e.jsx(C,{value:"individual",children:"Individual"}),e.jsx(C,{value:"business",children:"Business"})]})]}),e.jsx(x,{})]})}),e.jsx(o,{control:i.control,name:"company",render:({field:a})=>e.jsxs(c,{children:[e.jsx(d,{children:"Company *"}),e.jsx(m,{children:e.jsx(G,{value:a.value,onValueChange:a.onChange,placeholder:"Select company",includeNone:!1})}),e.jsx(x,{})]})}),e.jsx(o,{control:i.control,name:"taxId",render:({field:a})=>e.jsxs(c,{children:[e.jsx(d,{children:"Tax ID"}),e.jsx(m,{children:e.jsx(v,{placeholder:"Enter tax ID",...a})}),e.jsx(x,{})]})}),e.jsx(o,{control:i.control,name:"email",render:({field:a})=>e.jsxs(c,{children:[e.jsx(d,{children:"Email *"}),e.jsx(m,{children:e.jsx(v,{type:"email",placeholder:"entity@example.com",...a})}),e.jsx(x,{})]})}),e.jsx(o,{control:i.control,name:"phone",render:({field:a})=>e.jsxs(c,{children:[e.jsx(d,{children:"Phone *"}),e.jsx(m,{children:e.jsx(v,{placeholder:"+1 (555) 000-0000",...a})}),e.jsx(x,{})]})}),e.jsx(o,{control:i.control,name:"billingAddress",render:({field:a})=>e.jsxs(c,{className:"col-span-2",children:[e.jsx(d,{children:"Billing Address *"}),e.jsx(m,{children:e.jsx(Z,{value:a.value,onChange:a.onChange,placeholder:"Start typing an address..."})}),e.jsx(x,{})]})}),e.jsx(o,{control:i.control,name:"notes",render:({field:a})=>e.jsxs(c,{className:"col-span-2",children:[e.jsx(d,{children:"Notes"}),e.jsx(m,{children:e.jsx(Q,{placeholder:"Additional notes about this billing entity...",className:"resize-none",...a})}),e.jsx(x,{})]})})]}),e.jsxs(V,{children:[e.jsx(y,{type:"button",variant:"outline",onClick:j,children:"Cancel"}),e.jsxs(y,{type:"submit",disabled:r.isPending,children:[r.isPending&&e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Changes"]})]})]})})]})})}function Oe(){const{isViewDialogOpen:t,setIsViewDialogOpen:n,viewingEntity:s,setViewingEntity:l,setIsEditDialogOpen:r,setEditingEntity:i}=N();if(!s)return null;const g=()=>{i(s),r(!0),n(!1)},j=()=>{n(!1),l(null)},a=h=>h?[h.street,h.city,h.state,h.zipCode,h.country].filter(Boolean).join(", "):"No address provided";return e.jsx(A,{open:t,onOpenChange:j,children:e.jsxs(I,{className:"max-h-[90vh] overflow-y-auto sm:max-w-[625px]",children:[e.jsxs(B,{children:[e.jsx(T,{children:"Billing Entity Details"}),e.jsx(P,{children:"View detailed information about the billing entity"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Entity Name"}),e.jsx("p",{className:"mt-1 text-sm font-medium",children:s.entityName})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Entity Type"}),e.jsx(E,{className:"mt-1",variant:s.entityType==="business"?"default":"secondary",children:s.entityType==="business"?"Business":"Individual"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Email"}),e.jsx("p",{className:"mt-1 text-sm",children:e.jsx("a",{href:`mailto:${s.email}`,className:"text-blue-600 hover:underline",children:s.email})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Phone"}),e.jsx("p",{className:"mt-1 text-sm",children:s.phone})]}),s.taxId&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Tax ID"}),e.jsx("p",{className:"mt-1 text-sm",children:s.taxId})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Status"}),e.jsx(E,{className:"mt-1",variant:s.isActive?"default":"destructive",children:s.isActive?"Active":"Inactive"})]})]}),e.jsx(F,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Billing Address"}),e.jsx("p",{className:"mt-1 text-sm",children:a(s.billingAddress)})]}),s.qbCustomerId&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"QuickBooks Customer ID"}),e.jsx("p",{className:"mt-1 font-mono text-sm",children:s.qbCustomerId})]}),s.notes&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Notes"}),e.jsx("p",{className:"mt-1 text-sm whitespace-pre-wrap",children:s.notes})]}),e.jsx(F,{}),e.jsxs("div",{className:"text-muted-foreground grid grid-cols-2 gap-4 text-xs",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Created"}),e.jsx("p",{children:new Date(s.createdAt).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Last Updated"}),e.jsx("p",{children:new Date(s.updatedAt).toLocaleDateString()})]})]})]}),e.jsxs(V,{children:[e.jsx(y,{variant:"outline",onClick:j,children:"Close"}),e.jsx(y,{onClick:g,children:"Edit Entity"})]})]})})}function _e(){return e.jsxs(e.Fragment,{children:[e.jsx(Te,{}),e.jsx(Ve,{}),e.jsx(Oe,{}),e.jsx(Pe,{})]})}function ke(){const{setIsCreateDialogOpen:t}=N();return e.jsxs(y,{size:"sm",onClick:()=>t(!0),children:[e.jsx(Ce,{className:"mr-2 h-4 w-4"}),"Add Billing Entity"]})}function Fe({columns:t,data:n,isLoading:s}){const{table:l}=we({data:n,columns:t});return e.jsx(De,{table:l,columns:t,isLoading:s,searchColumn:"entityName",searchPlaceholder:"Filter billing entities..."})}function Le({children:t}){const[n,s]=u.useState(!1),[l,r]=u.useState(!1),[i,g]=u.useState(!1),[j,a]=u.useState(!1),[h,b]=u.useState(null),[w,O]=u.useState(null),[ee,te]=u.useState(null);return e.jsx(W.Provider,{value:{isCreateDialogOpen:n,setIsCreateDialogOpen:s,isEditDialogOpen:l,setIsEditDialogOpen:r,isViewDialogOpen:i,setIsViewDialogOpen:g,isDeleteDialogOpen:j,setIsDeleteDialogOpen:a,editingEntity:h,setEditingEntity:b,viewingEntity:w,setViewingEntity:O,deletingEntity:ee,setDeletingEntity:te},children:t})}function Me(){const t=se({strict:!1}),[n,s]=u.useState(1),[l]=u.useState(10),{data:r,isLoading:i,error:g}=ve(t.company),{data:j,isLoading:a,error:h}=be({page:n,limit:l}),b=t.company?r||[]:j?.billingEntities||[],w=t.company?i:a;return(t.company?g:h)?e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Error loading billing entities"}),e.jsx("p",{className:"text-muted-foreground",children:"Please try again later"})]})}):e.jsxs(Le,{children:[e.jsxs(ne,{fixed:!0,children:[e.jsx(ie,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(le,{}),e.jsx(ae,{}),e.jsx(re,{})]})]}),e.jsxs(oe,{children:[e.jsxs("div",{className:"mb-2 flex flex-wrap items-center justify-between space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Billing Entities"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage billing entities and payment information here."})]}),e.jsx(ke,{})]}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-y-0 lg:space-x-12",children:e.jsx(Fe,{data:b,columns:Ae,isLoading:w})})]}),e.jsx(_e,{})]})}const Ct=function(){return e.jsx(Me,{})};export{Ct as component};
