import{r as j,j as e,B as f,d as k,a as M,e as q,t as w}from"./index-CsPbyjqq.js";import{H as se,S as ne,a as ie,T as le,P as ae,M as re}from"./theme-switch-BkO31Og6.js";import{B as N}from"./badge-Dwoct147.js";import{C as F}from"./checkbox-CKYs508e.js";import{D as b}from"./data-table-column-header-CQlxrAjV.js";import{L as S}from"./long-text-Dwtw9Xhu.js";import{D as oe,e as ce,f as de,i as I,h as me}from"./avatar-Dwr00yMn.js";import{E as xe,P as he}from"./pencil-BA3JbpAW.js";import{E as ue}from"./eye-BiAFW7AU.js";import{T as pe}from"./trash-2-BmQajcTX.js";import{u as z,a as H,F as K,b as c,c as d,d as m,e as x,f as h}from"./form-DKoAMwr-.js";import{D as A,a as B,b as T,c as P,d as O,e as V}from"./command-DOxIIFlo.js";import{I as y}from"./input-5SQVrAtH.js";import{S as R,a as U,b as $,c as Q,d as C}from"./select-CcSKRIFJ.js";import{T as Z}from"./textarea-DKq9H4p7.js";import{u as je,A as G,a as ge,b as ye,c as fe,d as be}from"./use-billing-entities-CIdFcuy3.js";import{o as J,s as g,e as Ee}from"./types-Wky072k2.js";import{C as ve}from"./confirm-dialog-Dps2pcjk.js";import{S as L}from"./separator-c02Ge6Zo.js";import{P as Ne}from"./plus-ddirbNEh.js";import{u as Ce,D as De}from"./use-data-table-Cl1qhkDL.js";import"./createReactComponent-BW_frDSn.js";import"./index-D3GDyaHS.js";import"./index-BB0IJgGb.js";import"./index-DSb8P5hH.js";import"./index-BjDkRKFr.js";import"./check-D2987ydO.js";import"./react-icons.esm-B0xYXpOp.js";import"./popover-segQm2pA.js";import"./index-DMmlQz9C.js";import"./index-BWqx2Go7.js";import"./index-DZz0vwHh.js";import"./index-DMPFB69W.js";import"./index-CzDhUyC5.js";import"./map-pin-eHjt42m6.js";import"./alert-dialog-DWkdR42t.js";import"./table-D4KWq3W4.js";const W=j.createContext(void 0);function v(){const t=j.useContext(W);if(!t)throw new Error("useBillingEntitiesContext must be used within BillingEntitiesProvider");return t}function we({row:t}){const n=t.original,{setViewingEntity:s,setIsViewDialogOpen:l,setEditingEntity:i,setIsEditDialogOpen:o,setDeletingEntity:a,setIsDeleteDialogOpen:p}=v(),r=()=>{s(n),l(!0)},u=()=>{i(n),o(!0)},E=()=>{a(n),p(!0)};return e.jsxs(oe,{children:[e.jsx(ce,{asChild:!0,children:e.jsxs(f,{variant:"ghost",className:"data-[state=open]:bg-muted h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(xe,{className:"h-4 w-4"})]})}),e.jsxs(de,{align:"end",className:"w-[160px]",children:[e.jsxs(I,{onClick:r,children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"View"]}),e.jsxs(I,{onClick:u,children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),"Edit"]}),e.jsx(me,{}),e.jsxs(I,{onClick:E,className:"text-destructive focus:text-destructive",children:[e.jsx(pe,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})}const Se=[{id:"select",header:({table:t})=>e.jsx(F,{checked:t.getIsAllPageRowsSelected()||t.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:n=>t.toggleAllPageRowsSelected(!!n),"aria-label":"Select all",className:"translate-y-[2px]"}),meta:{className:k("sticky md:table-cell left-0 z-10 rounded-tl","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted")},cell:({row:t})=>e.jsx(F,{checked:t.getIsSelected(),onCheckedChange:n=>t.toggleSelected(!!n),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"entityName",header:({column:t})=>e.jsx(b,{column:t,title:"Entity Name"}),cell:({row:t})=>e.jsx(S,{className:"max-w-48 font-medium",children:t.getValue("entityName")}),meta:{className:k("drop-shadow-[0_1px_2px_rgb(0_0_0_/_0.1)] dark:drop-shadow-[0_1px_2px_rgb(255_255_255_/_0.1)] lg:drop-shadow-none","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted","sticky left-6 md:table-cell")},enableHiding:!1},{accessorKey:"entityType",header:({column:t})=>e.jsx(b,{column:t,title:"Type"}),cell:({row:t})=>{const n=t.getValue("entityType");return e.jsx(N,{variant:n==="business"?"default":"secondary",children:n==="business"?"Business":"Individual"})},filterFn:(t,n,s)=>{const l=t.getValue("entityType");return s.includes(l)}},{accessorKey:"email",header:({column:t})=>e.jsx(b,{column:t,title:"Email"}),cell:({row:t})=>{const n=t.getValue("email");return n?e.jsx("a",{href:`mailto:${n}`,className:"text-blue-600 hover:underline",children:e.jsx(S,{className:"max-w-48",children:n})}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}},{accessorKey:"phone",header:({column:t})=>e.jsx(b,{column:t,title:"Phone"}),cell:({row:t})=>{const n=t.getValue("phone");return n?e.jsx("div",{className:"text-nowrap",children:n}):e.jsx("span",{className:"text-muted-foreground",children:"-"})},enableSorting:!1},{id:"billingAddress",header:({column:t})=>e.jsx(b,{column:t,title:"Billing Address"}),cell:({row:t})=>{const{billingAddress:n}=t.original;if(!n||!n.city&&!n.state&&!n.country)return e.jsx("span",{className:"text-muted-foreground",children:"-"});const s=[n.city,n.state,n.country].filter(Boolean);return e.jsx(S,{className:"max-w-48",children:s.join(", ")})},filterFn:(t,n,s)=>{const{billingAddress:l}=t.original;if(!l)return!1;const i=s.toLowerCase();return l.city?.toLowerCase().includes(i)||l.state?.toLowerCase().includes(i)||l.country?.toLowerCase().includes(i)||!1}},{accessorKey:"taxId",header:({column:t})=>e.jsx(b,{column:t,title:"Tax ID"}),cell:({row:t})=>{const n=t.getValue("taxId");return n?e.jsx("div",{className:"text-nowrap",children:n}):e.jsx("span",{className:"text-muted-foreground",children:"-"})},enableSorting:!1},{accessorKey:"isActive",header:({column:t})=>e.jsx(b,{column:t,title:"Status"}),cell:({row:t})=>{const n=t.getValue("isActive");return e.jsx(N,{variant:n?"default":"destructive",children:n?"Active":"Inactive"})},filterFn:(t,n,s)=>{const l=t.getValue("isActive");return s.includes(l?"active":"inactive")}},{id:"actions",cell:we}],Ie=J({street:g().min(1,"Street is required"),city:g().min(1,"City is required"),state:g().min(1,"State is required"),zipCode:g().min(1,"Zip code is required"),country:g().min(1,"Country is required")}),Ae=Ee(["individual","business"],{errorMap:()=>({message:"Entity type must be either individual or business"})}),X=J({entityName:g().min(1,"Entity name is required").trim(),entityType:Ae,email:g().email("Invalid email address"),phone:g().min(1,"Phone number is required"),billingAddress:Ie,taxId:g().optional(),notes:g().optional(),company:g().min(1,"Company is required")});X.partial().extend({_id:g().min(1,"ID is required")});const Y=X.omit({company:!0});function Be(){const{isCreateDialogOpen:t,setIsCreateDialogOpen:n}=v(),s=je(),l=M({strict:!1}),i=z({resolver:H(Y),defaultValues:{entityName:"",entityType:"individual",email:"",phone:"",billingAddress:{street:"",city:"",state:"",zipCode:"",country:""},taxId:"",notes:""}}),o=async a=>{if(!l.company){w.error("Please select a company first");return}try{await s.mutateAsync({...a,company:l.company}),w.success("Billing entity created successfully"),i.reset(),n(!1)}catch{w.error("Failed to create billing entity")}};return e.jsx(A,{open:t,onOpenChange:n,children:e.jsxs(B,{className:"sm:max-w-[625px]",children:[e.jsxs(T,{children:[e.jsx(P,{children:"Create Billing Entity"}),e.jsx(O,{children:"Add a new billing entity to your system. Fill in the entity details below."})]}),e.jsx(K,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(o),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(c,{control:i.control,name:"entityName",render:({field:a})=>e.jsxs(d,{className:"col-span-2",children:[e.jsx(m,{children:"Entity Name *"}),e.jsx(x,{children:e.jsx(y,{placeholder:"Enter entity name",...a})}),e.jsx(h,{})]})}),e.jsx(c,{control:i.control,name:"entityType",render:({field:a})=>e.jsxs(d,{children:[e.jsx(m,{children:"Entity Type *"}),e.jsxs(R,{onValueChange:a.onChange,value:a.value,children:[e.jsx(x,{children:e.jsx(U,{children:e.jsx($,{placeholder:"Select entity type"})})}),e.jsxs(Q,{children:[e.jsx(C,{value:"individual",children:"Individual"}),e.jsx(C,{value:"business",children:"Business"})]})]}),e.jsx(h,{})]})}),e.jsx(c,{control:i.control,name:"taxId",render:({field:a})=>e.jsxs(d,{children:[e.jsx(m,{children:"Tax ID"}),e.jsx(x,{children:e.jsx(y,{placeholder:"Enter tax ID",...a})}),e.jsx(h,{})]})}),e.jsx(c,{control:i.control,name:"email",render:({field:a})=>e.jsxs(d,{children:[e.jsx(m,{children:"Email *"}),e.jsx(x,{children:e.jsx(y,{type:"email",placeholder:"entity@example.com",...a})}),e.jsx(h,{})]})}),e.jsx(c,{control:i.control,name:"phone",render:({field:a})=>e.jsxs(d,{children:[e.jsx(m,{children:"Phone *"}),e.jsx(x,{children:e.jsx(y,{placeholder:"+1 (555) 000-0000",...a})}),e.jsx(h,{})]})}),e.jsx(c,{control:i.control,name:"billingAddress",render:({field:a})=>e.jsxs(d,{className:"col-span-2",children:[e.jsx(m,{children:"Billing Address *"}),e.jsx(x,{children:e.jsx(G,{value:a.value,onChange:a.onChange,placeholder:"Start typing an address..."})}),e.jsx(h,{})]})}),e.jsx(c,{control:i.control,name:"notes",render:({field:a})=>e.jsxs(d,{className:"col-span-2",children:[e.jsx(m,{children:"Notes"}),e.jsx(x,{children:e.jsx(Z,{placeholder:"Additional notes about this billing entity...",className:"resize-none",...a})}),e.jsx(h,{})]})})]}),e.jsxs(V,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:()=>n(!1),children:"Cancel"}),e.jsxs(f,{type:"submit",disabled:s.isPending,children:[s.isPending&&e.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Entity"]})]})]})})]})})}function Te(){const{deletingEntity:t,isDeleteDialogOpen:n,setIsDeleteDialogOpen:s}=v(),l=ge(),i=async()=>{if(t)try{await l.mutateAsync(t._id),s(!1)}catch{}};return e.jsx(ve,{open:n,onOpenChange:s,title:"Delete Billing Entity",desc:`Are you sure you want to delete "${t?.entityName}"? This action cannot be undone.`,confirmText:"Delete",destructive:!0,isLoading:l.isPending,handleConfirm:i})}function Pe(){const{isEditDialogOpen:t,setIsEditDialogOpen:n,editingEntity:s,setEditingEntity:l}=v(),i=ye(),o=z({resolver:H(Y),defaultValues:{entityName:"",entityType:"individual",email:"",phone:"",billingAddress:{street:"",city:"",state:"",zipCode:"",country:""},taxId:"",notes:""}});j.useEffect(()=>{s&&o.reset({entityName:s.entityName||"",entityType:s.entityType||"individual",email:s.email||"",phone:s.phone||"",billingAddress:{street:s.billingAddress?.street||"",city:s.billingAddress?.city||"",state:s.billingAddress?.state||"",zipCode:s.billingAddress?.zipCode||"",country:s.billingAddress?.country||""},taxId:s.taxId||"",notes:s.notes||""})},[s,o]);const a=async r=>{if(s)try{await i.mutateAsync({_id:s._id,...r}),o.reset(),n(!1),l(null)}catch{}},p=()=>{n(!1),l(null),o.reset()};return e.jsx(A,{open:t,onOpenChange:p,children:e.jsxs(B,{className:"sm:max-w-[625px]",children:[e.jsxs(T,{children:[e.jsx(P,{children:"Edit Billing Entity"}),e.jsx(O,{children:"Update the billing entity information. Make your changes and save."})]}),e.jsx(K,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(a),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(c,{control:o.control,name:"entityName",render:({field:r})=>e.jsxs(d,{className:"col-span-2",children:[e.jsx(m,{children:"Entity Name *"}),e.jsx(x,{children:e.jsx(y,{placeholder:"Enter entity name",...r})}),e.jsx(h,{})]})}),e.jsx(c,{control:o.control,name:"entityType",render:({field:r})=>e.jsxs(d,{children:[e.jsx(m,{children:"Entity Type *"}),e.jsxs(R,{onValueChange:r.onChange,value:r.value,children:[e.jsx(x,{children:e.jsx(U,{children:e.jsx($,{placeholder:"Select entity type"})})}),e.jsxs(Q,{children:[e.jsx(C,{value:"individual",children:"Individual"}),e.jsx(C,{value:"business",children:"Business"})]})]}),e.jsx(h,{})]})}),e.jsx(c,{control:o.control,name:"taxId",render:({field:r})=>e.jsxs(d,{children:[e.jsx(m,{children:"Tax ID"}),e.jsx(x,{children:e.jsx(y,{placeholder:"Enter tax ID",...r})}),e.jsx(h,{})]})}),e.jsx(c,{control:o.control,name:"email",render:({field:r})=>e.jsxs(d,{children:[e.jsx(m,{children:"Email *"}),e.jsx(x,{children:e.jsx(y,{type:"email",placeholder:"entity@example.com",...r})}),e.jsx(h,{})]})}),e.jsx(c,{control:o.control,name:"phone",render:({field:r})=>e.jsxs(d,{children:[e.jsx(m,{children:"Phone *"}),e.jsx(x,{children:e.jsx(y,{placeholder:"+1 (555) 000-0000",...r})}),e.jsx(h,{})]})}),e.jsx(c,{control:o.control,name:"billingAddress",render:({field:r})=>e.jsxs(d,{className:"col-span-2",children:[e.jsx(m,{children:"Billing Address *"}),e.jsx(x,{children:e.jsx(G,{value:r.value,onChange:r.onChange,placeholder:"Start typing an address..."})}),e.jsx(h,{})]})}),e.jsx(c,{control:o.control,name:"notes",render:({field:r})=>e.jsxs(d,{className:"col-span-2",children:[e.jsx(m,{children:"Notes"}),e.jsx(x,{children:e.jsx(Z,{placeholder:"Additional notes about this billing entity...",className:"resize-none",...r})}),e.jsx(h,{})]})})]}),e.jsxs(V,{children:[e.jsx(f,{type:"button",variant:"outline",onClick:p,children:"Cancel"}),e.jsxs(f,{type:"submit",disabled:i.isPending,children:[i.isPending&&e.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}),"Save Changes"]})]})]})})]})})}function Oe(){const{isViewDialogOpen:t,setIsViewDialogOpen:n,viewingEntity:s,setViewingEntity:l,setIsEditDialogOpen:i,setEditingEntity:o}=v();if(!s)return null;const a=()=>{o(s),i(!0),n(!1)},p=()=>{n(!1),l(null)},r=u=>u?[u.street,u.city,u.state,u.zipCode,u.country].filter(Boolean).join(", "):"No address provided";return e.jsx(A,{open:t,onOpenChange:p,children:e.jsxs(B,{className:"max-h-[90vh] overflow-y-auto sm:max-w-[625px]",children:[e.jsxs(T,{children:[e.jsx(P,{children:"Billing Entity Details"}),e.jsx(O,{children:"View detailed information about the billing entity"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Entity Name"}),e.jsx("p",{className:"mt-1 text-sm font-medium",children:s.entityName})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Entity Type"}),e.jsx(N,{className:"mt-1",variant:s.entityType==="business"?"default":"secondary",children:s.entityType==="business"?"Business":"Individual"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Email"}),e.jsx("p",{className:"mt-1 text-sm",children:e.jsx("a",{href:`mailto:${s.email}`,className:"text-blue-600 hover:underline",children:s.email})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Phone"}),e.jsx("p",{className:"mt-1 text-sm",children:s.phone})]}),s.taxId&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Tax ID"}),e.jsx("p",{className:"mt-1 text-sm",children:s.taxId})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Status"}),e.jsx(N,{className:"mt-1",variant:s.isActive?"default":"destructive",children:s.isActive?"Active":"Inactive"})]})]}),e.jsx(L,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Billing Address"}),e.jsx("p",{className:"mt-1 text-sm",children:r(s.billingAddress)})]}),s.qbCustomerId&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"QuickBooks Customer ID"}),e.jsx("p",{className:"mt-1 font-mono text-sm",children:s.qbCustomerId})]}),s.notes&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Notes"}),e.jsx("p",{className:"mt-1 text-sm whitespace-pre-wrap",children:s.notes})]}),e.jsx(L,{}),e.jsxs("div",{className:"text-muted-foreground grid grid-cols-2 gap-4 text-xs",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Created"}),e.jsx("p",{children:new Date(s.createdAt).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Last Updated"}),e.jsx("p",{children:new Date(s.updatedAt).toLocaleDateString()})]})]})]}),e.jsxs(V,{children:[e.jsx(f,{variant:"outline",onClick:p,children:"Close"}),e.jsx(f,{onClick:a,children:"Edit Entity"})]})]})})}function Ve(){return e.jsxs(e.Fragment,{children:[e.jsx(Be,{}),e.jsx(Pe,{}),e.jsx(Oe,{}),e.jsx(Te,{})]})}function _e(){const{setIsCreateDialogOpen:t}=v();return e.jsxs(f,{size:"sm",onClick:()=>t(!0),children:[e.jsx(Ne,{className:"mr-2 h-4 w-4"}),"Add Billing Entity"]})}function ke({columns:t,data:n,isLoading:s}){const{table:l}=Ce({data:n,columns:t});return e.jsx(De,{table:l,columns:t,isLoading:s,searchColumn:"entityName",searchPlaceholder:"Filter billing entities..."})}function Fe({children:t}){const[n,s]=j.useState(!1),[l,i]=j.useState(!1),[o,a]=j.useState(!1),[p,r]=j.useState(!1),[u,E]=j.useState(null),[D,_]=j.useState(null),[ee,te]=j.useState(null);return e.jsx(W.Provider,{value:{isCreateDialogOpen:n,setIsCreateDialogOpen:s,isEditDialogOpen:l,setIsEditDialogOpen:i,isViewDialogOpen:o,setIsViewDialogOpen:a,isDeleteDialogOpen:p,setIsDeleteDialogOpen:r,editingEntity:u,setEditingEntity:E,viewingEntity:D,setViewingEntity:_,deletingEntity:ee,setDeletingEntity:te},children:t})}function Le(){const t=M({strict:!1}),[n,s]=j.useState(1),[l]=j.useState(10),{data:i,isLoading:o,error:a}=fe(t.company),{data:p,isLoading:r,error:u}=be({page:n,limit:l}),E=t.company?i||[]:p?.billingEntities||[],D=t.company?o:r;return(t.company?a:u)?e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Error loading billing entities"}),e.jsx("p",{className:"text-muted-foreground",children:"Please try again later"})]})}):e.jsxs(Fe,{children:[e.jsxs(se,{fixed:!0,children:[e.jsx(ne,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(ie,{}),e.jsx(le,{}),e.jsx(ae,{})]})]}),e.jsxs(re,{children:[e.jsxs("div",{className:"mb-2 flex flex-wrap items-center justify-between space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Billing Entities"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage billing entities and payment information here."})]}),e.jsx(_e,{})]}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-y-0 lg:space-x-12",children:e.jsx(ke,{data:E,columns:Se,isLoading:D})})]}),e.jsx(Ve,{})]})}const vt=function(){return e.jsx(Le,{})};export{vt as component};
