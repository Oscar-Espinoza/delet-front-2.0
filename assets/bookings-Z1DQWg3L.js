import{c as I,r as g,j as e,B as w,f as xe,d as k,e as pe,t as Y,h as Te,i as Q,a as _e}from"./index-CsPbyjqq.js";import{u as Be,b as je,q as z,c as q,H as Fe,S as Pe,a as He,T as Ae,P as Ve,M as Le}from"./theme-switch-BkO31Og6.js";import{B}from"./badge-Dwoct147.js";import{D as ee,a as se,b as te,c as ae,d as ne,e as re,C as ge,f as fe,g as ye,h as U,i as W,j as J}from"./command-DOxIIFlo.js";import{S as P}from"./separator-c02Ge6Zo.js";import{C as le}from"./calendar-GirBm93f.js";import{M as Ee}from"./map-pin-eHjt42m6.js";import{U as Z,M as Ie,P as Oe}from"./user-DJ4jP065.js";import{F as Ge}from"./file-text-D6t6uW1t.js";import{c as $e,f as b,s as me}from"./format-BvUxDbfm.js";import{E as $,C as qe}from"./avatar-Dwr00yMn.js";import{n as Ye,s as ze,e as Ue,a as he,i as We,b as G,C as Je}from"./calendar-B0qj4_Yx.js";import{u as Ne,a as ve,F as we,b as C,c as S,d as M,e as D,f as T}from"./form-DKoAMwr-.js";import{I as be}from"./input-5SQVrAtH.js";import{S as H,a as A,b as V,c as L,d as E}from"./select-CcSKRIFJ.js";import{T as ke}from"./textarea-DKq9H4p7.js";import{o as Re,s as X,e as Ke,d as Qe}from"./types-Wky072k2.js";import{P as oe,a as ie,b as ce}from"./popover-segQm2pA.js";import{C as Ce}from"./chevrons-up-down-CuYahFvy.js";import{C as R}from"./check-D2987ydO.js";import{B as Xe}from"./building-DyRUGexz.js";import{P as Ze}from"./plus-ddirbNEh.js";import"./createReactComponent-BW_frDSn.js";import"./index-D3GDyaHS.js";import"./index-BWqx2Go7.js";import"./index-DMmlQz9C.js";import"./index-BjDkRKFr.js";import"./index-DSb8P5hH.js";import"./index-DZz0vwHh.js";import"./index-DMPFB69W.js";import"./index-CzDhUyC5.js";import"./index-BB0IJgGb.js";/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.3V14",key:"akvzfd"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]],ss=I("calendar-clock",es);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],as=I("calendar-days",ts);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M17 14h-6",key:"bkmgh3"}],["path",{d:"M13 18H7",key:"bb0bb7"}],["path",{d:"M7 14h.01",key:"1qa3f1"}],["path",{d:"M17 18h.01",key:"1bdyru"}]],rs=I("calendar-range",ns);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],os=I("chevron-left",ls);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],cs=I("clock",is);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]],ms=I("key",ds);function ue(t,n){const{start:s,end:d}=Ye(n?.in,t);let o=+s>+d;const r=o?+s:+d,a=o?d:s;a.setHours(0,0,0,0);let l=1;const u=[];for(;+a<=r;)u.push($e(s,a)),a.setDate(a.getDate()+l),a.setHours(0,0,0,0);return o?u.reverse():u}const Se=g.createContext(void 0);function _(){const t=g.useContext(Se);if(!t)throw new Error("useBookingsContext must be used within BookingsProvider");return t}const hs={scheduled:"default",pending:"secondary",active:"default",attended:"default",missed:"destructive",cancelled:"destructive",rescheduled:"secondary",show:"default",incomplete:"secondary",archived:"secondary"};function us(){const{showDetailsModal:t,setShowDetailsModal:n,selectedBooking:s,setShowEditModal:d}=_();if(!s)return null;const o=()=>{n(!1),d(!0)};return e.jsx(ee,{open:t,onOpenChange:n,children:e.jsxs(se,{className:"sm:max-w-[625px]",children:[e.jsxs(te,{children:[e.jsx(ae,{children:"Booking Details"}),e.jsx(ne,{children:"View complete information about this booking."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(B,{variant:hs[s.status],children:s.status.charAt(0).toUpperCase()+s.status.slice(1)}),s.passCode&&e.jsxs("div",{className:"text-muted-foreground flex items-center text-sm",children:[e.jsx(ms,{className:"mr-1 h-4 w-4"}),e.jsx("span",{className:"font-mono",children:s.passCode})]})]}),e.jsxs("div",{className:"text-muted-foreground flex items-center text-sm",children:[e.jsx(le,{className:"mr-1 h-4 w-4"}),b(new Date(s.startTime*1e3),"PPP"),e.jsx(cs,{className:"mr-1 ml-3 h-4 w-4"}),b(new Date(s.startTime*1e3),"p")]})]}),e.jsx(P,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center font-semibold",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),"Property"]}),e.jsxs("div",{className:"ml-6 space-y-1",children:[e.jsx("p",{className:"text-sm",children:s.property.address}),s.property.unitNumber&&e.jsxs("p",{className:"text-muted-foreground text-sm",children:["Unit: ",s.property.unitNumber]}),s.property.city&&e.jsxs("p",{className:"text-muted-foreground text-sm",children:[s.property.city,","," ",s.property.state," ",s.property.zipCode]})]})]}),e.jsx(P,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center font-semibold",children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Contact"]}),e.jsxs("div",{className:"ml-6 space-y-1",children:[e.jsxs("p",{className:"text-sm font-medium",children:[s.contact.firstName," ",s.contact.lastName]}),s.contact.email&&e.jsxs("p",{className:"text-muted-foreground flex items-center text-sm",children:[e.jsx(Ie,{className:"mr-2 h-3 w-3"}),s.contact.email]}),s.contact.phone&&e.jsxs("p",{className:"text-muted-foreground flex items-center text-sm",children:[e.jsx(Oe,{className:"mr-2 h-3 w-3"}),s.contact.phone]})]})]}),e.jsx(P,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center font-semibold",children:[e.jsx(Z,{className:"mr-2 h-4 w-4"}),"Agent"]}),e.jsxs("div",{className:"ml-6 space-y-1",children:[e.jsxs("p",{className:"text-sm font-medium",children:[s.user.firstName," ",s.user.lastName]}),e.jsx("p",{className:"text-muted-foreground text-sm",children:s.user.email}),s.user.company&&e.jsx("p",{className:"text-muted-foreground text-sm",children:s.user.company.name})]})]}),s.notes&&e.jsxs(e.Fragment,{children:[e.jsx(P,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h3",{className:"flex items-center font-semibold",children:[e.jsx(Ge,{className:"mr-2 h-4 w-4"}),"Notes"]}),e.jsx("p",{className:"text-muted-foreground ml-6 text-sm",children:s.notes})]})]}),e.jsx(P,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-semibold",children:"Outcome"}),e.jsx("div",{className:"ml-6",children:s.outcome&&s.outcome.trim()!==""?e.jsx(B,{variant:"outline",children:s.outcome.replace(/_/g," ").charAt(0).toUpperCase()+s.outcome.replace(/_/g," ").slice(1)}):e.jsx("span",{className:"text-muted-foreground text-sm",children:"No outcome recorded"})})]}),e.jsx(P,{}),e.jsxs("div",{className:"text-muted-foreground flex justify-between text-xs",children:[e.jsxs("span",{children:["Created: ",b(new Date(s.createdAt),"PPp")]}),e.jsxs("span",{children:["Updated: ",b(new Date(s.updatedAt),"PPp")]})]})]}),e.jsxs(re,{children:[e.jsx(w,{variant:"outline",onClick:()=>n(!1),children:"Close"}),e.jsx(w,{onClick:o,children:"Edit Booking"})]})]})})}const de="/api/booking",xs=async t=>{const n=new URLSearchParams;return n.append("companies",t.companies||""),n.append("properties",t.properties||""),n.append("agents",t.agents||""),n.append("firstName",t.firstName||""),n.append("lastName",t.lastName||""),t.startTime&&n.append("startTime",t.startTime.toString()),t.endTime&&n.append("endTime",t.endTime.toString()),t.status&&n.append("status",t.status),t.outcome&&n.append("outcome",t.outcome),await q.get(`${de}/admin/calendar?${n.toString()}`)},ps=async t=>await q.post(de,{...t,startTime:Math.floor(t.startTime.getTime()/1e3)}),js=async(t,n)=>{const s={...n};return n.startTime&&(s.startTime=Math.floor(n.startTime.getTime()/1e3)),await q.patch(`${de}/${t}`,s)},gs=t=>Be({queryKey:z.bookings.list(t),queryFn:()=>xs(t)}),fs=()=>{const t=xe();return je({mutationFn:ps,onSuccess:()=>{t.invalidateQueries({queryKey:z.bookings.all})}})},ys=()=>{const t=xe();return je({mutationFn:({id:n,data:s})=>js(n,s),onSuccess:(n,{id:s})=>{t.invalidateQueries({queryKey:z.bookings.lists()}),t.invalidateQueries({queryKey:z.bookings.detail(s)})}})};function Ns(){const{filters:t,selectedDate:n,calendarView:s,setSelectedBooking:d,setShowDetailsModal:o}=_(),{data:r=[],isLoading:a}=gs(t),l=()=>{const i=ze(n),x=Ue(n),N=me(i),j=he(x),y=ue({start:N,end:j}),f=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],m=c=>r.filter(p=>{const v=new Date(p.startTime*1e3);return G(v,c)});return e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"bg-muted grid grid-cols-7 gap-px overflow-hidden rounded-lg",children:[f.map(c=>e.jsx("div",{className:"bg-background text-muted-foreground p-2 text-center text-sm font-medium",children:c},c)),y.map((c,p)=>{const v=m(c),F=We(c,n),K=G(c,new Date);return e.jsxs("div",{className:k("bg-background min-h-[100px] border-t p-2",!F&&"text-muted-foreground bg-muted/50"),children:[e.jsx("div",{className:k("mb-1 text-sm font-medium",K&&"text-primary"),children:b(c,"d")}),e.jsx($,{className:"h-[80px]",children:e.jsxs("div",{className:"space-y-1",children:[v.slice(0,3).map(O=>e.jsx("div",{className:"cursor-pointer",onClick:()=>{d(O),o(!0)},children:e.jsxs(B,{variant:O.status==="cancelled"?"destructive":"secondary",className:"w-full justify-start truncate text-xs",children:[b(new Date(O.startTime*1e3),"HH:mm")," ","- ",O.contact.firstName]})},O._id)),v.length>3&&e.jsxs("div",{className:"text-muted-foreground text-center text-xs",children:["+",v.length-3," more"]})]})})]},p)})]})})},u=()=>{const i=me(n),x=he(n),N=ue({start:i,end:x}),j=Array.from({length:24},(f,m)=>m),y=(f,m)=>r.filter(c=>{const p=new Date(c.startTime*1e3);return G(p,f)&&p.getHours()===m});return e.jsx($,{className:"h-[600px]",children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"bg-muted grid grid-cols-8 gap-px overflow-hidden rounded-lg",children:[e.jsx("div",{className:"bg-background p-2"}),N.map(f=>e.jsxs("div",{className:"bg-background p-2 text-center text-sm font-medium",children:[e.jsx("div",{children:b(f,"EEE")}),e.jsx("div",{className:k("text-lg",G(f,new Date)&&"text-primary font-bold"),children:b(f,"d")})]},f.toISOString())),j.map(f=>e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-background text-muted-foreground border-t p-2 text-right text-sm",children:b(new Date().setHours(f,0,0,0),"HH:mm")},`hour-${f}`),N.map(m=>{const c=y(m,f);return e.jsx("div",{className:"bg-background min-h-[50px] border-t border-l p-1",children:c.map(p=>e.jsxs(B,{variant:p.status==="cancelled"?"destructive":"secondary",className:"mb-1 w-full cursor-pointer truncate text-xs",onClick:()=>{d(p),o(!0)},children:[p.contact.firstName," ",p.contact.lastName]},p._id))},`${m.toISOString()}-${f}`)})]}))]})})})},h=()=>{const i=Array.from({length:24},(N,j)=>j),x=N=>r.filter(j=>{const y=new Date(j.startTime*1e3);return G(y,n)&&y.getHours()===N});return e.jsx($,{className:"h-[600px]",children:e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"space-y-px",children:i.map(N=>{const j=x(N);return e.jsxs("div",{className:"grid grid-cols-12 gap-4 border-b p-2",children:[e.jsx("div",{className:"text-muted-foreground col-span-1 text-right text-sm",children:b(new Date().setHours(N,0,0,0),"HH:mm")}),e.jsx("div",{className:"col-span-11 min-h-[50px]",children:j.map(y=>e.jsxs(B,{variant:y.status==="cancelled"?"destructive":"default",className:"mr-2 mb-2 cursor-pointer",onClick:()=>{d(y),o(!0)},children:[b(new Date(y.startTime*1e3),"HH:mm")," -",y.contact.firstName," ",y.contact.lastName," -",y.property.address]},y._id))})]},N)})})})})};return a?e.jsx("div",{className:"flex h-[600px] items-center justify-center",children:e.jsx("div",{className:"text-muted-foreground",children:"Loading bookings..."})}):e.jsxs("div",{className:"bg-background rounded-lg border",children:[s==="dayGridMonth"&&l(),s==="timeGridWeek"&&u(),s==="timeGridDay"&&h()]})}const Me=Re({propertyId:X().min(1,"Property is required"),contactId:X().min(1,"Contact is required"),startTime:Qe({required_error:"Start time is required"}),status:Ke(["active","archived","attended","cancelled","incomplete","missed","pending","rescheduled","scheduled","show"]),notes:X().optional()}),vs=[{_id:"1",address:"123 Main St, Apt 4B"},{_id:"2",address:"456 Oak Ave, Unit 2"},{_id:"3",address:"789 Pine Rd, Suite 100"}],ws=[{_id:"1",firstName:"John",lastName:"Doe",email:"john@example.com"},{_id:"2",firstName:"Jane",lastName:"Smith",email:"jane@example.com"},{_id:"3",firstName:"Bob",lastName:"Johnson",email:"bob@example.com"}],bs=[{value:"scheduled",label:"Scheduled"},{value:"pending",label:"Pending"},{value:"active",label:"Active"},{value:"attended",label:"Attended"},{value:"missed",label:"Missed"},{value:"cancelled",label:"Cancelled"},{value:"rescheduled",label:"Rescheduled"},{value:"show",label:"Show"},{value:"incomplete",label:"Incomplete"},{value:"archived",label:"Archived"}];function ks(){const{showCreateModal:t,setShowCreateModal:n}=_(),s=fs(),d=Ne({resolver:ve(Me),defaultValues:{propertyId:"",contactId:"",startTime:new Date,status:"scheduled",notes:""}}),o=async r=>{try{await s.mutateAsync(r),Y.success("Booking created successfully"),d.reset(),n(!1)}catch{Y.error("Failed to create booking")}};return e.jsx(ee,{open:t,onOpenChange:n,children:e.jsxs(se,{className:"sm:max-w-[625px]",children:[e.jsxs(te,{children:[e.jsx(ae,{children:"Create Booking"}),e.jsx(ne,{children:"Schedule a new property showing or appointment."})]}),e.jsx(we,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(o),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(C,{control:d.control,name:"propertyId",render:({field:r})=>e.jsxs(S,{children:[e.jsx(M,{children:"Property *"}),e.jsxs(H,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(D,{children:e.jsx(A,{children:e.jsx(V,{placeholder:"Select a property"})})}),e.jsx(L,{children:vs.map(a=>e.jsx(E,{value:a._id,children:a.address},a._id))})]}),e.jsx(T,{})]})}),e.jsx(C,{control:d.control,name:"contactId",render:({field:r})=>e.jsxs(S,{children:[e.jsx(M,{children:"Contact *"}),e.jsxs(H,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(D,{children:e.jsx(A,{children:e.jsx(V,{placeholder:"Select a contact"})})}),e.jsx(L,{children:ws.map(a=>e.jsxs(E,{value:a._id,children:[a.firstName," ",a.lastName]},a._id))})]}),e.jsx(T,{})]})}),e.jsx(C,{control:d.control,name:"startTime",render:({field:r})=>e.jsxs(S,{children:[e.jsx(M,{children:"Date & Time *"}),e.jsx(D,{children:e.jsx(be,{type:"datetime-local",value:r.value?b(r.value,"yyyy-MM-dd'T'HH:mm"):"",onChange:a=>r.onChange(new Date(a.target.value))})}),e.jsx(T,{})]})}),e.jsx(C,{control:d.control,name:"status",render:({field:r})=>e.jsxs(S,{children:[e.jsx(M,{children:"Status *"}),e.jsxs(H,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(D,{children:e.jsx(A,{children:e.jsx(V,{placeholder:"Select status"})})}),e.jsx(L,{children:bs.map(a=>e.jsx(E,{value:a.value,children:a.label},a.value))})]}),e.jsx(T,{})]})}),e.jsx(C,{control:d.control,name:"notes",render:({field:r})=>e.jsxs(S,{className:"col-span-2",children:[e.jsx(M,{children:"Notes"}),e.jsx(D,{children:e.jsx(ke,{placeholder:"Add any additional notes about this booking",className:"resize-none",rows:3,...r})}),e.jsx(T,{})]})})]}),e.jsxs(re,{children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>n(!1),children:"Cancel"}),e.jsxs(w,{type:"submit",disabled:s.isPending,children:[s.isPending&&e.jsx(pe,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Booking"]})]})]})})]})})}const Cs=[{_id:"1",address:"123 Main St, Apt 4B"},{_id:"2",address:"456 Oak Ave, Unit 2"},{_id:"3",address:"789 Pine Rd, Suite 100"}],Ss=[{_id:"1",firstName:"John",lastName:"Doe",email:"john@example.com"},{_id:"2",firstName:"Jane",lastName:"Smith",email:"jane@example.com"},{_id:"3",firstName:"Bob",lastName:"Johnson",email:"bob@example.com"}],Ms=[{value:"scheduled",label:"Scheduled"},{value:"pending",label:"Pending"},{value:"active",label:"Active"},{value:"attended",label:"Attended"},{value:"missed",label:"Missed"},{value:"cancelled",label:"Cancelled"},{value:"rescheduled",label:"Rescheduled"},{value:"show",label:"Show"},{value:"incomplete",label:"Incomplete"},{value:"archived",label:"Archived"}];function Ds(){const{showEditModal:t,setShowEditModal:n,selectedBooking:s}=_(),d=ys(),o=Ne({resolver:ve(Me),defaultValues:{propertyId:"",contactId:"",startTime:new Date,status:"scheduled",notes:""}});g.useEffect(()=>{s&&o.reset({propertyId:s.property._id,contactId:s.contact._id,startTime:new Date(s.startTime*1e3),status:s.status,notes:s.notes||""})},[s,o]);const r=async a=>{if(s)try{await d.mutateAsync({id:s._id,data:a}),Y.success("Booking updated successfully"),n(!1)}catch{Y.error("Failed to update booking")}};return s?e.jsx(ee,{open:t,onOpenChange:n,children:e.jsxs(se,{className:"sm:max-w-[625px]",children:[e.jsxs(te,{children:[e.jsx(ae,{children:"Edit Booking"}),e.jsx(ne,{children:"Update the booking details below."})]}),e.jsx(we,{...o,children:e.jsxs("form",{onSubmit:o.handleSubmit(r),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(C,{control:o.control,name:"propertyId",render:({field:a})=>e.jsxs(S,{children:[e.jsx(M,{children:"Property *"}),e.jsxs(H,{onValueChange:a.onChange,value:a.value,children:[e.jsx(D,{children:e.jsx(A,{children:e.jsx(V,{placeholder:"Select a property"})})}),e.jsx(L,{children:Cs.map(l=>e.jsx(E,{value:l._id,children:l.address},l._id))})]}),e.jsx(T,{})]})}),e.jsx(C,{control:o.control,name:"contactId",render:({field:a})=>e.jsxs(S,{children:[e.jsx(M,{children:"Contact *"}),e.jsxs(H,{onValueChange:a.onChange,value:a.value,children:[e.jsx(D,{children:e.jsx(A,{children:e.jsx(V,{placeholder:"Select a contact"})})}),e.jsx(L,{children:Ss.map(l=>e.jsxs(E,{value:l._id,children:[l.firstName," ",l.lastName]},l._id))})]}),e.jsx(T,{})]})}),e.jsx(C,{control:o.control,name:"startTime",render:({field:a})=>e.jsxs(S,{children:[e.jsx(M,{children:"Date & Time *"}),e.jsx(D,{children:e.jsx(be,{type:"datetime-local",value:a.value?b(a.value,"yyyy-MM-dd'T'HH:mm"):"",onChange:l=>a.onChange(new Date(l.target.value))})}),e.jsx(T,{})]})}),e.jsx(C,{control:o.control,name:"status",render:({field:a})=>e.jsxs(S,{children:[e.jsx(M,{children:"Status *"}),e.jsxs(H,{onValueChange:a.onChange,value:a.value,children:[e.jsx(D,{children:e.jsx(A,{children:e.jsx(V,{placeholder:"Select status"})})}),e.jsx(L,{children:Ms.map(l=>e.jsx(E,{value:l.value,children:l.label},l.value))})]}),e.jsx(T,{})]})}),e.jsx(C,{control:o.control,name:"notes",render:({field:a})=>e.jsxs(S,{className:"col-span-2",children:[e.jsx(M,{children:"Notes"}),e.jsx(D,{children:e.jsx(ke,{placeholder:"Add any additional notes about this booking",className:"resize-none",rows:3,...a})}),e.jsx(T,{})]})})]}),e.jsxs(re,{children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>n(!1),children:"Cancel"}),e.jsxs(w,{type:"submit",disabled:d.isPending,children:[d.isPending&&e.jsx(pe,{className:"mr-2 h-4 w-4 animate-spin"}),"Update Booking"]})]})]})})]})}):null}function Ts(){const{filters:t,setFilters:n}=_(),{auth:s}=Te(),[d,o]=g.useState(!1),[r,a]=g.useState([]),[l,u]=g.useState(!1),[h,i]=g.useState(""),x=t.agents?.split(",").filter(Boolean)||[];g.useEffect(()=>{N()},[]);const N=async()=>{u(!0);try{const c=await q.post("/api/users/admin/agents/all",{page:1,limit:100,select:"firstName lastName email company"});a(c.agents||[])}catch{}finally{u(!1)}},j=c=>{const p=x.includes(c);let v;p?v=x.filter(F=>F!==c):v=[...x,c],n({...t,agents:v.join(",")})},y=()=>{x.length===r.length?n({...t,agents:""}):n({...t,agents:r.map(c=>c._id).join(",")})},f=()=>{n({...t,agents:""})},m=r.filter(c=>`${c.firstName} ${c.lastName}`.toLowerCase().includes(h.toLowerCase())||c.email&&c.email.toLowerCase().includes(h.toLowerCase()));return e.jsxs(oe,{open:d,onOpenChange:o,children:[e.jsx(ie,{asChild:!0,children:e.jsxs(w,{variant:"outline",role:"combobox","aria-expanded":d,className:"justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsx("span",{children:"Agents"}),x.length>0&&e.jsx(B,{variant:"secondary",className:"ml-2",children:x.length})]}),e.jsx(Ce,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(ce,{className:"w-[300px] p-0",children:e.jsxs(ge,{children:[e.jsx(fe,{placeholder:"Search agents...",value:h,onValueChange:i}),e.jsx(ye,{children:l?e.jsx(U,{children:"Loading..."}):m.length===0?e.jsx(U,{children:"No agents found."}):e.jsxs(e.Fragment,{children:[e.jsx(W,{children:e.jsxs(J,{onSelect:y,className:"justify-between",children:[e.jsx("span",{children:"Select All"}),e.jsx(R,{className:k("h-4 w-4",x.length===r.length?"opacity-100":"opacity-0")})]})}),e.jsx(W,{heading:"Agents",children:e.jsx($,{className:"h-[200px]",children:m.map(c=>e.jsxs(J,{onSelect:()=>j(c._id),className:"justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("span",{className:"text-sm",children:[c.firstName," ",c.lastName,c._id===s.user?.userId&&e.jsx("span",{className:"text-muted-foreground ml-2 text-xs",children:"(You)"})]}),c.email&&e.jsx("span",{className:"text-muted-foreground text-xs",children:c.email})]}),e.jsx(R,{className:k("h-4 w-4",x.includes(c._id)?"opacity-100":"opacity-0")})]},c._id))})})]})}),x.length>0&&e.jsx("div",{className:"border-t p-2",children:e.jsx(w,{variant:"ghost",size:"sm",onClick:f,className:"w-full",children:"Clear selection"})})]})})]})}const _s=[[{number:0,name:"Jan"},{number:1,name:"Feb"},{number:2,name:"Mar"},{number:3,name:"Apr"}],[{number:4,name:"May"},{number:5,name:"Jun"},{number:6,name:"Jul"},{number:7,name:"Aug"}],[{number:8,name:"Sep"},{number:9,name:"Oct"},{number:10,name:"Nov"},{number:11,name:"Dec"}]];function De({onMonthSelect:t,selectedMonth:n,minDate:s,maxDate:d,disabledDates:o,callbacks:r,onYearBackward:a,onYearForward:l,variant:u,className:h,...i}){return e.jsx("div",{className:k("w-[280px] min-w-[200px] p-3",h),...i,children:e.jsx("div",{className:"flex flex-col space-y-4 sm:flex-row sm:space-y-0 sm:space-x-4",children:e.jsx("div",{className:"w-full space-y-4",children:e.jsx(Bs,{onMonthSelect:t,callbacks:r,selectedMonth:n,onYearBackward:a,onYearForward:l,variant:u,minDate:s,maxDate:d,disabledDates:o})})})})}function Bs({selectedMonth:t,onMonthSelect:n,callbacks:s,variant:d,minDate:o,maxDate:r,disabledDates:a,onYearBackward:l,onYearForward:u}){const[h,i]=g.useState(t?.getFullYear()??new Date().getFullYear()),[x,N]=g.useState(t?.getMonth()??new Date().getMonth()),[j,y]=g.useState(h);o&&r&&o>r&&(o=r);const f=a?.map(m=>({year:m.getFullYear(),month:m.getMonth()}));return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative flex items-center justify-center pt-1",children:[e.jsx("div",{className:"text-sm font-medium",children:s?.yearLabel?s?.yearLabel(j):j}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{onClick:()=>{y(j-1),l&&l()},className:k(Q({variant:d?.chevrons??"outline"}),"absolute left-1 inline-flex h-7 w-7 items-center justify-center p-0"),children:e.jsx(os,{className:"h-4 w-4 opacity-50"})}),e.jsx("button",{onClick:()=>{y(j+1),u&&u()},className:k(Q({variant:d?.chevrons??"outline"}),"absolute right-1 inline-flex h-7 w-7 items-center justify-center p-0"),children:e.jsx(qe,{className:"h-4 w-4 opacity-50"})})]})]}),e.jsx("table",{className:"w-full border-collapse space-y-1",children:e.jsx("tbody",{children:_s.map((m,c)=>e.jsx("tr",{className:"mt-2 flex w-full",children:m.map(p=>e.jsx("td",{className:"[&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent relative h-10 w-1/4 p-0 text-center text-sm focus-within:relative focus-within:z-20 first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md [&:has([aria-selected].day-range-end)]:rounded-r-md",children:e.jsx("button",{onClick:()=>{N(p.number),i(j),n&&n(new Date(j,p.number))},disabled:(r?j>r?.getFullYear()||j==r?.getFullYear()&&p.number>r.getMonth():!1)||(o?j<o?.getFullYear()||j==o?.getFullYear()&&p.number<o.getMonth():!1)||(f?f?.some(v=>v.year==j&&v.month==p.number):!1),className:k(Q({variant:x==p.number&&j==h?d?.calendar?.selected??"default":d?.calendar?.main??"ghost"}),"h-full w-full p-0 font-normal aria-selected:opacity-100"),children:s?.monthLabel?s.monthLabel(p):p.name})},p.number))},"row-"+c))})})]})}De.displayName="MonthPicker";function Fs(){const{selectedDate:t,setSelectedDate:n,filters:s,setFilters:d,calendarView:o}=_(),r=a=>{if(!a)return;n(a);let l,u;switch(o){case"dayGridMonth":{const h=new Date(a.getFullYear(),a.getMonth(),1),i=new Date(a.getFullYear(),a.getMonth()+1,0,23,59,59);l=Math.floor(h.getTime()/1e3),u=Math.floor(i.getTime()/1e3);break}case"timeGridWeek":{const h=new Date(a);h.setDate(a.getDate()-a.getDay()),h.setHours(0,0,0,0);const i=new Date(h);i.setDate(h.getDate()+6),i.setHours(23,59,59,999),l=Math.floor(h.getTime()/1e3),u=Math.floor(i.getTime()/1e3);break}case"timeGridDay":{const h=new Date(a);h.setHours(0,0,0,0);const i=new Date(a);i.setHours(23,59,59,999),l=Math.floor(h.getTime()/1e3),u=Math.floor(i.getTime()/1e3);break}default:return}d({...s,startTime:l,endTime:u})};return e.jsxs(oe,{children:[e.jsx(ie,{asChild:!0,children:e.jsxs(w,{variant:"outline",className:k("w-[280px] justify-start text-left font-normal",!t&&"text-muted-foreground"),children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),t?b(t,"PPP"):e.jsx("span",{children:"Pick a date"})]})}),e.jsx(ce,{className:"w-auto p-0",children:o==="dayGridMonth"?e.jsx(De,{selectedMonth:t,onMonthSelect:r}):e.jsx(Je,{mode:"single",selected:t,onSelect:r,initialFocus:!0})})]})}function Ps(){const{filters:t,setFilters:n}=_(),[s,d]=g.useState(!1),[o,r]=g.useState([]),[a,l]=g.useState(!1),[u,h]=g.useState(""),i=t.properties?.split(",").filter(Boolean)||[];g.useEffect(()=>{x()},[]);const x=async()=>{l(!0);try{const m=await q.post("/api/property/admin/search",{page:1,limit:100,searchTerm:""});r(m.properties||[])}catch{}finally{l(!1)}},N=m=>{const c=i.includes(m);let p;c?p=i.filter(v=>v!==m):p=[...i,m],n({...t,properties:p.join(",")})},j=()=>{i.length===o.length?n({...t,properties:""}):n({...t,properties:o.map(m=>m._id).join(",")})},y=()=>{n({...t,properties:""})},f=o.filter(m=>m.address.toLowerCase().includes(u.toLowerCase())||m.city?.toLowerCase().includes(u.toLowerCase()));return e.jsxs(oe,{open:s,onOpenChange:d,children:[e.jsx(ie,{asChild:!0,children:e.jsxs(w,{variant:"outline",role:"combobox","aria-expanded":s,className:"justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-4 w-4"}),e.jsx("span",{children:"Properties"}),i.length>0&&e.jsx(B,{variant:"secondary",className:"ml-2",children:i.length})]}),e.jsx(Ce,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(ce,{className:"w-[300px] p-0",children:e.jsxs(ge,{children:[e.jsx(fe,{placeholder:"Search properties...",value:u,onValueChange:h}),e.jsx(ye,{children:a?e.jsx(U,{children:"Loading..."}):f.length===0?e.jsx(U,{children:"No properties found."}):e.jsxs(e.Fragment,{children:[e.jsx(W,{children:e.jsxs(J,{onSelect:j,className:"justify-between",children:[e.jsx("span",{children:"Select All"}),e.jsx(R,{className:k("h-4 w-4",i.length===o.length?"opacity-100":"opacity-0")})]})}),e.jsx(W,{heading:"Properties",children:e.jsx($,{className:"h-[200px]",children:f.map(m=>e.jsxs(J,{onSelect:()=>N(m._id),className:"justify-between",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm",children:m.address}),m.city&&e.jsxs("span",{className:"text-muted-foreground text-xs",children:[m.city,", ",m.state]})]}),e.jsx(R,{className:k("h-4 w-4",i.includes(m._id)?"opacity-100":"opacity-0")})]},m._id))})})]})}),i.length>0&&e.jsx("div",{className:"border-t p-2",children:e.jsx(w,{variant:"ghost",size:"sm",onClick:y,className:"w-full",children:"Clear selection"})})]})})]})}function Hs(){const{calendarView:t,setCalendarView:n,setSelectedDate:s,filters:d,setFilters:o}=_(),r=a=>{if(a==="today"){const l=new Date;s(l),n("timeGridDay");const u=new Date(l);u.setHours(0,0,0,0);const h=new Date(l);h.setHours(23,59,59,999),o({...d,startTime:Math.floor(u.getTime()/1e3),endTime:Math.floor(h.getTime()/1e3)})}else{n(a);const l=new Date;let u,h;switch(a){case"dayGridMonth":{const i=new Date(l.getFullYear(),l.getMonth(),1),x=new Date(l.getFullYear(),l.getMonth()+1,0,23,59,59);u=Math.floor(i.getTime()/1e3),h=Math.floor(x.getTime()/1e3);break}case"timeGridWeek":{const i=new Date(l);i.setDate(l.getDate()-l.getDay()),i.setHours(0,0,0,0);const x=new Date(i);x.setDate(i.getDate()+6),x.setHours(23,59,59,999),u=Math.floor(i.getTime()/1e3),h=Math.floor(x.getTime()/1e3);break}case"timeGridDay":{const i=new Date(l);i.setHours(0,0,0,0);const x=new Date(l);x.setHours(23,59,59,999),u=Math.floor(i.getTime()/1e3),h=Math.floor(x.getTime()/1e3);break}}o({...d,startTime:u,endTime:h})}};return e.jsxs("div",{className:"flex rounded-md shadow-sm",role:"group",children:[e.jsxs(w,{type:"button",variant:"outline",size:"sm",onClick:()=>r("today"),className:"rounded-r-none",children:[e.jsx(ss,{className:"mr-1 h-4 w-4"}),"Today"]}),e.jsxs(w,{type:"button",variant:t==="timeGridDay"?"default":"outline",size:"sm",onClick:()=>r("timeGridDay"),className:"rounded-none border-l-0",children:[e.jsx(le,{className:"mr-1 h-4 w-4"}),"Day"]}),e.jsxs(w,{type:"button",variant:t==="timeGridWeek"?"default":"outline",size:"sm",onClick:()=>r("timeGridWeek"),className:"rounded-none border-l-0",children:[e.jsx(rs,{className:"mr-1 h-4 w-4"}),"Week"]}),e.jsxs(w,{type:"button",variant:t==="dayGridMonth"?"default":"outline",size:"sm",onClick:()=>r("dayGridMonth"),className:"rounded-l-none border-l-0",children:[e.jsx(as,{className:"mr-1 h-4 w-4"}),"Month"]})]})}function As({children:t}){const n=_e({strict:!1}),[s,d]=g.useState("calendar"),[o,r]=g.useState("dayGridMonth"),[a,l]=g.useState(new Date),[u,h]=g.useState(null),[i,x]=g.useState(!1),[N,j]=g.useState(!1),[y,f]=g.useState(!1),m=new Date,c=new Date(m.getFullYear(),m.getMonth(),1),p=new Date(m.getFullYear(),m.getMonth()+1,0,23,59,59),[v,F]=g.useState({startTime:Math.floor(c.getTime()/1e3),endTime:Math.floor(p.getTime()/1e3),companies:n.company||void 0});return g.useEffect(()=>{F(K=>({...K,companies:n.company||void 0}))},[n.company]),e.jsx(Se.Provider,{value:{view:s,setView:d,calendarView:o,setCalendarView:r,filters:v,setFilters:F,selectedDate:a,setSelectedDate:l,selectedBooking:u,setSelectedBooking:h,showCreateModal:i,setShowCreateModal:x,showEditModal:N,setShowEditModal:j,showDetailsModal:y,setShowDetailsModal:f},children:t})}function Vs(){const{setShowCreateModal:t}=_();return e.jsxs(e.Fragment,{children:[e.jsxs(Fe,{fixed:!0,children:[e.jsx(Pe,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(He,{}),e.jsx(Ae,{}),e.jsx(Ve,{})]})]}),e.jsxs(Le,{children:[e.jsxs("div",{className:"mb-2 flex flex-wrap items-center justify-between space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Bookings Calendar"}),e.jsx("p",{className:"text-muted-foreground",children:"View and manage all property showings and appointments"})]}),e.jsxs(w,{onClick:()=>t(!0),children:[e.jsx(Ze,{className:"mr-2 h-4 w-4"}),"New Booking"]})]}),e.jsxs("div",{className:"mb-4 flex flex-wrap items-center gap-2",children:[e.jsx(Fs,{}),e.jsx(Ps,{}),e.jsx(Ts,{}),e.jsx("div",{className:"ml-auto",children:e.jsx(Hs,{})})]}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1",children:e.jsx(Ns,{})})]}),e.jsx(ks,{}),e.jsx(Ds,{}),e.jsx(us,{})]})}function Ls(){return e.jsx(As,{children:e.jsx(Vs,{})})}const jt=Ls;export{jt as component};
