import{r as g,j as e,B as w,d as I,h as L,t as v}from"./index-CvyRkeE5.js";import{d as B,e as q,f as $,H as G,S as J,a as Q,T as W,P as X,M as Y}from"./header-company-dropdown-CQYbnI8v.js";import{C as E}from"./checkbox-DQAukn5y.js";import{L as P}from"./long-text-B2UXBo_g.js";import{D as N}from"./data-table-column-header-DAw5f9Xg.js";import{D as Z,e as ee,f as se,i as ne}from"./avatar-_2VmutPB.js";import{E as ae,P as re}from"./pencil-CAZF0lsn.js";import{u as _,a as k,F as T,b as d,c as t,d as h,e as l,f as i}from"./form-BBbFGrnZ.js";import{D as O,g as A,h as U,i as V,j as M,k as R}from"./command-DTdQs4HX.js";import{I as m}from"./input-5vX5qBNK.js";import{T as H}from"./textarea-DtY41fJS.js";import{o as F,i as oe,s as u,l as te}from"./types-Wky072k2.js";import{P as le}from"./plus-CTHQPs9u.js";import{u as ie,D as ce}from"./use-data-table-BURvSaac.js";import"./separator-D1ovcUFg.js";import"./index-DCzpbC7R.js";import"./createReactComponent-DcxUhOxs.js";import"./select-yRulkKwZ.js";import"./index-Bb0YeX9p.js";import"./index-bd6ufVwP.js";import"./index-Bt6K678h.js";import"./index-fHPixuyN.js";import"./index-Qfb_IjkA.js";import"./index-BYO_HMiJ.js";import"./check-DOj7a-5i.js";import"./index-ChHWVpPk.js";import"./popover-NdNb9ebW.js";import"./react-icons.esm-hx67oMTw.js";import"./index-rpDruwTI.js";import"./table-CtXYL8Fg.js";const K=g.createContext(void 0);function D(){const s=g.useContext(K);if(!s)throw new Error("useCompaniesContext must be used within CompaniesProvider");return s}function de({row:s}){const n=s.original,{setEditingCompany:a,setIsEditDialogOpen:p}=D(),j=()=>{a(n),p(!0)};return e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:e.jsxs(w,{variant:"ghost",className:"h-8 w-8 p-0 data-[state=open]:bg-muted",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(ae,{className:"h-4 w-4"})]})}),e.jsx(se,{align:"end",className:"w-[160px]",children:e.jsxs(ne,{onClick:j,children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Edit"]})})]})}const me=[{id:"select",header:({table:s})=>e.jsx(E,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:n=>s.toggleAllPageRowsSelected(!!n),"aria-label":"Select all",className:"translate-y-[2px]"}),meta:{className:I("sticky md:table-cell left-0 z-10 rounded-tl","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted")},cell:({row:s})=>e.jsx(E,{checked:s.getIsSelected(),onCheckedChange:n=>s.toggleSelected(!!n),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:({column:s})=>e.jsx(N,{column:s,title:"Company Name"}),cell:({row:s})=>e.jsxs("div",{className:"flex items-center space-x-2",children:[s.original.logoUrl&&e.jsx("img",{src:s.original.logoUrl,alt:s.getValue("name"),className:"h-8 w-8 rounded object-cover"}),e.jsx(P,{className:"max-w-48 font-medium",children:s.getValue("name")})]}),meta:{className:I("drop-shadow-[0_1px_2px_rgb(0_0_0_/_0.1)] dark:drop-shadow-[0_1px_2px_rgb(255_255_255_/_0.1)] lg:drop-shadow-none","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted","sticky left-6 md:table-cell")},enableHiding:!1},{accessorKey:"email",header:({column:s})=>e.jsx(N,{column:s,title:"Email"}),cell:({row:s})=>{const n=s.getValue("email");return n?e.jsx("a",{href:`mailto:${n}`,className:"text-blue-600 hover:underline",children:n}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}},{accessorKey:"phone",header:({column:s})=>e.jsx(N,{column:s,title:"Phone"}),cell:({row:s})=>{const n=s.getValue("phone");return n?e.jsx("div",{className:"text-nowrap",children:n}):e.jsx("span",{className:"text-muted-foreground",children:"-"})},enableSorting:!1},{id:"address",header:({column:s})=>e.jsx(N,{column:s,title:"Location"}),cell:({row:s})=>{const{address:n}=s.original;if(!n||!n.city&&!n.state&&!n.country)return e.jsx("span",{className:"text-muted-foreground",children:"-"});const a=[n.city,n.state,n.country].filter(Boolean);return e.jsx(P,{className:"max-w-48",children:a.join(", ")})},filterFn:(s,n,a)=>{const{address:p}=s.original;if(!p)return!1;const j=a.toLowerCase();return p.city?.toLowerCase().includes(j)||p.state?.toLowerCase().includes(j)||p.country?.toLowerCase().includes(j)||!1}},{accessorKey:"units",header:({column:s})=>e.jsx(N,{column:s,title:"Units"}),cell:({row:s})=>{const n=s.getValue("units");return n?e.jsx("div",{className:"text-center",children:n}):e.jsx("span",{className:"text-muted-foreground text-center",children:"-"})}},{accessorKey:"description",header:({column:s})=>e.jsx(N,{column:s,title:"Description"}),cell:({row:s})=>{const n=s.getValue("description");return n?e.jsx(P,{className:"max-w-64",children:n}):e.jsx("span",{className:"text-muted-foreground",children:"-"})},enableSorting:!1},{id:"actions",cell:de}],z=F({name:u().min(1,"Company name is required").trim(),idImage:u().optional(),units:u().optional(),address:F({street:u().optional(),city:u().optional(),state:u().optional(),postalCode:u().optional(),country:u().optional()}).optional(),phone:u().optional(),email:u().email("Invalid email address").optional().or(te("")),description:u().optional(),logo:oe(File).optional()});function xe(){const{isCreateDialogOpen:s,setIsCreateDialogOpen:n}=D(),a=B(),[p,j]=g.useState(null),c=_({resolver:k(z),defaultValues:{name:"",idImage:"",units:"",address:{street:"",city:"",state:"",postalCode:"",country:""},phone:"",email:"",description:""}}),y=async r=>{try{await a.mutateAsync(r),v.success("Company created successfully"),c.reset(),j(null),n(!1)}catch{v.error("Failed to create company")}},x=r=>{const C=r.target.files?.[0];if(C){c.setValue("logo",C);const f=new FileReader;f.onloadend=()=>{j(f.result)},f.readAsDataURL(C)}};return e.jsx(O,{open:s,onOpenChange:n,children:e.jsxs(A,{className:"sm:max-w-[625px]",children:[e.jsxs(U,{children:[e.jsx(V,{children:"Create Company"}),e.jsx(M,{children:"Add a new company to your system. Fill in the company details below."})]}),e.jsx(T,{...c,children:e.jsxs("form",{onSubmit:c.handleSubmit(y),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{control:c.control,name:"name",render:({field:r})=>e.jsxs(t,{className:"col-span-2",children:[e.jsx(h,{children:"Company Name *"}),e.jsx(l,{children:e.jsx(m,{placeholder:"Enter company name",...r})}),e.jsx(i,{})]})}),e.jsx(d,{control:c.control,name:"email",render:({field:r})=>e.jsxs(t,{children:[e.jsx(h,{children:"Email"}),e.jsx(l,{children:e.jsx(m,{type:"email",placeholder:"company@example.com",...r})}),e.jsx(i,{})]})}),e.jsx(d,{control:c.control,name:"phone",render:({field:r})=>e.jsxs(t,{children:[e.jsx(h,{children:"Phone"}),e.jsx(l,{children:e.jsx(m,{placeholder:"+1 (555) 000-0000",...r})}),e.jsx(i,{})]})}),e.jsx(d,{control:c.control,name:"units",render:({field:r})=>e.jsxs(t,{children:[e.jsx(h,{children:"Units"}),e.jsx(l,{children:e.jsx(m,{placeholder:"Number of units",...r})}),e.jsx(i,{})]})}),e.jsx(d,{control:c.control,name:"idImage",render:({field:r})=>e.jsxs(t,{children:[e.jsx(h,{children:"ID Image"}),e.jsx(l,{children:e.jsx(m,{placeholder:"Image ID",...r})}),e.jsx(i,{})]})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(h,{children:"Address"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-2",children:[e.jsx(d,{control:c.control,name:"address.street",render:({field:r})=>e.jsxs(t,{className:"col-span-2",children:[e.jsx(l,{children:e.jsx(m,{placeholder:"Street address",...r})}),e.jsx(i,{})]})}),e.jsx(d,{control:c.control,name:"address.city",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(m,{placeholder:"City",...r})}),e.jsx(i,{})]})}),e.jsx(d,{control:c.control,name:"address.state",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(m,{placeholder:"State/Province",...r})}),e.jsx(i,{})]})}),e.jsx(d,{control:c.control,name:"address.postalCode",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(m,{placeholder:"Postal code",...r})}),e.jsx(i,{})]})}),e.jsx(d,{control:c.control,name:"address.country",render:({field:r})=>e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(m,{placeholder:"Country",...r})}),e.jsx(i,{})]})})]})]}),e.jsx(d,{control:c.control,name:"description",render:({field:r})=>e.jsxs(t,{className:"col-span-2",children:[e.jsx(h,{children:"Description"}),e.jsx(l,{children:e.jsx(H,{placeholder:"Enter company description",className:"resize-none",rows:3,...r})}),e.jsx(i,{})]})}),e.jsxs(t,{className:"col-span-2",children:[e.jsx(h,{children:"Company Logo"}),e.jsx(l,{children:e.jsx(m,{type:"file",accept:"image/*",onChange:x})}),p&&e.jsx("img",{src:p,alt:"Logo preview",className:"mt-2 h-20 w-20 rounded object-cover"}),e.jsx(i,{})]})]}),e.jsxs(R,{children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>n(!1),children:"Cancel"}),e.jsxs(w,{type:"submit",disabled:a.isPending,children:[a.isPending&&e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Company"]})]})]})})]})})}function pe(){const{isEditDialogOpen:s,setIsEditDialogOpen:n,editingCompany:a,setEditingCompany:p}=D(),j=q(),[c,y]=g.useState(null),x=_({resolver:k(z),defaultValues:{name:"",idImage:"",units:"",address:{street:"",city:"",state:"",postalCode:"",country:""},phone:"",email:"",description:""}});g.useEffect(()=>{a&&(x.reset({name:a.name||"",idImage:a.idImage||"",units:a.units||"",address:{street:a.address?.street||"",city:a.address?.city||"",state:a.address?.state||"",postalCode:a.address?.postalCode||"",country:a.address?.country||""},phone:a.phone||"",email:a.email||"",description:a.description||""}),y(a.logoUrl||null))},[a,x]);const r=async o=>{if(a)try{await j.mutateAsync({_id:a._id,...o}),v.success("Company updated successfully"),f()}catch{v.error("Failed to update company")}},C=o=>{const b=o.target.files?.[0];if(b){x.setValue("logo",b);const S=new FileReader;S.onloadend=()=>{y(S.result)},S.readAsDataURL(b)}},f=()=>{n(!1),p(null),x.reset(),y(null)};return e.jsx(O,{open:s,onOpenChange:n,children:e.jsxs(A,{className:"sm:max-w-[625px]",children:[e.jsxs(U,{children:[e.jsx(V,{children:"Edit Company"}),e.jsx(M,{children:"Update company details. Changes will be saved immediately."})]}),e.jsx(T,{...x,children:e.jsxs("form",{onSubmit:x.handleSubmit(r),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{control:x.control,name:"name",render:({field:o})=>e.jsxs(t,{className:"col-span-2",children:[e.jsx(h,{children:"Company Name *"}),e.jsx(l,{children:e.jsx(m,{placeholder:"Enter company name",...o})}),e.jsx(i,{})]})}),e.jsx(d,{control:x.control,name:"email",render:({field:o})=>e.jsxs(t,{children:[e.jsx(h,{children:"Email"}),e.jsx(l,{children:e.jsx(m,{type:"email",placeholder:"company@example.com",...o})}),e.jsx(i,{})]})}),e.jsx(d,{control:x.control,name:"phone",render:({field:o})=>e.jsxs(t,{children:[e.jsx(h,{children:"Phone"}),e.jsx(l,{children:e.jsx(m,{placeholder:"+1 (555) 000-0000",...o})}),e.jsx(i,{})]})}),e.jsx(d,{control:x.control,name:"units",render:({field:o})=>e.jsxs(t,{children:[e.jsx(h,{children:"Units"}),e.jsx(l,{children:e.jsx(m,{placeholder:"Number of units",...o})}),e.jsx(i,{})]})}),e.jsx(d,{control:x.control,name:"idImage",render:({field:o})=>e.jsxs(t,{children:[e.jsx(h,{children:"ID Image"}),e.jsx(l,{children:e.jsx(m,{placeholder:"Image ID",...o})}),e.jsx(i,{})]})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx(h,{children:"Address"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-2",children:[e.jsx(d,{control:x.control,name:"address.street",render:({field:o})=>e.jsxs(t,{className:"col-span-2",children:[e.jsx(l,{children:e.jsx(m,{placeholder:"Street address",...o})}),e.jsx(i,{})]})}),e.jsx(d,{control:x.control,name:"address.city",render:({field:o})=>e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(m,{placeholder:"City",...o})}),e.jsx(i,{})]})}),e.jsx(d,{control:x.control,name:"address.state",render:({field:o})=>e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(m,{placeholder:"State/Province",...o})}),e.jsx(i,{})]})}),e.jsx(d,{control:x.control,name:"address.postalCode",render:({field:o})=>e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(m,{placeholder:"Postal code",...o})}),e.jsx(i,{})]})}),e.jsx(d,{control:x.control,name:"address.country",render:({field:o})=>e.jsxs(t,{children:[e.jsx(l,{children:e.jsx(m,{placeholder:"Country",...o})}),e.jsx(i,{})]})})]})]}),e.jsx(d,{control:x.control,name:"description",render:({field:o})=>e.jsxs(t,{className:"col-span-2",children:[e.jsx(h,{children:"Description"}),e.jsx(l,{children:e.jsx(H,{placeholder:"Enter company description",className:"resize-none",rows:3,...o})}),e.jsx(i,{})]})}),e.jsxs(t,{className:"col-span-2",children:[e.jsx(h,{children:"Company Logo"}),e.jsx(l,{children:e.jsx(m,{type:"file",accept:"image/*",onChange:C})}),c&&e.jsx("img",{src:c,alt:"Logo preview",className:"mt-2 h-20 w-20 rounded object-cover"}),e.jsx(i,{})]})]}),e.jsxs(R,{children:[e.jsx(w,{type:"button",variant:"outline",onClick:f,children:"Cancel"}),e.jsxs(w,{type:"submit",disabled:j.isPending,children:[j.isPending&&e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Update Company"]})]})]})})]})})}function je(){return e.jsxs(e.Fragment,{children:[e.jsx(xe,{}),e.jsx(pe,{})]})}function he(){const{setIsCreateDialogOpen:s}=D();return e.jsxs(w,{size:"sm",onClick:()=>s(!0),children:[e.jsx(le,{className:"mr-2 h-4 w-4"}),"Add Company"]})}function ue({columns:s,data:n,isLoading:a}){const{table:p}=ie({data:n,columns:s});return e.jsx(ce,{table:p,columns:s,isLoading:a,searchColumn:"name",searchPlaceholder:"Filter companies..."})}function ge({children:s}){const[n,a]=g.useState(!1),[p,j]=g.useState(!1),[c,y]=g.useState(null);return e.jsx(K.Provider,{value:{isCreateDialogOpen:n,setIsCreateDialogOpen:a,isEditDialogOpen:p,setIsEditDialogOpen:j,editingCompany:c,setEditingCompany:y},children:s})}function ye(){const[s,n]=g.useState(1),[a]=g.useState(10),{data:p,isLoading:j,error:c}=$({page:s,limit:a,isAdmin:!0}),y=p?.companies||[];return c?e.jsx("div",{className:"flex h-screen items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Error loading companies"}),e.jsx("p",{className:"text-muted-foreground",children:"Please try again later"})]})}):e.jsxs(ge,{children:[e.jsxs(G,{fixed:!0,children:[e.jsx(J,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Q,{}),e.jsx(W,{}),e.jsx(X,{})]})]}),e.jsxs(Y,{children:[e.jsxs("div",{className:"mb-2 flex flex-wrap items-center justify-between space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Companies"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your companies and their information here."})]}),e.jsx(he,{})]}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-y-0 lg:space-x-12",children:e.jsx(ue,{data:y,columns:me,isLoading:j})})]}),e.jsx(je,{})]})}const Qe=function(){return e.jsx(ye,{})};export{Qe as component};
