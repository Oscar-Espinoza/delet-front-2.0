import{c as Q,r as j,j as e,B as b,d as G,f as Oe,t as L,a as Ke}from"./index-CsPbyjqq.js";import{A as z,a as B,I as ke}from"./alert-BtjweUsc.js";import{c as N,u as Te,b as qe,q as oe,H as De,S as Pe,a as Ie,T as $e,P as _e,M as Ve}from"./theme-switch-BkO31Og6.js";import{C as J}from"./checkbox-CKYs508e.js";import{D as q}from"./data-table-column-header-CQlxrAjV.js";import{D as Le,M as Fe,a as Me}from"./react-icons.esm-B0xYXpOp.js";import{D as le,e as Ee,f as de,i as _,h as ce,p as Re,B as ze,g as Be,z as He}from"./avatar-Dwr00yMn.js";import{E as Qe}from"./eye-BiAFW7AU.js";import{F as Ue}from"./file-text-D6t6uW1t.js";import{T as me}from"./trash-2-BmQajcTX.js";import{f as X}from"./format-BvUxDbfm.js";import{u as We,a as Ye,g as Ze,F as Ge,b as S,c as O,d as K,e as D,h as I,f as P}from"./form-DKoAMwr-.js";import{C as ee,a as se,b as te,d as ae}from"./card-gPuprvU5.js";import{D as ue,a as pe,b as xe,c as he,d as ge,e as Je}from"./command-DOxIIFlo.js";import{I as H}from"./input-5SQVrAtH.js";import{S as Xe,a as es,b as ss,c as ts,d as V}from"./select-CcSKRIFJ.js";import{S as as}from"./switch-BrAoGB8w.js";import{T as rs}from"./textarea-DKq9H4p7.js";import{c as ns,A as is}from"./use-billing-entities-CIdFcuy3.js";import{C as os}from"./company-select-CKLOAwIm.js";import{o as C,s as p,b as ls,a as U,c as w,e as je,u as W,f as ds}from"./types-Wky072k2.js";import{P as cs}from"./plus-ddirbNEh.js";import{B as re}from"./badge-Dwoct147.js";import{S as ne}from"./separator-c02Ge6Zo.js";import{I as ms}from"./IconPlus-DZ4QqQhf.js";import{u as us,D as ps}from"./use-data-table-Cl1qhkDL.js";import"./createReactComponent-BW_frDSn.js";import"./index-D3GDyaHS.js";import"./index-BB0IJgGb.js";import"./index-DSb8P5hH.js";import"./index-BjDkRKFr.js";import"./check-D2987ydO.js";import"./index-BWqx2Go7.js";import"./index-DZz0vwHh.js";import"./index-DMPFB69W.js";import"./index-DMmlQz9C.js";import"./index-CzDhUyC5.js";import"./map-pin-eHjt42m6.js";import"./table-D4KWq3W4.js";/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],hs=Q("info",xs);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],js=Q("square-pen",gs);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ys=Q("triangle-alert",fs),fe=j.createContext(null);function F(){const s=j.useContext(fe);if(!s)throw new Error("useOrdersContext must be used within an OrdersProvider");return s}function vs({row:s}){const{setIsViewDialogOpen:a,setViewingOrder:t}=F(),r=s.original,n=()=>{t(r),a(!0)};return e.jsxs(le,{children:[e.jsx(Ee,{asChild:!0,children:e.jsxs(b,{variant:"ghost",className:"data-[state=open]:bg-muted flex h-8 w-8 p-0",children:[e.jsx(Le,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Open menu"})]})}),e.jsxs(de,{align:"end",className:"w-[160px]",children:[e.jsxs(_,{onClick:n,children:[e.jsx(Qe,{className:"mr-2 h-4 w-4"}),"View Details"]}),e.jsxs(_,{children:[e.jsx(js,{className:"mr-2 h-4 w-4"}),"Edit Order"]}),e.jsxs(_,{children:[e.jsx(Ue,{className:"mr-2 h-4 w-4"}),"View Invoice"]}),e.jsx(ce,{}),e.jsxs(_,{className:"text-red-600",children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),"Delete",e.jsx(Re,{children:"⌘⌫"})]})]})]})}const bs=50,Ns=[{id:"select",header:({table:s})=>e.jsx(J,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:a=>s.toggleAllPageRowsSelected(!!a),"aria-label":"Select all",className:"translate-y-[2px]"}),meta:{className:G("sticky md:table-cell left-0 z-10 rounded-tl","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted")},cell:({row:s})=>e.jsx(J,{checked:s.getIsSelected(),onCheckedChange:a=>s.toggleSelected(!!a),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{id:"customer",header:({column:s})=>e.jsx(q,{column:s,title:"Customer"}),cell:({row:s})=>{const a=s.original.user;if(typeof a=="string")return e.jsxs("div",{children:["User ID: ",a]});const t=`${a.firstName||""} ${a.lastName||""}`.trim()||a.email;return e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t}),e.jsx("div",{className:"text-muted-foreground text-xs",children:a.email})]})},filterFn:(s,a,t)=>{const r=s.original.user;if(typeof r=="string")return r.toLowerCase().includes(t.toLowerCase());const n=`${r.firstName||""} ${r.lastName||""}`.trim()||r.email,o=t.toLowerCase();return n.toLowerCase().includes(o)||r.email.toLowerCase().includes(o)},meta:{className:G("drop-shadow-[0_1px_2px_rgb(0_0_0_/_0.1)] dark:drop-shadow-[0_1px_2px_rgb(255_255_255_/_0.1)] lg:drop-shadow-none","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted","sticky left-6 md:table-cell")},enableHiding:!1},{accessorKey:"quantity",header:({column:s})=>e.jsx(q,{column:s,title:"Quantity"}),cell:({row:s})=>e.jsx("div",{className:"text-center",children:s.getValue("quantity")})},{id:"company",header:({column:s})=>e.jsx(q,{column:s,title:"Company"}),cell:({row:s})=>{const a=s.original.company,t=typeof a=="object"?a.name:"N/A";return e.jsx("div",{className:"w-fit text-nowrap",children:t})}},{id:"addresses",header:({column:s})=>e.jsx(q,{column:s,title:"Addresses"}),cell:({row:s})=>{const a=s.original.deliveryAddresses;if(!a||a.length===0)return e.jsx("span",{className:"text-muted-foreground",children:"No addresses"});const t=a.length;return e.jsx("div",{className:"text-center",children:t===1?"1 address":`${t} addresses`})}},{id:"total",header:({column:s})=>e.jsx(q,{column:s,title:"Total"}),cell:({row:s})=>{const t=s.original.quantity*bs;return e.jsxs("div",{className:"text-right font-medium",children:["$",t.toFixed(2)]})}},{accessorKey:"createdAt",header:({column:s})=>e.jsx(q,{column:s,title:"Created"}),cell:({row:s})=>{const a=s.getValue("createdAt"),t=new Date(a*1e3);return e.jsxs("div",{className:"text-nowrap",children:[X(t,"MMM dd, yyyy"),e.jsx("div",{className:"text-muted-foreground text-xs",children:X(t,"h:mm a")})]})}},{id:"actions",cell:vs}],ws=je(["purchase","service"]),Cs=je(["waiting for payment information","assembling kits","complete","paid","cancelled",""]),As=W([p(),C({_id:p(),code:p(),percentage:w()}),ds()]),Ss=W([p(),C({_id:p(),name:p()})]),Os=W([p(),C({_id:p(),email:p(),firstName:p().optional(),lastName:p().optional()})]),ye=C({street:p().min(1,"Street is required"),city:p().min(1,"City is required"),state:p().min(1,"State is required"),zipCode:p().min(1,"Zip code is required"),country:p().min(1,"Country is required")}),Ks=C({_id:p(),user:Os,type:ws,discount:As.optional(),status:Cs,notes:p().optional(),deliveryAddresses:U(C({address:ye,quantity:w(),assignedKits:w().optional()})).optional(),quantity:w(),createdAt:w(),company:Ss});U(Ks);const ks=C({quantity:w().min(1),companyId:p().min(1,"Company is required"),addresses:U(C({address:ye,quantity:w().min(1),assignedKits:w().min(0).optional()})),provideShippingLater:ls(),notes:p().optional(),billingEntityId:p().optional()}).refine(s=>s.provideShippingLater?!0:s.addresses.reduce((t,r)=>t+(r.assignedKits||0),0)===s.quantity,{message:"Total assigned kits must equal total quantity when not providing shipping later",path:["addresses"]}),Ts=s=>({"waiting for payment information":"Waiting for Payment","assembling kits":"Assembling Kits",complete:"Complete",paid:"Paid",cancelled:"Cancelled","":"Unknown"})[s]||s,qs=s=>({purchase:"Purchase",service:"Service"})[s]||s,Ds=s=>({"waiting for payment information":"text-yellow-600 bg-yellow-50","assembling kits":"text-blue-600 bg-blue-50",complete:"text-green-600 bg-green-50",paid:"text-green-600 bg-green-50",cancelled:"text-red-600 bg-red-50","":"text-gray-600 bg-gray-50"})[s]||"text-gray-600 bg-gray-50",ve={getOrders:async(s={})=>{const{page:a=1,pageSize:t=10,sortBy:r="createdAt",sortOrder:n="desc",search:o="",company:m,user:u,type:x,status:i,createdAtFrom:c,createdAtTo:A,isAdmin:M}=s,f=new URLSearchParams({page:a.toString(),pageSize:t.toString(),sortBy:r,sortOrder:n});o&&f.append("search",o),m&&f.append("company",m),u&&f.append("user",u),x&&f.append("type",x),i&&f.append("status",i),c&&f.append("createdAtFrom",c),A&&f.append("createdAtTo",A);const k=M?"/api/order/admin/query":"/api/order/query";return N.get(`${k}?${f.toString()}`)},getOrder:async(s,a=!1)=>{const t=a?`/api/order/admin/${s}`:`/api/order/${s}`;return N.get(t)},placeOrder:async(s,a=!1)=>{const t=a?"/api/order/admin/place":"/api/order/place",r={quantity:s.quantity,addresses:s.addresses,provideShippingLater:s.provideShippingLater,notes:s.notes||"",billingEntityId:s.billingEntityId};return N.post(t,r)},updateOrderStatus:async(s,a,t=!1)=>{const r=t?`/api/order/admin/${s}/status`:`/api/order/${s}/status`;return N.patch(r,{status:a})},updateOrder:async(s,a,t=!1)=>{const r=t?`/api/order/admin/${s}`:`/api/order/${s}`;return N.patch(r,a)},cancelOrder:async(s,a=!1)=>{const t=a?`/api/order/admin/${s}/cancel`:`/api/order/${s}/cancel`;return N.post(t)},deleteOrder:async(s,a=!1)=>{const t=a?`/api/order/admin/${s}`:`/api/order/${s}`;return N.delete(t)},exportOrders:async(s={},a="csv")=>{const t=new URLSearchParams;return Object.entries(s).forEach(([n,o])=>{o!=null&&o!==""&&t.append(n,String(o))}),t.append("format",a),await N.get(`/api/order/export?${t.toString()}`,{responseType:"blob"})}},Ps=(s={})=>Te({queryKey:oe.orders.list(s),queryFn:()=>ve.getOrders(s)}),Is=()=>{const s=Oe();return qe({mutationFn:({data:a,isAdmin:t})=>ve.placeOrder(a,t),onSuccess:()=>{s.invalidateQueries({queryKey:oe.orders.all}),L.success("Order placed successfully")},onError:a=>{const t=a;L.error(t.response?.data?.message||"Failed to place order")}})},$s=(s,a)=>{const t=a.reduce((r,n)=>r+(n.assignedKits||0),0);return{totalKits:s,assignedKits:t,availableKits:s-t}},_s=(s,a,t)=>{const r=[];if(t)return r;const n=a.reduce((o,m)=>o+(m.assignedKits||0),0);return n>s&&r.push({message:`Cannot assign ${n} kits when only ${s} are available`,type:"over_allocation"}),a.forEach((o,m)=>{(o.assignedKits||0)<0&&r.push({addressIndex:m,message:`Invalid negative kit assignment for address ${m+1}`,type:"invalid_quantity"})}),n<s&&a.length>0&&r.push({message:`${s-n} kits remain unassigned`,type:"missing_allocation"}),r},Vs=(s,a)=>{const r=s[a].assignedKits||0;if(r===0)return s.filter((u,x)=>x!==a);const n=s.filter((u,x)=>x!==a);if(n.length===0)return n;let o=r;return n.map(u=>{if(o<=0)return u;const x=u.assignedKits||0,i=u.quantity-x,c=Math.min(o,i);return o-=c,{...u,assignedKits:x+c}})},Ls=(s,a)=>{let t=s;return a.map(r=>{if(t<=0)return{...r,assignedKits:0};const n=Math.min(t,r.quantity);return t-=n,{...r,assignedKits:n}})},Fs=(s,a)=>{const r=s[a].assignedKits||0;if(r===0)return{canRemove:!0};const o=s.filter((m,u)=>u!==a).reduce((m,u)=>m+(u.quantity-(u.assignedKits||0)),0);return o>=r?{canRemove:!0}:{canRemove:!1,reason:`Cannot redistribute ${r} kits to remaining addresses (capacity: ${o})`}},ie=50;function Ms({open:s,onOpenChange:a}){const[t,r]=j.useState(!1),[n,o]=j.useState({totalKits:1,assignedKits:0,availableKits:1}),[m,u]=j.useState([]),x=Is(),i=We({resolver:Ye(ks),defaultValues:{quantity:1,companyId:"",addresses:[{address:{street:"",city:"",state:"",zipCode:"",country:""},quantity:1,assignedKits:1}],provideShippingLater:!1,notes:"",billingEntityId:void 0}}),{fields:c,append:A,remove:M}=Ze({control:i.control,name:"addresses"}),f=i.watch("quantity"),k=i.watch("addresses"),v=i.watch("provideShippingLater"),T=i.watch("companyId"),{data:Y,isLoading:E}=ns(T);j.useEffect(()=>{const l=$s(f,k);o(l);const d=_s(f,k,v);u(d)},[f,k,v]),j.useEffect(()=>{T&&i.setValue("billingEntityId",void 0)},[T,i]);const be=l=>{const d=i.getValues("addresses"),h=d.reduce((y,R)=>y+(R.assignedKits||0),0),g=Math.max(l,h);if(g!==l&&h>0&&L.error(`Cannot reduce total kits below ${h} (currently assigned amount)`),i.setValue("quantity",g),!v){const y=Ls(g,d);i.setValue("addresses",y)}},Ne=(l,d)=>{const h=i.getValues("addresses"),g=[...h],y=h.reduce((Z,Ae,Se)=>Se===l?Z:Z+(Ae.assignedKits||0),0),R=f-y;g[l]={...g[l],assignedKits:Math.max(0,Math.min(d,R))},i.setValue("addresses",g)},we=l=>{const d=i.getValues("addresses"),{canRemove:h,reason:g}=Fs(d,l);if(!h&&g){L.error(g);return}const y=Vs(d,l);i.setValue("addresses",y),M(l)},Ce=async l=>{r(!0);try{await x.mutateAsync({data:l}),i.reset(),a(!1)}catch{}finally{r(!1)}},$=i.watch("addresses").reduce((l,d)=>l+(d.quantity||0),0);return e.jsx(ue,{open:s,onOpenChange:a,children:e.jsxs(pe,{className:"max-h-[80vh] max-w-2xl overflow-y-auto",children:[e.jsxs(xe,{children:[e.jsx(he,{children:"Place New Order"}),e.jsx(ge,{children:"Fill out the form below to place a new order."})]}),e.jsx(Ge,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(Ce),className:"space-y-6",children:[e.jsx(S,{control:i.control,name:"quantity",render:({field:l})=>{const d=k.reduce((g,y)=>g+(y.assignedKits||0),0),h=Math.max(1,d);return e.jsxs(O,{children:[e.jsx(K,{children:"Total Quantity"}),e.jsx(D,{children:e.jsx(H,{type:"number",min:h,...l,onChange:g=>be(parseInt(g.target.value)||h)})}),e.jsxs(I,{children:["Total number of kits in this order"," ",d>0&&`(minimum: ${d} assigned)`]}),e.jsx(P,{})]})}}),e.jsx(S,{control:i.control,name:"companyId",render:({field:l})=>e.jsxs(O,{children:[e.jsx(K,{children:"Company"}),e.jsx(os,{value:l.value,onValueChange:l.onChange,placeholder:"Select company",includeNone:!1}),e.jsx(P,{})]})}),!v&&e.jsxs(ee,{className:"bg-muted/50",children:[e.jsx(se,{className:"pb-3",children:e.jsx(te,{className:"text-base",children:"Kit Allocation"})}),e.jsxs(ae,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total Kits:"}),e.jsx("span",{className:"font-medium",children:n.totalKits})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Assigned:"}),e.jsx("span",{className:"font-medium",children:n.assignedKits})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Available:"}),e.jsx("span",{className:"font-medium",children:n.availableKits})]})]})]}),m.length>0&&!v&&e.jsxs(z,{variant:"destructive",children:[e.jsx(ys,{className:"h-4 w-4"}),e.jsx(B,{children:e.jsx("div",{className:"space-y-1",children:m.map((l,d)=>e.jsx("div",{className:"text-sm",children:l.message},d))})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(K,{children:"Shipping Addresses"}),e.jsxs(b,{type:"button",variant:"outline",size:"sm",disabled:!v&&n.availableKits<=0,onClick:()=>{const l=!v&&n.availableKits>0?1:0;A({address:{street:"",city:"",state:"",zipCode:"",country:""},quantity:1,assignedKits:l})},children:[e.jsx(cs,{className:"mr-2 h-4 w-4"}),!v&&n.availableKits<=0?"No Kits Available":"Add Address"]})]}),c.map((l,d)=>e.jsx("div",{className:"space-y-4 rounded-lg border p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(S,{control:i.control,name:`addresses.${d}.address`,render:({field:h})=>e.jsxs(O,{children:[e.jsx(D,{children:e.jsx(is,{value:h.value,onChange:h.onChange,placeholder:"Search for an address...",disabled:i.formState.isSubmitting})}),e.jsx(P,{})]})}),!v&&e.jsx(S,{control:i.control,name:`addresses.${d}.assignedKits`,render:({field:h})=>e.jsxs(O,{children:[e.jsx(K,{children:"Assigned Kits"}),e.jsx(D,{children:e.jsx(H,{type:"number",min:0,disabled:n.availableKits===0&&h.value===0,...h,onChange:g=>Ne(d,parseInt(g.target.value)||0)})}),e.jsxs(I,{className:"text-xs",children:["Kits assigned to this address"," ",n.availableKits>0&&`(${n.availableKits} available)`]}),e.jsx(P,{})]})})]}),c.length>1&&e.jsx(b,{type:"button",variant:"ghost",size:"sm",onClick:()=>we(d),className:"ml-2",children:e.jsx(me,{className:"h-4 w-4"})})]})},l.id)),$>0&&e.jsxs("div",{className:"text-muted-foreground text-sm",children:["Total quantity across all addresses: ",$]})]}),e.jsx(S,{control:i.control,name:"billingEntityId",render:({field:l})=>e.jsxs(O,{children:[e.jsx(K,{children:"Bill To"}),e.jsx(D,{children:e.jsxs(Xe,{onValueChange:l.onChange,value:l.value,disabled:!T||E,children:[e.jsx(es,{children:e.jsx(ss,{placeholder:T?E?"Loading billing entities...":"Select billing entity":"Select a company first"})}),e.jsx(ts,{children:T?E?e.jsx(V,{value:"loading",disabled:!0,children:"Loading billing entities..."}):Y?.length===0?e.jsx(V,{value:"empty",disabled:!0,children:"No billing entities available"}):Y?.map(d=>e.jsxs(V,{value:d._id,children:[d.entityName," (",d.entityType,")",d.email?` - ${d.email}`:""]},d._id)):e.jsx(V,{value:"no-company",disabled:!0,children:"Please select a company first"})})]})}),e.jsx(I,{children:"Select the entity that will be billed for this order"}),e.jsx(P,{})]})}),e.jsx(S,{control:i.control,name:"provideShippingLater",render:({field:l})=>e.jsxs(O,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(K,{className:"text-base",children:"Provide shipping later"}),e.jsx(I,{children:"Check this if shipping addresses will be provided later. Kit allocation will be bypassed."})]}),e.jsx(D,{children:e.jsx(as,{checked:l.value,onCheckedChange:d=>{if(l.onChange(d),d){const g=i.getValues("addresses").map(y=>({...y,assignedKits:0}));i.setValue("addresses",g)}}})})]})}),e.jsx(S,{control:i.control,name:"notes",render:({field:l})=>e.jsxs(O,{children:[e.jsx(K,{children:"Order Notes"}),e.jsx(D,{children:e.jsx(rs,{placeholder:"Any additional notes for this order",className:"min-h-[100px]",...l})}),e.jsx(I,{children:"Optional notes or special instructions"}),e.jsx(P,{})]})}),e.jsxs(ee,{children:[e.jsx(se,{children:e.jsx(te,{children:"Order Summary"})}),e.jsxs(ae,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Kits:"}),e.jsx("span",{children:$})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Price per kit:"}),e.jsxs("span",{children:["$",ie.toFixed(2)]})]}),e.jsx("div",{className:"border-t pt-2",children:e.jsxs("div",{className:"flex justify-between text-lg font-semibold",children:[e.jsx("span",{children:"Total:"}),e.jsxs("span",{children:["$",($*ie).toFixed(2)]})]})})]})]}),e.jsxs(z,{children:[e.jsx(hs,{className:"h-4 w-4"}),e.jsxs(B,{className:"space-y-2",children:[e.jsx("p",{children:e.jsx("strong",{children:"Billing Information:"})}),e.jsxs("ul",{className:"list-inside list-disc space-y-1 text-sm",children:[e.jsx("li",{children:"An invoice will be sent after placing this order"}),e.jsx("li",{children:"Payment will be charged in 5 days"}),e.jsx("li",{children:"Kits will be delivered within those 5 days"}),e.jsx("li",{children:"You will be billed monthly on the same date each month"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(b,{type:"button",variant:"outline",onClick:()=>a(!1),disabled:t,children:"Cancel"}),e.jsx(b,{type:"submit",disabled:t||m.length>0&&!v,children:t?"Placing Order...":"Place Order"})]})]})})]})})}function Es(){const{isViewDialogOpen:s,setIsViewDialogOpen:a,viewingOrder:t,setViewingOrder:r}=F();if(!t)return null;const n=()=>{a(!1),r(null)},o=c=>c?[c.street,c.city,c.state,c.zipCode,c.country].filter(Boolean).join(", "):"No address provided",m=()=>typeof t.company=="string"?t.company:t.company?.name||"Unknown Company",u=()=>{if(typeof t.user=="string")return t.user;const c=t.user;return c?.firstName&&c?.lastName?`${c.firstName} ${c.lastName}`:c?.email||"Unknown User"},x=()=>typeof t.user=="string"?"":t.user?.email||"",i=()=>t.discount?typeof t.discount=="string"?t.discount:`${t.discount.code} (${t.discount.percentage}%)`:null;return e.jsx(ue,{open:s,onOpenChange:n,children:e.jsxs(pe,{className:"max-h-[90vh] overflow-y-auto sm:max-w-[700px]",children:[e.jsxs(xe,{children:[e.jsx(he,{children:"Order Details"}),e.jsx(ge,{children:"View detailed information about the order"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Order ID"}),e.jsx("p",{className:"mt-1 font-mono text-sm",children:t._id})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Status"}),e.jsx(re,{className:`mt-1 ${Ds(t.status)}`,children:Ts(t.status)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Type"}),e.jsx(re,{className:"mt-1",variant:"secondary",children:qs(t.type)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Quantity"}),e.jsx("p",{className:"mt-1 text-sm font-medium",children:t.quantity})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Company"}),e.jsx("p",{className:"mt-1 text-sm",children:m()})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Customer"}),e.jsxs("div",{className:"mt-1 text-sm",children:[e.jsx("p",{className:"font-medium",children:u()}),x()&&e.jsx("p",{className:"text-muted-foreground text-xs",children:x()})]})]})]}),e.jsx(ne,{}),t.deliveryAddresses&&t.deliveryAddresses.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-muted-foreground mb-3 text-sm font-medium",children:["Delivery Addresses (",t.deliveryAddresses.length,")"]}),e.jsx("div",{className:"space-y-3",children:t.deliveryAddresses.map((c,A)=>e.jsx("div",{className:"border rounded-lg p-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground text-xs font-medium",children:"Address"}),e.jsx("p",{className:"mt-1 text-sm",children:o(c.address)})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground text-xs font-medium",children:"Quantity"}),e.jsx("p",{className:"mt-1 text-sm",children:c.quantity})]}),c.assignedKits&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground text-xs font-medium",children:"Assigned Kits"}),e.jsx("p",{className:"mt-1 text-sm",children:c.assignedKits})]})]})},A))})]}),i()&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Discount"}),e.jsx("p",{className:"mt-1 text-sm",children:i()})]}),t.notes&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Notes"}),e.jsx("p",{className:"mt-1 text-sm whitespace-pre-wrap",children:t.notes})]}),e.jsx(ne,{}),e.jsxs("div",{className:"text-muted-foreground text-xs",children:[e.jsx("h3",{className:"font-medium",children:"Created"}),e.jsx("p",{children:new Date(t.createdAt).toLocaleDateString()})]})]}),e.jsx(Je,{children:e.jsx(b,{variant:"outline",onClick:n,children:"Close"})})]})})}function Rs(){const{placeOrderOpen:s,setPlaceOrderOpen:a}=F();return e.jsxs(e.Fragment,{children:[e.jsx(Ms,{open:s,onOpenChange:a}),e.jsx(Es,{})]})}function zs(){const{setPlaceOrderOpen:s}=F();return e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(b,{onClick:()=>s(!0),children:[e.jsx(ms,{className:"mr-2 h-4 w-4"}),"Place Order"]})})}function Bs({table:s}){return e.jsxs(le,{children:[e.jsx(ze,{asChild:!0,children:e.jsxs(b,{variant:"outline",size:"sm",className:"ml-auto hidden h-8 lg:flex",children:[e.jsx(Fe,{className:"mr-2 h-4 w-4"}),"View"]})}),e.jsxs(de,{align:"end",className:"w-[150px]",children:[e.jsx(Be,{children:"Toggle columns"}),e.jsx(ce,{}),s.getAllColumns().filter(a=>typeof a.accessorFn<"u"&&a.getCanHide()).map(a=>e.jsx(He,{className:"capitalize",checked:a.getIsVisible(),onCheckedChange:t=>a.toggleVisibility(!!t),children:a.id},a.id))]})]})}function Hs({table:s}){const a=s.getState().columnFilters.length>0;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-2",children:[e.jsx(H,{placeholder:"Search customers...",value:s.getColumn("customer")?.getFilterValue()??"",onChange:t=>s.getColumn("customer")?.setFilterValue(t.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),a&&e.jsxs(b,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["Reset",e.jsx(Me,{className:"ml-2 h-4 w-4"})]})]}),e.jsx(Bs,{table:s})]})}function Qs({columns:s,data:a,isLoading:t,pageCount:r,onPaginationChange:n}){const{table:o}=us({data:a,columns:s,pageCount:r,manualPagination:!!n,onPaginationChange:n});return e.jsx(ps,{table:o,columns:s,isLoading:t,toolbar:e.jsx(Hs,{table:o}),showToolbar:!0})}function Us({children:s}){const[a,t]=j.useState(!1),[r,n]=j.useState(!1),[o,m]=j.useState(null);return e.jsx(fe.Provider,{value:{placeOrderOpen:a,setPlaceOrderOpen:t,isViewDialogOpen:r,setIsViewDialogOpen:n,viewingOrder:o,setViewingOrder:m},children:s})}function Ws(){const s=Ke({strict:!1}),[a,t]=j.useState({page:1,pageSize:10,sortBy:"createdAt",sortOrder:"desc",company:s.company,isAdmin:!0}),[r,n]=j.useState(1),{data:o,isLoading:m,error:u}=Ps(a);return j.useEffect(()=>{o?.meta?.pagination?.totalPages&&n(o.meta.pagination.totalPages)},[o?.meta?.pagination?.totalPages]),j.useEffect(()=>{t(x=>({...x,company:s.company,page:1,isAdmin:!0}))},[s.company]),e.jsxs(Us,{children:[e.jsxs(De,{fixed:!0,children:[e.jsx(Pe,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Ie,{}),e.jsx($e,{}),e.jsx(_e,{})]})]}),e.jsxs(Ve,{children:[e.jsxs("div",{className:"mb-2 flex flex-wrap items-center justify-between space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Orders"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage and track all customer orders"})]}),e.jsx(zs,{})]}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-y-0 lg:space-x-12",children:u?e.jsxs(z,{variant:"destructive",children:[e.jsx(ke,{className:"h-4 w-4"}),e.jsx(B,{children:"Failed to load orders. Please try again later."})]}):e.jsx(Qs,{columns:Ns,data:o?.data||[],isLoading:m,pageCount:o?.meta?.pagination?.totalPages||r,pagination:{pageIndex:(a.page||1)-1,pageSize:a.pageSize||10},onPaginationChange:({pageIndex:x,pageSize:i})=>{t(c=>({...c,page:x+1,pageSize:i}))}})})]}),e.jsx(Rs,{})]})}const It=function(){return e.jsx(Ws,{})};export{It as component};
