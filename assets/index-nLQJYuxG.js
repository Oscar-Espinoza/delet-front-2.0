import{c as oe,r as h,j as e,B as N,d as M,f as ts,t as q,a as as}from"./index-LjicKyT0.js";import{A as ne,a as re,I as ns}from"./alert-Df5zkjER.js";import{c as S,u as rs,b as is,q as ye,g as os,H as ls,S as ds,a as cs,T as ms,P as us,M as ps}from"./theme-switch-cMSK6cqB.js";import{C as xe}from"./checkbox-w55iTThu.js";import{D}from"./data-table-column-header-NxjSLUJQ.js";import{D as xs,M as hs,a as gs}from"./react-icons.esm-_L3V94na.js";import{D as ve,e as fs,f as be,i as Q,h as Ne,p as js,B as ys,g as vs,z as bs}from"./avatar-ZyuV-nlZ.js";import{E as Ns}from"./eye-D5U1iGxZ.js";import{F as ws}from"./file-text-BHkIvwRe.js";import{T as we}from"./trash-2-BnkWnZhX.js";import{f as he}from"./format-BvUxDbfm.js";import{u as Cs,a as Ss,g as As,F as Ts,b as K,c as I,d as P,e as $,h as _,f as V}from"./form-Bf5yBnbc.js";import{C as F,a as E,b as R,d as z}from"./card-COJmpkDS.js";import{D as Ce,a as Se,b as Ae,c as Te,d as ke,e as ks}from"./command-X9JjFxyP.js";import{I as ie}from"./input-Dlu4Ie9G.js";import{S as Os,a as Ks,b as Is,c as Ps,d as U}from"./select-w6OWzPxW.js";import{S as $s}from"./switch-BanRt0QR.js";import{T as Ds}from"./textarea-1eidY_GF.js";import{u as _s,c as Vs,a as se}from"./index-CVPNRdpP.js";import{c as Oe,R as qs,I as Ms}from"./index-DVkuEz9K.js";import{P as Ls}from"./index-DgBTolnX.js";import{P as W}from"./index-BWm_iZMh.js";import{u as Fs}from"./index-CJhIcW8r.js";import{u as Es}from"./index-BK3YptDx.js";import{c as Rs,A as zs}from"./use-billing-entities-ByZUxDCE.js";import{C as Bs}from"./company-select-YLwP_2QB.js";import{o as T,s as g,b as Hs,a as le,c as A,e as Ke,u as de,f as Qs}from"./types-Wky072k2.js";import{C as ge}from"./circle-check-big-BIYsFas6.js";import{P as Us}from"./plus-D8USiGGy.js";import{B as fe}from"./badge-4kjocfwo.js";import{S as je}from"./separator-CLg1W5b9.js";import{I as Gs}from"./IconPlus-noFS_DkS.js";import{u as Ws,D as Ys}from"./use-data-table-Bb2GNchX.js";import"./createReactComponent-Dm51iCRd.js";import"./index-BvwaI8vX.js";import"./check-D7e09AXV.js";import"./index-DbJ88n5W.js";import"./index-BqMrZ-WO.js";import"./map-pin-Drz5NG2-.js";import"./table-zh_l_sMN.js";/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],Js=oe("info",Zs);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xs=[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]],et=oe("square-pen",Xs);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const st=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],tt=oe("triangle-alert",st),Ie=h.createContext(null);function Y(){const s=h.useContext(Ie);if(!s)throw new Error("useOrdersContext must be used within an OrdersProvider");return s}function at({row:s}){const{setIsViewDialogOpen:t,setViewingOrder:a}=Y(),n=s.original,r=()=>{a(n),t(!0)};return e.jsxs(ve,{children:[e.jsx(fs,{asChild:!0,children:e.jsxs(N,{variant:"ghost",className:"data-[state=open]:bg-muted flex h-8 w-8 p-0",children:[e.jsx(xs,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Open menu"})]})}),e.jsxs(be,{align:"end",className:"w-[160px]",children:[e.jsxs(Q,{onClick:r,children:[e.jsx(Ns,{className:"mr-2 h-4 w-4"}),"View Details"]}),e.jsxs(Q,{children:[e.jsx(et,{className:"mr-2 h-4 w-4"}),"Edit Order"]}),e.jsxs(Q,{children:[e.jsx(ws,{className:"mr-2 h-4 w-4"}),"View Invoice"]}),e.jsx(Ne,{}),e.jsxs(Q,{className:"text-red-600",children:[e.jsx(we,{className:"mr-2 h-4 w-4"}),"Delete",e.jsx(js,{children:"⌘⌫"})]})]})]})}const nt=200,rt=[{id:"select",header:({table:s})=>e.jsx(xe,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:t=>s.toggleAllPageRowsSelected(!!t),"aria-label":"Select all",className:"translate-y-[2px]"}),meta:{className:M("sticky md:table-cell left-0 z-10 rounded-tl","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted")},cell:({row:s})=>e.jsx(xe,{checked:s.getIsSelected(),onCheckedChange:t=>s.toggleSelected(!!t),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{id:"customer",header:({column:s})=>e.jsx(D,{column:s,title:"Customer"}),cell:({row:s})=>{const t=s.original.user;if(typeof t=="string")return e.jsxs("div",{children:["User ID: ",t]});const a=`${t.firstName||""} ${t.lastName||""}`.trim()||t.email;return e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:a}),e.jsx("div",{className:"text-muted-foreground text-xs",children:t.email})]})},filterFn:(s,t,a)=>{const n=s.original.user;if(typeof n=="string")return n.toLowerCase().includes(a.toLowerCase());const r=`${n.firstName||""} ${n.lastName||""}`.trim()||n.email,i=a.toLowerCase();return r.toLowerCase().includes(i)||n.email.toLowerCase().includes(i)},meta:{className:M("drop-shadow-[0_1px_2px_rgb(0_0_0_/_0.1)] dark:drop-shadow-[0_1px_2px_rgb(255_255_255_/_0.1)] lg:drop-shadow-none","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted","sticky left-6 md:table-cell")},enableHiding:!1},{accessorKey:"quantity",header:({column:s})=>e.jsx(D,{column:s,title:"Quantity"}),cell:({row:s})=>e.jsx("div",{className:"text-center",children:s.getValue("quantity")})},{id:"company",header:({column:s})=>e.jsx(D,{column:s,title:"Company"}),cell:({row:s})=>{const t=s.original.company,a=typeof t=="object"?t.name:"N/A";return e.jsx("div",{className:"w-fit text-nowrap",children:a})}},{id:"addresses",header:({column:s})=>e.jsx(D,{column:s,title:"Addresses"}),cell:({row:s})=>{const t=s.original.deliveryAddresses;if(!t||t.length===0)return e.jsx("span",{className:"text-muted-foreground",children:"No addresses"});const a=t.length;return e.jsx("div",{className:"text-center",children:a===1?"1 address":`${a} addresses`})}},{id:"total",header:({column:s})=>e.jsx(D,{column:s,title:"Total"}),cell:({row:s})=>{const a=s.original.quantity*nt;return e.jsxs("div",{className:"text-right font-medium",children:["$",a.toFixed(2)]})}},{accessorKey:"createdAt",header:({column:s})=>e.jsx(D,{column:s,title:"Created"}),cell:({row:s})=>{const t=s.getValue("createdAt"),a=new Date(t*1e3);return e.jsxs("div",{className:"text-nowrap",children:[he(a,"MMM dd, yyyy"),e.jsx("div",{className:"text-muted-foreground text-xs",children:he(a,"h:mm a")})]})}},{id:"actions",cell:at}];var Z="Tabs",[it,Ta]=Vs(Z,[Oe]),Pe=Oe(),[ot,ce]=it(Z),$e=h.forwardRef((s,t)=>{const{__scopeTabs:a,value:n,onValueChange:r,defaultValue:i,orientation:m="horizontal",dir:p,activationMode:u="automatic",...y}=s,d=Fs(p),[f,w]=_s({prop:n,onChange:r,defaultProp:i??"",caller:Z});return e.jsx(ot,{scope:a,baseId:Es(),value:f,onValueChange:w,orientation:m,dir:d,activationMode:u,children:e.jsx(W.div,{dir:d,"data-orientation":m,...y,ref:t})})});$e.displayName=Z;var De="TabsList",_e=h.forwardRef((s,t)=>{const{__scopeTabs:a,loop:n=!0,...r}=s,i=ce(De,a),m=Pe(a);return e.jsx(qs,{asChild:!0,...m,orientation:i.orientation,dir:i.dir,loop:n,children:e.jsx(W.div,{role:"tablist","aria-orientation":i.orientation,...r,ref:t})})});_e.displayName=De;var Ve="TabsTrigger",qe=h.forwardRef((s,t)=>{const{__scopeTabs:a,value:n,disabled:r=!1,...i}=s,m=ce(Ve,a),p=Pe(a),u=Fe(m.baseId,n),y=Ee(m.baseId,n),d=n===m.value;return e.jsx(Ms,{asChild:!0,...p,focusable:!r,active:d,children:e.jsx(W.button,{type:"button",role:"tab","aria-selected":d,"aria-controls":y,"data-state":d?"active":"inactive","data-disabled":r?"":void 0,disabled:r,id:u,...i,ref:t,onMouseDown:se(s.onMouseDown,f=>{!r&&f.button===0&&f.ctrlKey===!1?m.onValueChange(n):f.preventDefault()}),onKeyDown:se(s.onKeyDown,f=>{[" ","Enter"].includes(f.key)&&m.onValueChange(n)}),onFocus:se(s.onFocus,()=>{const f=m.activationMode!=="manual";!d&&!r&&f&&m.onValueChange(n)})})})});qe.displayName=Ve;var Me="TabsContent",Le=h.forwardRef((s,t)=>{const{__scopeTabs:a,value:n,forceMount:r,children:i,...m}=s,p=ce(Me,a),u=Fe(p.baseId,n),y=Ee(p.baseId,n),d=n===p.value,f=h.useRef(d);return h.useEffect(()=>{const w=requestAnimationFrame(()=>f.current=!1);return()=>cancelAnimationFrame(w)},[]),e.jsx(Ls,{present:r||d,children:({present:w})=>e.jsx(W.div,{"data-state":d?"active":"inactive","data-orientation":p.orientation,role:"tabpanel","aria-labelledby":u,hidden:!w,id:y,tabIndex:0,...m,ref:t,style:{...s.style,animationDuration:f.current?"0s":void 0},children:w&&i})})});Le.displayName=Me;function Fe(s,t){return`${s}-trigger-${t}`}function Ee(s,t){return`${s}-content-${t}`}var lt=$e,dt=_e,ct=qe,mt=Le;function ut({className:s,...t}){return e.jsx(lt,{"data-slot":"tabs",className:M("flex flex-col gap-2",s),...t})}function pt({className:s,...t}){return e.jsx(dt,{"data-slot":"tabs-list",className:M("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",s),...t})}function te({className:s,...t}){return e.jsx(ct,{"data-slot":"tabs-trigger",className:M("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",s),...t})}function ae({className:s,...t}){return e.jsx(mt,{"data-slot":"tabs-content",className:M("flex-1 outline-none",s),...t})}const xt=Ke(["purchase","service"]),ht=Ke(["waiting for payment information","assembling kits","complete","paid","cancelled",""]),gt=de([g(),T({_id:g(),code:g(),percentage:A()}),Qs()]),ft=de([g(),T({_id:g(),name:g()})]),jt=de([g(),T({_id:g(),email:g(),firstName:g().optional(),lastName:g().optional()})]),Re=T({street:g().min(1,"Street is required"),city:g().min(1,"City is required"),state:g().min(1,"State is required"),zipCode:g().min(1,"Zip code is required"),country:g().min(1,"Country is required")}),yt=T({_id:g(),user:jt,type:xt,discount:gt.optional(),status:ht,notes:g().optional(),deliveryAddresses:le(T({address:Re,quantity:A(),assignedKits:A().optional()})).optional(),quantity:A(),createdAt:A(),company:ft});le(yt);const vt=T({quantity:A().min(1),companyId:g().min(1,"Company is required"),addresses:le(T({address:Re,quantity:A().min(1),assignedKits:A().min(0).optional()})),provideShippingLater:Hs(),notes:g().optional(),billingEntityId:g().optional()}).refine(s=>s.provideShippingLater?!0:s.addresses.reduce((a,n)=>a+(n.assignedKits||0),0)===s.quantity,{message:"Total assigned kits must equal total quantity when not providing shipping later",path:["addresses"]}),bt=s=>({"waiting for payment information":"Waiting for Payment","assembling kits":"Assembling Kits",complete:"Complete",paid:"Paid",cancelled:"Cancelled","":"Unknown"})[s]||s,Nt=s=>({purchase:"Purchase",service:"Service"})[s]||s,wt=s=>({"waiting for payment information":"text-yellow-600 bg-yellow-50","assembling kits":"text-blue-600 bg-blue-50",complete:"text-green-600 bg-green-50",paid:"text-green-600 bg-green-50",cancelled:"text-red-600 bg-red-50","":"text-gray-600 bg-gray-50"})[s]||"text-gray-600 bg-gray-50",ze={getOrders:async(s={})=>{const{page:t=1,pageSize:a=10,sortBy:n="createdAt",sortOrder:r="desc",search:i="",company:m,user:p,type:u,status:y,createdAtFrom:d,createdAtTo:f,isAdmin:w}=s,l=new URLSearchParams({page:t.toString(),pageSize:a.toString(),sortBy:n,sortOrder:r});i&&l.append("search",i),m&&l.append("company",m),p&&l.append("user",p),u&&l.append("type",u),y&&l.append("status",y),d&&l.append("createdAtFrom",d),f&&l.append("createdAtTo",f);const k=w?"/api/order/admin/query":"/api/order/query";return S.get(`${k}?${l.toString()}`)},getOrder:async(s,t=!1)=>{const a=t?`/api/order/admin/${s}`:`/api/order/${s}`;return S.get(a)},placeOrder:async(s,t=!1)=>{const a=t?"/api/order/admin/place":"/api/order/place",n={quantity:s.quantity,addresses:s.addresses,provideShippingLater:s.provideShippingLater,notes:s.notes||"",billingEntityId:s.billingEntityId};return S.post(a,n)},updateOrderStatus:async(s,t,a=!1)=>{const n=a?`/api/order/admin/${s}/status`:`/api/order/${s}/status`;return S.patch(n,{status:t})},updateOrder:async(s,t,a=!1)=>{const n=a?`/api/order/admin/${s}`:`/api/order/${s}`;return S.patch(n,t)},cancelOrder:async(s,t=!1)=>{const a=t?`/api/order/admin/${s}/cancel`:`/api/order/${s}/cancel`;return S.post(a)},deleteOrder:async(s,t=!1)=>{const a=t?`/api/order/admin/${s}`:`/api/order/${s}`;return S.delete(a)},exportOrders:async(s={},t="csv")=>{const a=new URLSearchParams;return Object.entries(s).forEach(([r,i])=>{i!=null&&i!==""&&a.append(r,String(i))}),a.append("format",t),await S.get(`/api/order/export?${a.toString()}`,{responseType:"blob"})}},Ct=(s={})=>rs({queryKey:ye.orders.list(s),queryFn:()=>ze.getOrders(s)}),St=()=>{const s=ts();return is({mutationFn:({data:t,isAdmin:a})=>ze.placeOrder(t,a),onSuccess:()=>{s.invalidateQueries({queryKey:ye.orders.all}),q.success("Order placed successfully")},onError:t=>{const a=t;q.error(a.response?.data?.message||"Failed to place order")}})},At=(s,t)=>{const a=t.reduce((n,r)=>n+(r.assignedKits||0),0);return{totalKits:s,assignedKits:a,availableKits:s-a}},Tt=(s,t,a)=>{const n=[];if(a)return n;const r=t.reduce((i,m)=>i+(m.assignedKits||0),0);return r>s&&n.push({message:`Cannot assign ${r} kits when only ${s} are available`,type:"over_allocation"}),t.forEach((i,m)=>{(i.assignedKits||0)<0&&n.push({addressIndex:m,message:`Invalid negative kit assignment for address ${m+1}`,type:"invalid_quantity"})}),r<s&&t.length>0&&n.push({message:`${s-r} kits remain unassigned`,type:"missing_allocation"}),n},kt=(s,t)=>{const n=s[t].assignedKits||0;if(n===0)return s.filter((p,u)=>u!==t);const r=s.filter((p,u)=>u!==t);if(r.length===0)return r;let i=n;return r.map(p=>{if(i<=0)return p;const u=p.assignedKits||0,y=p.quantity-u,d=Math.min(i,y);return i-=d,{...p,assignedKits:u+d}})},Ot=(s,t)=>{let a=s;return t.map(n=>{if(a<=0)return{...n,assignedKits:0};const r=Math.min(a,n.quantity);return a-=r,{...n,assignedKits:r}})},Kt=(s,t)=>{const n=s[t].assignedKits||0;if(n===0)return{canRemove:!0};const i=s.filter((m,p)=>p!==t).reduce((m,p)=>m+(p.quantity-(p.assignedKits||0)),0);return i>=n?{canRemove:!0}:{canRemove:!1,reason:`Cannot redistribute ${n} kits to remaining addresses (capacity: ${i})`}},G=200;function It({open:s,onOpenChange:t}){const[a,n]=h.useState(!1),[r,i]=h.useState("basics"),[m,p]=h.useState(!1),[u,y]=h.useState({totalKits:1,assignedKits:0,availableKits:1}),[d,f]=h.useState([]),w=St(),l=Cs({resolver:Ss(vt),defaultValues:{quantity:1,companyId:"",addresses:[{address:{street:"",city:"",state:"",zipCode:"",country:""},quantity:1,assignedKits:1}],provideShippingLater:!1,notes:"",billingEntityId:void 0}}),{fields:k,append:Be,remove:He}=As({control:l.control,name:"addresses"}),C=l.watch("quantity"),B=l.watch("addresses"),v=l.watch("provideShippingLater"),O=l.watch("companyId"),{data:me,isLoading:J}=Rs(O),{data:Qe=[]}=os();h.useEffect(()=>{const o=At(C,B);y(o);const c=Tt(C,B,v);f(c)},[C,B,v]),h.useEffect(()=>{O&&l.setValue("billingEntityId",void 0)},[O,l]);const Ue=o=>{const c=l.getValues("addresses"),x=c.reduce((b,ee)=>b+(ee.assignedKits||0),0),j=Math.max(o,x);if(j!==o&&x>0&&q.error(`Cannot reduce total kits below ${x} (currently assigned amount)`),l.setValue("quantity",j),!v){const b=Ot(j,c);l.setValue("addresses",b)}},Ge=(o,c)=>{const x=l.getValues("addresses"),j=[...x],b=x.reduce((pe,es,ss)=>ss===o?pe:pe+(es.assignedKits||0),0),ee=C-b;j[o]={...j[o],assignedKits:Math.max(0,Math.min(c,ee))},l.setValue("addresses",j)},We=o=>{const c=l.getValues("addresses"),{canRemove:x,reason:j}=Kt(c,o);if(!x&&j){q.error(j);return}const b=kt(c,o);l.setValue("addresses",b),He(o)},Ye=async o=>{if(!(r!=="review"||m)){n(!0);try{await w.mutateAsync({data:o}),l.reset(),t(!1)}catch{}finally{n(!1)}}},ue=l.watch("addresses").reduce((o,c)=>o+(c.quantity||0),0),Ze=Qe.find(o=>o._id===O)?.name||"Not selected",L=h.useCallback(()=>{const o=l.getValues("quantity"),c=l.getValues("companyId");return o>=1&&c!==""},[l]),H=h.useCallback(()=>l.getValues("provideShippingLater")?!0:l.getValues("addresses").length>0&&d.length===0,[l,d]),X=o=>{switch(o){case"shipping":return L();case"review":return L()&&H();default:return!0}},Je=o=>{const c=o;X(c)?i(c):q.error("Please complete the current step before proceeding")},Xe=h.useCallback(async o=>{o.preventDefault(),!(m||a)&&(p(!0),setTimeout(()=>{r==="basics"&&L()?i("shipping"):r==="shipping"&&H()?i("review"):q.error("Please complete all required fields"),p(!1)},150))},[r,m,a,L,H]);return e.jsx(Ce,{open:s,onOpenChange:t,children:e.jsxs(Se,{className:"max-h-[90vh] w-[95vw] max-w-lg sm:max-w-xl md:max-w-2xl lg:max-w-4xl xl:max-w-5xl overflow-y-auto",children:[e.jsxs(Ae,{children:[e.jsx(Te,{children:"Place New Order"}),e.jsx(ke,{children:"Follow the steps below to configure your order."})]}),e.jsx(Ts,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(Ye),className:"space-y-6",children:[e.jsxs(ut,{value:r,onValueChange:Je,className:"w-full",children:[e.jsxs(pt,{className:"grid w-full grid-cols-3",children:[e.jsxs(te,{value:"basics",className:"flex items-center gap-2",children:[L()&&e.jsx(ge,{className:"h-4 w-4"}),"Order Basics"]}),e.jsxs(te,{value:"shipping",className:"flex items-center gap-2",disabled:!X("shipping"),children:[H()&&e.jsx(ge,{className:"h-4 w-4"}),"Shipping"]}),e.jsx(te,{value:"review",className:"flex items-center gap-2",disabled:!X("review"),children:"Review & Confirm"})]}),e.jsx(ae,{value:"basics",className:"space-y-6 mt-6",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-3",children:[e.jsx(K,{control:l.control,name:"quantity",render:({field:o})=>{const c=B.reduce((j,b)=>j+(b.assignedKits||0),0),x=Math.max(1,c);return e.jsxs(I,{children:[e.jsx(P,{children:"Total Quantity"}),e.jsx($,{children:e.jsx(ie,{type:"number",min:x,...o,onChange:j=>Ue(parseInt(j.target.value)||x)})}),e.jsxs(_,{children:["Total number of kits in this order"," ",c>0&&`(minimum: ${c} assigned)`]}),e.jsx(V,{})]})}}),e.jsx(K,{control:l.control,name:"companyId",render:({field:o})=>e.jsxs(I,{children:[e.jsx(P,{children:"Company"}),e.jsx($,{children:e.jsx(Bs,{value:o.value,onValueChange:o.onChange,placeholder:"Select company",includeNone:!1})}),e.jsx(_,{children:"Select the company that will be billed for this order"}),e.jsx(V,{})]})}),e.jsx(K,{control:l.control,name:"billingEntityId",render:({field:o})=>e.jsxs(I,{children:[e.jsx(P,{children:"Bill To"}),e.jsx($,{children:e.jsxs(Os,{onValueChange:o.onChange,value:o.value,disabled:!O||J,children:[e.jsx(Ks,{children:e.jsx(Is,{placeholder:O?J?"Loading billing entities...":"Select billing entity":"Select a company first"})}),e.jsx(Ps,{children:O?J?e.jsx(U,{value:"loading",disabled:!0,children:"Loading billing entities..."}):me?.length===0?e.jsx(U,{value:"empty",disabled:!0,children:"No billing entities available"}):me?.map(c=>e.jsxs(U,{value:c._id,children:[c.entityName," (",c.entityType,")",c.email?` - ${c.email}`:""]},c._id)):e.jsx(U,{value:"no-company",disabled:!0,children:"Please select a company first"})})]})}),e.jsx(_,{children:"Select the entity that will be billed for this order"}),e.jsx(V,{})]})})]}),e.jsx(K,{control:l.control,name:"notes",render:({field:o})=>e.jsxs(I,{children:[e.jsx(P,{children:"Order Notes"}),e.jsx($,{children:e.jsx(Ds,{placeholder:"Any additional notes for this order",className:"min-h-[100px]",...o})}),e.jsx(_,{children:"Optional notes or special instructions"}),e.jsx(V,{})]})}),e.jsxs(F,{children:[e.jsx(E,{children:e.jsx(R,{children:"Monthly Pricing"})}),e.jsxs(z,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Quantity:"}),e.jsx("span",{children:C})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Kit:"}),e.jsx("span",{children:"$150.00"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Leasing service:"}),e.jsx("span",{children:"$50.00"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Monthly price per kit:"}),e.jsxs("span",{children:["$",G.toFixed(2)]})]}),e.jsx("div",{className:"border-t pt-2",children:e.jsxs("div",{className:"flex justify-between text-lg font-semibold",children:[e.jsx("span",{children:"Total Monthly:"}),e.jsxs("span",{children:["$",(C*G).toFixed(2)]})]})})]})]})]})}),e.jsx(ae,{value:"shipping",className:"space-y-6 mt-6",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsx(K,{control:l.control,name:"provideShippingLater",render:({field:o})=>e.jsxs(I,{className:"flex flex-row items-center justify-between rounded-lg border p-4",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(P,{className:"text-base",children:"Provide shipping later"}),e.jsx(_,{children:"Check this if shipping addresses will be provided later. Kit allocation will be bypassed."})]}),e.jsx($,{children:e.jsx($s,{checked:o.value,onCheckedChange:c=>{if(o.onChange(c),c){const j=l.getValues("addresses").map(b=>({...b,assignedKits:0}));l.setValue("addresses",j)}}})})]})}),!v&&e.jsxs(F,{className:"bg-muted/50",children:[e.jsx(E,{className:"pb-3",children:e.jsx(R,{className:"text-base",children:"Kit Allocation"})}),e.jsxs(z,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Total Kits:"}),e.jsx("span",{className:"font-medium",children:u.totalKits})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Assigned:"}),e.jsx("span",{className:"font-medium",children:u.assignedKits})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Available:"}),e.jsx("span",{className:"font-medium",children:u.availableKits})]})]})]}),d.length>0&&!v&&e.jsxs(ne,{variant:"destructive",children:[e.jsx(tt,{className:"h-4 w-4"}),e.jsx(re,{children:e.jsx("div",{className:"space-y-1",children:d.map((o,c)=>e.jsx("div",{className:"text-sm",children:o.message},c))})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(P,{children:"Shipping Addresses"}),e.jsxs(N,{type:"button",variant:"outline",size:"sm",disabled:!v&&u.availableKits<=0,onClick:()=>{const o=!v&&u.availableKits>0?1:0;Be({address:{street:"",city:"",state:"",zipCode:"",country:""},quantity:1,assignedKits:o})},children:[e.jsx(Us,{className:"mr-2 h-4 w-4"}),!v&&u.availableKits<=0?"No Kits Available":"Add Address"]})]}),k.map((o,c)=>e.jsx("div",{className:"space-y-4 rounded-lg border p-4",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 space-y-4",children:[e.jsx(K,{control:l.control,name:`addresses.${c}.address`,render:({field:x})=>e.jsxs(I,{children:[e.jsx($,{children:e.jsx(zs,{value:x.value,onChange:x.onChange,placeholder:"Search for an address...",disabled:l.formState.isSubmitting})}),e.jsx(V,{})]})}),!v&&e.jsx(K,{control:l.control,name:`addresses.${c}.assignedKits`,render:({field:x})=>e.jsxs(I,{children:[e.jsx(P,{children:"Assigned Kits"}),e.jsx($,{children:e.jsx(ie,{type:"number",min:0,disabled:u.availableKits===0&&x.value===0,...x,onChange:j=>Ge(c,parseInt(j.target.value)||0)})}),e.jsxs(_,{className:"text-xs",children:["Kits assigned to this address"," ",u.availableKits>0&&`(${u.availableKits} available)`]}),e.jsx(V,{})]})})]}),k.length>1&&e.jsx(N,{type:"button",variant:"ghost",size:"sm",onClick:()=>We(c),className:"ml-2",children:e.jsx(we,{className:"h-4 w-4"})})]})},o.id)),ue>0&&e.jsxs("div",{className:"text-muted-foreground text-sm",children:["Total quantity across all addresses: ",ue]})]})]})}),e.jsx(ae,{value:"review",className:"space-y-6 mt-6",children:e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(F,{children:[e.jsx(E,{children:e.jsx(R,{children:"Order Details"})}),e.jsxs(z,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Quantity:"}),e.jsxs("span",{children:[C," kits"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Company:"}),e.jsx("span",{children:Ze})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Shipping:"}),e.jsx("span",{children:v?"Provided later":`${k.length} address(es)`})]}),l.getValues("notes")&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx("span",{className:"text-muted-foreground text-sm",children:"Notes:"}),e.jsx("p",{className:"text-sm mt-1",children:l.getValues("notes")})]})]})]}),e.jsxs(F,{children:[e.jsx(E,{children:e.jsx(R,{children:"Monthly Pricing"})}),e.jsxs(z,{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Kit:"}),e.jsx("span",{children:"$150.00"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Leasing service:"}),e.jsx("span",{children:"$50.00"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Monthly price per kit:"}),e.jsxs("span",{children:["$",G.toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Quantity:"}),e.jsx("span",{children:C})]}),e.jsx("div",{className:"border-t pt-2",children:e.jsxs("div",{className:"flex justify-between text-lg font-semibold",children:[e.jsx("span",{children:"Total Monthly:"}),e.jsxs("span",{children:["$",(C*G).toFixed(2)]})]})})]})]})]}),!v&&k.length>0&&e.jsxs(F,{children:[e.jsx(E,{children:e.jsx(R,{children:"Shipping Addresses"})}),e.jsx(z,{className:"space-y-3",children:k.map((o,c)=>{const x=l.getValues(`addresses.${c}.address`),j=l.getValues(`addresses.${c}.assignedKits`);return e.jsxs("div",{className:"flex justify-between items-start p-3 bg-muted/50 rounded-lg",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:x.street||"Address not set"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:x.city&&x.state&&x.zipCode?`${x.city}, ${x.state} ${x.zipCode}`:"Location not set"})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"font-medium",children:[j," kits"]})})]},o.id)})})]}),e.jsxs(ne,{children:[e.jsx(Js,{className:"h-4 w-4"}),e.jsxs(re,{className:"space-y-2",children:[e.jsx("p",{children:e.jsx("strong",{children:"Billing Information:"})}),e.jsxs("ul",{className:"list-inside list-disc space-y-1 text-sm",children:[e.jsx("li",{children:"An invoice will be sent after placing this order"}),e.jsx("li",{children:"Payment will be charged in 5 days"}),e.jsx("li",{children:"Kits will be delivered within those 5 days"}),e.jsx("li",{children:"You will be billed monthly on the same date each month"})]})]})]})]})})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t",children:[e.jsx("div",{className:"flex gap-2",children:r!=="basics"&&e.jsx(N,{type:"button",variant:"outline",onClick:()=>{r==="shipping"&&i("basics"),r==="review"&&i("shipping")},disabled:a,children:"Previous"})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{type:"button",variant:"outline",onClick:()=>t(!1),disabled:a,children:"Cancel"}),r==="review"?e.jsx(N,{type:"submit",disabled:a||d.length>0&&!v,children:a?"Placing Order...":"Place Order"}):e.jsx(N,{type:"button",onClick:Xe,disabled:a||m,children:m?"Loading...":"Next"})]})]})]})})]})})}function Pt(){const{isViewDialogOpen:s,setIsViewDialogOpen:t,viewingOrder:a,setViewingOrder:n}=Y();if(!a)return null;const r=()=>{t(!1),n(null)},i=d=>d?[d.street,d.city,d.state,d.zipCode,d.country].filter(Boolean).join(", "):"No address provided",m=()=>typeof a.company=="string"?a.company:a.company?.name||"Unknown Company",p=()=>{if(typeof a.user=="string")return a.user;const d=a.user;return d?.firstName&&d?.lastName?`${d.firstName} ${d.lastName}`:d?.email||"Unknown User"},u=()=>typeof a.user=="string"?"":a.user?.email||"",y=()=>a.discount?typeof a.discount=="string"?a.discount:`${a.discount.code} (${a.discount.percentage}%)`:null;return e.jsx(Ce,{open:s,onOpenChange:r,children:e.jsxs(Se,{className:"max-h-[90vh] overflow-y-auto sm:max-w-[700px]",children:[e.jsxs(Ae,{children:[e.jsx(Te,{children:"Order Details"}),e.jsx(ke,{children:"View detailed information about the order"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Order ID"}),e.jsx("p",{className:"mt-1 font-mono text-sm",children:a._id})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Status"}),e.jsx(fe,{className:`mt-1 ${wt(a.status)}`,children:bt(a.status)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Type"}),e.jsx(fe,{className:"mt-1",variant:"secondary",children:Nt(a.type)})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Quantity"}),e.jsx("p",{className:"mt-1 text-sm font-medium",children:a.quantity})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Company"}),e.jsx("p",{className:"mt-1 text-sm",children:m()})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Customer"}),e.jsxs("div",{className:"mt-1 text-sm",children:[e.jsx("p",{className:"font-medium",children:p()}),u()&&e.jsx("p",{className:"text-muted-foreground text-xs",children:u()})]})]})]}),e.jsx(je,{}),a.deliveryAddresses&&a.deliveryAddresses.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-muted-foreground mb-3 text-sm font-medium",children:["Delivery Addresses (",a.deliveryAddresses.length,")"]}),e.jsx("div",{className:"space-y-3",children:a.deliveryAddresses.map((d,f)=>e.jsx("div",{className:"border rounded-lg p-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground text-xs font-medium",children:"Address"}),e.jsx("p",{className:"mt-1 text-sm",children:i(d.address)})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground text-xs font-medium",children:"Quantity"}),e.jsx("p",{className:"mt-1 text-sm",children:d.quantity})]}),d.assignedKits&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-muted-foreground text-xs font-medium",children:"Assigned Kits"}),e.jsx("p",{className:"mt-1 text-sm",children:d.assignedKits})]})]})},f))})]}),y()&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Discount"}),e.jsx("p",{className:"mt-1 text-sm",children:y()})]}),a.notes&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Notes"}),e.jsx("p",{className:"mt-1 text-sm whitespace-pre-wrap",children:a.notes})]}),e.jsx(je,{}),e.jsxs("div",{className:"text-muted-foreground text-xs",children:[e.jsx("h3",{className:"font-medium",children:"Created"}),e.jsx("p",{children:new Date(a.createdAt).toLocaleDateString()})]})]}),e.jsx(ks,{children:e.jsx(N,{variant:"outline",onClick:r,children:"Close"})})]})})}function $t(){const{placeOrderOpen:s,setPlaceOrderOpen:t}=Y();return e.jsxs(e.Fragment,{children:[e.jsx(It,{open:s,onOpenChange:t}),e.jsx(Pt,{})]})}function Dt(){const{setPlaceOrderOpen:s}=Y();return e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(N,{onClick:()=>s(!0),children:[e.jsx(Gs,{className:"mr-2 h-4 w-4"}),"Place Order"]})})}function _t({table:s}){return e.jsxs(ve,{children:[e.jsx(ys,{asChild:!0,children:e.jsxs(N,{variant:"outline",size:"sm",className:"ml-auto hidden h-8 lg:flex",children:[e.jsx(hs,{className:"mr-2 h-4 w-4"}),"View"]})}),e.jsxs(be,{align:"end",className:"w-[150px]",children:[e.jsx(vs,{children:"Toggle columns"}),e.jsx(Ne,{}),s.getAllColumns().filter(t=>typeof t.accessorFn<"u"&&t.getCanHide()).map(t=>e.jsx(bs,{className:"capitalize",checked:t.getIsVisible(),onCheckedChange:a=>t.toggleVisibility(!!a),children:t.id},t.id))]})]})}function Vt({table:s}){const t=s.getState().columnFilters.length>0;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 flex-col-reverse items-start gap-y-2 sm:flex-row sm:items-center sm:space-x-2",children:[e.jsx(ie,{placeholder:"Search customers...",value:s.getColumn("customer")?.getFilterValue()??"",onChange:a=>s.getColumn("customer")?.setFilterValue(a.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),t&&e.jsxs(N,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["Reset",e.jsx(gs,{className:"ml-2 h-4 w-4"})]})]}),e.jsx(_t,{table:s})]})}function qt({columns:s,data:t,isLoading:a,pageCount:n,onPaginationChange:r}){const{table:i}=Ws({data:t,columns:s,pageCount:n,manualPagination:!!r,onPaginationChange:r});return e.jsx(Ys,{table:i,columns:s,isLoading:a,toolbar:e.jsx(Vt,{table:i}),showToolbar:!0})}function Mt({children:s}){const[t,a]=h.useState(!1),[n,r]=h.useState(!1),[i,m]=h.useState(null);return e.jsx(Ie.Provider,{value:{placeOrderOpen:t,setPlaceOrderOpen:a,isViewDialogOpen:n,setIsViewDialogOpen:r,viewingOrder:i,setViewingOrder:m},children:s})}function Lt(){const s=as({strict:!1}),[t,a]=h.useState({page:1,pageSize:10,sortBy:"createdAt",sortOrder:"desc",company:s.company,isAdmin:!0}),[n,r]=h.useState(1),{data:i,isLoading:m,error:p}=Ct(t);return h.useEffect(()=>{i?.meta?.pagination?.totalPages&&r(i.meta.pagination.totalPages)},[i?.meta?.pagination?.totalPages]),h.useEffect(()=>{a(u=>({...u,company:s.company,page:1,isAdmin:!0}))},[s.company]),e.jsxs(Mt,{children:[e.jsxs(ls,{fixed:!0,children:[e.jsx(ds,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(cs,{}),e.jsx(ms,{}),e.jsx(us,{})]})]}),e.jsxs(ps,{children:[e.jsxs("div",{className:"mb-2 flex flex-wrap items-center justify-between space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Orders"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage and track all customer orders"})]}),e.jsx(Dt,{})]}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-y-0 lg:space-x-12",children:p?e.jsxs(ne,{variant:"destructive",children:[e.jsx(ns,{className:"h-4 w-4"}),e.jsx(re,{children:"Failed to load orders. Please try again later."})]}):e.jsx(qt,{columns:rt,data:i?.data||[],isLoading:m,pageCount:i?.meta?.pagination?.totalPages||n,pagination:{pageIndex:(t.page||1)-1,pageSize:t.pageSize||10},onPaginationChange:({pageIndex:u,pageSize:y})=>{a(d=>({...d,page:u+1,pageSize:y}))}})})]}),e.jsx($t,{})]})}const ka=function(){return e.jsx(Lt,{})};export{ka as component};
