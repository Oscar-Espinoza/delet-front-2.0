import{k as Q,t as v,j as e,B as w,d as _,r as y,h as $,a as be}from"./index-CvyRkeE5.js";import{u as le,b as Y,q as E,c as F,H as De,S as ke,a as Se,T as Ae,P as Ke,M as Te}from"./header-company-dropdown-CQYbnI8v.js";import{u as Ie,D as Fe}from"./use-data-table-BURvSaac.js";import{M as _e,P as Ve,C as Ee,a as Pe,D as Oe}from"./react-icons.esm-hx67oMTw.js";import{I as f}from"./input-5vX5qBNK.js";import{D as ie,B as ze,f as oe,g as $e,h as ce,z as Me,e as He,i as G,p as qe}from"./avatar-_2VmutPB.js";import{B as C}from"./badge-Ce5hJyxp.js";import{C as Le,a as Re,b as Ue,c as Be,d as se,e as te,f as Ge,D as J,g as W,h as Z,i as X,j as ee,X as de,k as me}from"./command-DTdQs4HX.js";import{P as Qe,a as Ye,b as Je}from"./popover-NdNb9ebW.js";import{S as We}from"./separator-D1ovcUFg.js";import{o as xe,a as ae,s as N,n as Ze}from"./types-Wky072k2.js";import{C as re}from"./checkbox-DQAukn5y.js";import{D as S}from"./data-table-column-header-DAw5f9Xg.js";import{L as Xe}from"./long-text-B2UXBo_g.js";import{u as he,a as ue,F as pe,b as d,c as m,d as x,e as u,f as h}from"./form-BBbFGrnZ.js";import{S as M,a as H,b as q,c as L,d as V}from"./select-yRulkKwZ.js";import{T as R}from"./textarea-DtY41fJS.js";import{C as je}from"./company-select-SvYvuKDB.js";import{h as ge}from"./hardware-api-Dg-kEGj7.js";import{s as fe,M as ye,C as es}from"./multi-select-CobNqeWK.js";import{A as ss,a as ts,b as as,c as rs,d as ns,e as ls,f as is,g as os}from"./alert-dialog-DBJIasGu.js";import{A as cs,I as ds,a as ms}from"./alert-D1mu7eGo.js";import"./createReactComponent-DcxUhOxs.js";import"./table-CtXYL8Fg.js";import"./index-DCzpbC7R.js";import"./index-ChHWVpPk.js";import"./index-bd6ufVwP.js";import"./index-Qfb_IjkA.js";import"./index-Bt6K678h.js";import"./index-Bb0YeX9p.js";import"./index-fHPixuyN.js";import"./index-rpDruwTI.js";import"./check-DOj7a-5i.js";import"./index-BYO_HMiJ.js";import"./chevrons-up-down-2E7s93p_.js";const O={getKits:async s=>{const t=new URLSearchParams;s?.company&&t.append("companies",s.company);const a=`/api/kits/admin/list${t.toString()?`?${t.toString()}`:""}`;return F.get(a)},getKit:async s=>F.get(`/api/kits/${s}`),createKit:async s=>F.post("/api/kits",s),updateKit:async({_id:s,...t})=>F.patch(`/api/kits/${s}`,t),deleteKit:async s=>F.delete(`/api/kits/${s}`),unassignKit:async s=>F.patch(`/api/kits/unassign/${s}`,{})},xs=s=>le({queryKey:E.kits.list(s),queryFn:()=>O.getKits(s)}),hs=s=>le({queryKey:E.kits.detail(s),queryFn:()=>O.getKit(s),enabled:!!s}),us=()=>{const s=Q();return Y({mutationFn:O.createKit,onSuccess:()=>{s.invalidateQueries({queryKey:E.kits.all}),v.success("Kit created successfully")},onError:t=>{v.error(t.message||"Failed to create kit")}})},ps=()=>{const s=Q();return Y({mutationFn:O.updateKit,onSuccess:(t,a)=>{s.invalidateQueries({queryKey:E.kits.all}),s.invalidateQueries({queryKey:E.kits.detail(a._id)}),v.success("Kit updated successfully")},onError:t=>{v.error(t.message||"Failed to update kit")}})},js=()=>{const s=Q();return Y({mutationFn:O.deleteKit,onSuccess:()=>{s.invalidateQueries({queryKey:E.kits.all}),v.success("Kit deleted successfully")},onError:t=>{v.error(t.message||"Failed to delete kit")}})};function gs({table:s}){return e.jsxs(ie,{children:[e.jsx(ze,{asChild:!0,children:e.jsxs(w,{variant:"outline",size:"sm",className:"ml-auto hidden h-8 lg:flex",children:[e.jsx(_e,{className:"mr-2 h-4 w-4"}),"View"]})}),e.jsxs(oe,{align:"end",className:"w-[150px]",children:[e.jsx($e,{children:"Toggle columns"}),e.jsx(ce,{}),s.getAllColumns().filter(t=>typeof t.accessorFn<"u"&&t.getCanHide()).map(t=>e.jsx(Me,{className:"capitalize",checked:t.getIsVisible(),onCheckedChange:a=>t.toggleVisibility(!!a),children:t.id},t.id))]})]})}function fs({column:s,title:t,options:a}){const o=s?.getFacetedUniqueValues(),l=new Set(s?.getFilterValue());return e.jsxs(Qe,{children:[e.jsx(Ye,{asChild:!0,children:e.jsxs(w,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),t,l?.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(We,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(C,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:l.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:l.size>2?e.jsxs(C,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[l.size," selected"]}):a.filter(g=>l.has(g.value)).map(g=>e.jsx(C,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:g.label},g.value))})]})]})}),e.jsx(Je,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Le,{children:[e.jsx(Re,{placeholder:t}),e.jsxs(Ue,{children:[e.jsx(Be,{children:"No results found."}),e.jsx(se,{children:a.map(g=>{const b=l.has(g.value);return e.jsxs(te,{onSelect:()=>{b?l.delete(g.value):l.add(g.value);const D=Array.from(l);s?.setFilterValue(D.length?D:void 0)},children:[e.jsx("div",{className:_("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",b?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(Ee,{className:_("h-4 w-4")})}),g.icon&&e.jsx(g.icon,{className:"mr-2 h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:g.label}),o?.get(g.value)&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:o.get(g.value)})]},g.value)})}),l.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ge,{}),e.jsx(se,{children:e.jsx(te,{onSelect:()=>s?.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}var A=(s=>(s.CHECKING_STOCK="checking stock",s.AWAITING_STOCK="awaiting stock",s.ASSEMBLING_KIT="assembling kit",s.READY_TO_SHIP="ready to ship",s.SHIPPED="shipped",s.AWAITING_CONFIRMATION="awaiting confirmation",s.CONFIRMED="confirmed",s.CANCELLED="cancelled",s.RETURNED="returned",s))(A||{});const ys=xe({name:N().optional(),street:N().optional(),city:N().optional(),state:N().optional(),zipCode:N().optional(),country:N().optional()}),Ne=xe({name:N().min(1,"Kit name is required"),description:N().optional(),notes:N().optional(),tags:ae(N()).optional(),state:Ze(A).optional(),shippingAddress:ys.optional(),company:N().optional().nullable(),user:N().optional().nullable(),property:N().optional().nullable(),hardware:ae(N()).optional()}),ve=s=>({"checking stock":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300","awaiting stock":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300","assembling kit":"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300","ready to ship":"bg-indigo-100 text-indigo-700 dark:bg-indigo-900 dark:text-indigo-300",shipped:"bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300","awaiting confirmation":"bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300",confirmed:"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300",cancelled:"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300",returned:"bg-pink-100 text-pink-700 dark:bg-pink-900 dark:text-pink-300"})[s]||"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300",Ns=s=>{if(!s)return"-";const t=[s.name,s.street,s.city,s.state,s.zipCode,s.country].filter(Boolean);return t.length>0?t.join(", "):"-"};function vs({table:s}){const t=s.getState().columnFilters.length>0,a=Object.values(A).map(o=>({value:o,label:o}));return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 items-center space-x-2",children:[e.jsx(f,{placeholder:"Search kits...",value:s.getColumn("name")?.getFilterValue()??"",onChange:o=>s.getColumn("name")?.setFilterValue(o.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),s.getColumn("state")&&e.jsx(fs,{column:s.getColumn("state"),title:"State",options:a}),t&&e.jsxs(w,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["Reset",e.jsx(Pe,{className:"ml-2 h-4 w-4"})]})]}),e.jsx(gs,{table:s})]})}const Ce=y.createContext(void 0);function Cs({children:s}){const[t,a]=y.useState(null),[o,l]=y.useState(!1),[g,b]=y.useState(!1),[D,K]=y.useState(!1),[k,T]=y.useState(!1);return e.jsx(Ce.Provider,{value:{selectedKit:t,setSelectedKit:a,isCreateDialogOpen:o,setIsCreateDialogOpen:l,isEditDialogOpen:g,setIsEditDialogOpen:b,isViewDialogOpen:D,setIsViewDialogOpen:K,isDeleteDialogOpen:k,setIsDeleteDialogOpen:T},children:s})}function P(){const s=y.useContext(Ce);if(!s)throw new Error("useKitsContext must be used within KitsProvider");return s}function ws({row:s}){const t=s.original,{setSelectedKit:a,setIsEditDialogOpen:o,setIsViewDialogOpen:l,setIsDeleteDialogOpen:g}=P();return e.jsxs(ie,{children:[e.jsx(He,{asChild:!0,children:e.jsxs(w,{variant:"ghost",className:"flex h-8 w-8 p-0 data-[state=open]:bg-muted",children:[e.jsx(Oe,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Open menu"})]})}),e.jsxs(oe,{align:"end",className:"w-[160px]",children:[e.jsx(G,{onClick:()=>{a(t),l(!0)},children:"View"}),e.jsx(G,{onClick:()=>{a(t),o(!0)},children:"Edit"}),e.jsx(ce,{}),e.jsxs(G,{onClick:()=>{a(t),g(!0)},className:"text-red-600",children:["Delete",e.jsx(qe,{children:"⌘⌫"})]})]})]})}const ne=[{id:"select",header:({table:s})=>e.jsx(re,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:t=>s.toggleAllPageRowsSelected(!!t),"aria-label":"Select all",className:"translate-y-[2px]"}),meta:{className:_("sticky md:table-cell left-0 z-10 rounded-tl","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted")},cell:({row:s})=>e.jsx(re,{checked:s.getIsSelected(),onCheckedChange:t=>s.toggleSelected(!!t),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:({column:s})=>e.jsx(S,{column:s,title:"Name"}),cell:({row:s})=>{const t=s.getValue("name");return e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(Xe,{className:"max-w-48 font-medium",children:t})})},meta:{className:_("drop-shadow-[0_1px_2px_rgb(0_0_0_/_0.1)] dark:drop-shadow-[0_1px_2px_rgb(255_255_255_/_0.1)] lg:drop-shadow-none","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted","sticky left-6 md:table-cell")},enableHiding:!1},{accessorKey:"state",header:({column:s})=>e.jsx(S,{column:s,title:"State"}),cell:({row:s})=>{const t=s.getValue("state");return e.jsx(C,{className:_("font-medium",ve(t)),children:t})},filterFn:(s,t,a)=>a.includes(s.getValue(t))},{id:"company",header:({column:s})=>e.jsx(S,{column:s,title:"Company"}),cell:({row:s})=>{const t=s.original.company||s.original.user?.company;return e.jsx("div",{className:"text-nowrap",children:t?.name||e.jsx("span",{className:"text-muted-foreground",children:"-"})})},enableSorting:!1},{id:"user",header:({column:s})=>e.jsx(S,{column:s,title:"User"}),cell:({row:s})=>{const t=s.original.user;return t?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm",children:t.firstName&&t.lastName?`${t.firstName} ${t.lastName}`:t.email}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t.email})]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})},enableSorting:!1},{id:"property",header:({column:s})=>e.jsx(S,{column:s,title:"Property"}),cell:({row:s})=>{const t=s.original.property;return t?e.jsxs("div",{className:"text-nowrap",children:[e.jsxs("div",{className:"text-sm",children:[t.shortAddress,t.unit&&` Unit ${t.unit}`]}),t.city&&t.state&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[t.city,", ",t.state]})]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})},enableSorting:!1},{id:"hardware",header:({column:s})=>e.jsx(S,{column:s,title:"Hardware"}),cell:({row:s})=>{const t=s.original.hardware?.length||0;return e.jsx("div",{className:"text-center",children:e.jsx(C,{variant:"secondary",children:t})})},enableSorting:!1},{id:"tags",header:({column:s})=>e.jsx(S,{column:s,title:"Tags"}),cell:({row:s})=>{const t=s.original.tags||[];return t.length===0?e.jsx("span",{className:"text-muted-foreground",children:"-"}):e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.slice(0,3).map((a,o)=>e.jsx(C,{variant:"outline",className:"text-xs",children:a},o)),t.length>3&&e.jsxs(C,{variant:"outline",className:"text-xs",children:["+",t.length-3]})]})},enableSorting:!1},{id:"actions",cell:({row:s})=>e.jsx(ws,{row:s}),meta:{className:_("sticky md:table-cell right-0 z-10","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted")}}];function bs({data:s,isLoading:t}){const{table:a}=Ie({data:s,columns:ne});return e.jsx(Fe,{table:a,columns:ne,isLoading:t,toolbar:e.jsx(vs,{table:a}),showToolbar:!0})}function Ds(){const{isCreateDialogOpen:s,setIsCreateDialogOpen:t}=P(),a=us(),[o,l]=y.useState([]),[g,b]=y.useState([]),[D,K]=y.useState(!1),[k,T]=y.useState(""),p=he({resolver:ue(Ne),defaultValues:{name:"",description:"",notes:"",tags:[],state:A.CHECKING_STOCK,shippingAddress:{name:"",street:"",city:"",state:"",zipCode:"",country:""},company:null,user:null,property:null,hardware:[]}});y.useEffect(()=>{s&&I()},[s]);const I=async()=>{K(!0);try{const[r,i]=await Promise.all([ge.list(),fe.getProperties()]);l(r),b(i)}catch{v.error("Failed to load form data")}finally{K(!1)}},z=async r=>{try{await a.mutateAsync(r),v.success("Kit created successfully"),p.reset(),t(!1)}catch{v.error("Failed to create kit")}},j=r=>{if(r.key==="Enter"&&k.trim()){r.preventDefault();const i=p.getValues("tags")??[];i.includes(k.trim())||p.setValue("tags",[...i,k.trim()]),T("")}},U=r=>{const i=p.getValues("tags")??[];p.setValue("tags",i.filter(B=>B!==r))};return e.jsx(J,{open:s,onOpenChange:t,children:e.jsxs(W,{className:"sm:max-w-[725px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Z,{children:[e.jsx(X,{children:"Create Kit"}),e.jsx(ee,{children:"Add a new kit to your system. Fill in the kit details below."})]}),D?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx($,{className:"h-8 w-8 animate-spin"})}):e.jsx(pe,{...p,children:e.jsxs("form",{onSubmit:p.handleSubmit(z),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{control:p.control,name:"name",render:({field:r})=>e.jsxs(m,{children:[e.jsx(x,{children:"Name *"}),e.jsx(u,{children:e.jsx(f,{placeholder:"Enter kit name",...r})}),e.jsx(h,{})]})}),e.jsx(d,{control:p.control,name:"company",render:({field:r})=>e.jsxs(m,{children:[e.jsx(x,{children:"Company"}),e.jsx(je,{value:r.value,onValueChange:r.onChange,placeholder:"Select company"}),e.jsx(h,{})]})}),e.jsx(d,{control:p.control,name:"hardware",render:({field:r})=>e.jsxs(m,{className:"col-span-2",children:[e.jsx(x,{children:"Hardware"}),e.jsx(u,{children:e.jsx(ye,{options:o.map(i=>({label:`${i.name} (${i.category})`,value:i._id})),onValueChange:r.onChange,value:r.value??[],placeholder:"Select hardware"})}),e.jsx(h,{})]})}),e.jsx(d,{control:p.control,name:"state",render:({field:r})=>e.jsxs(m,{children:[e.jsx(x,{children:"State *"}),e.jsxs(M,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(u,{children:e.jsx(H,{children:e.jsx(q,{placeholder:"Select state"})})}),e.jsx(L,{children:Object.values(A).map(i=>e.jsx(V,{value:i,children:i},i))})]}),e.jsx(h,{})]})}),e.jsx(d,{control:p.control,name:"property",render:({field:r})=>e.jsxs(m,{children:[e.jsx(x,{children:"Property"}),e.jsxs(M,{onValueChange:i=>r.onChange(i==="none"?null:i),value:r.value||"none",children:[e.jsx(u,{children:e.jsx(H,{children:e.jsx(q,{placeholder:"Select property"})})}),e.jsxs(L,{children:[e.jsx(V,{value:"none",children:"None"}),g.map(i=>e.jsxs(V,{value:i._id,children:[i.shortAddress,i.unit&&` Unit ${i.unit}`,i.city&&i.state&&` - ${i.city}, ${i.state}`]},i._id))]})]}),e.jsx(h,{})]})}),e.jsx(d,{control:p.control,name:"description",render:({field:r})=>e.jsxs(m,{className:"col-span-2",children:[e.jsx(x,{children:"Description"}),e.jsx(u,{children:e.jsx(R,{placeholder:"Enter kit description",className:"resize-none",...r})}),e.jsx(h,{})]})}),e.jsx(d,{control:p.control,name:"notes",render:({field:r})=>e.jsxs(m,{className:"col-span-2",children:[e.jsx(x,{children:"Notes"}),e.jsx(u,{children:e.jsx(R,{placeholder:"Enter notes",className:"resize-none",...r})}),e.jsx(h,{})]})}),e.jsx(d,{control:p.control,name:"tags",render:({field:r})=>e.jsxs(m,{className:"col-span-2",children:[e.jsx(x,{children:"Tags"}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{placeholder:"Type a tag and press Enter",value:k,onChange:i=>T(i.target.value),onKeyDown:j}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(r.value??[]).map(i=>e.jsxs(C,{variant:"secondary",children:[i,e.jsx(w,{type:"button",variant:"ghost",size:"sm",className:"ml-1 h-auto p-0",onClick:()=>U(i),children:e.jsx(de,{className:"h-3 w-3"})})]},i))})]})}),e.jsx(h,{})]})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Shipping Address"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{control:p.control,name:"shippingAddress.name",render:({field:r})=>e.jsxs(m,{children:[e.jsx(x,{children:"Name"}),e.jsx(u,{children:e.jsx(f,{placeholder:"John Doe",...r})}),e.jsx(h,{})]})}),e.jsx(d,{control:p.control,name:"shippingAddress.street",render:({field:r})=>e.jsxs(m,{children:[e.jsx(x,{children:"Street"}),e.jsx(u,{children:e.jsx(f,{placeholder:"123 Main St",...r})}),e.jsx(h,{})]})}),e.jsx(d,{control:p.control,name:"shippingAddress.city",render:({field:r})=>e.jsxs(m,{children:[e.jsx(x,{children:"City"}),e.jsx(u,{children:e.jsx(f,{placeholder:"New York",...r})}),e.jsx(h,{})]})}),e.jsx(d,{control:p.control,name:"shippingAddress.state",render:({field:r})=>e.jsxs(m,{children:[e.jsx(x,{children:"State"}),e.jsx(u,{children:e.jsx(f,{placeholder:"NY",...r})}),e.jsx(h,{})]})}),e.jsx(d,{control:p.control,name:"shippingAddress.zipCode",render:({field:r})=>e.jsxs(m,{children:[e.jsx(x,{children:"Zip Code"}),e.jsx(u,{children:e.jsx(f,{placeholder:"10001",...r})}),e.jsx(h,{})]})}),e.jsx(d,{control:p.control,name:"shippingAddress.country",render:({field:r})=>e.jsxs(m,{children:[e.jsx(x,{children:"Country"}),e.jsx(u,{children:e.jsx(f,{placeholder:"USA",...r})}),e.jsx(h,{})]})})]})]})]}),e.jsxs(me,{children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancel"}),e.jsxs(w,{type:"submit",disabled:a.isPending,children:[a.isPending&&e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Kit"]})]})]})})]})})}function ks(){const{isEditDialogOpen:s,setIsEditDialogOpen:t,selectedKit:a}=P(),o=ps(),{data:l,isLoading:g}=hs(a?._id||""),[b,D]=y.useState([]),[K,k]=y.useState([]),[T,p]=y.useState(!1),[I,z]=y.useState(""),j=he({resolver:ue(Ne),defaultValues:{name:"",description:"",notes:"",tags:[],state:A.CHECKING_STOCK,shippingAddress:{name:"",street:"",city:"",state:"",zipCode:"",country:""},company:null,user:null,property:null,hardware:[]}});y.useEffect(()=>{s&&l&&(U(),j.reset({name:l.name||"",description:l.description||"",notes:l.notes||"",tags:l.tags||[],state:l.state,shippingAddress:{name:l.shippingAddress?.name||"",street:l.shippingAddress?.street||"",city:l.shippingAddress?.city||"",state:l.shippingAddress?.state||"",zipCode:l.shippingAddress?.zipCode||"",country:l.shippingAddress?.country||""},company:l.company?._id||null,user:l.user?._id||null,property:l.property?._id||null,hardware:l.hardware?.map(n=>n._id)||[]}))},[s,l,j]);const U=async()=>{p(!0);try{const[n,c]=await Promise.all([ge.list(),fe.getProperties()]);D(n),k(c)}catch{v.error("Failed to load form data")}finally{p(!1)}},r=async n=>{if(a)try{await o.mutateAsync({_id:a._id,...n}),v.success("Kit updated successfully"),t(!1)}catch{v.error("Failed to update kit")}},i=n=>{if(n.key==="Enter"&&I.trim()){n.preventDefault();const c=j.getValues("tags")??[];c.includes(I.trim())||j.setValue("tags",[...c,I.trim()]),z("")}},B=n=>{const c=j.getValues("tags")??[];j.setValue("tags",c.filter(we=>we!==n))};return e.jsx(J,{open:s,onOpenChange:t,children:e.jsxs(W,{className:"sm:max-w-[725px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Z,{children:[e.jsx(X,{children:"Edit Kit"}),e.jsx(ee,{children:"Update the kit details below."})]}),T||g?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx($,{className:"h-8 w-8 animate-spin"})}):e.jsx(pe,{...j,children:e.jsxs("form",{onSubmit:j.handleSubmit(r),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{control:j.control,name:"name",render:({field:n})=>e.jsxs(m,{children:[e.jsx(x,{children:"Name *"}),e.jsx(u,{children:e.jsx(f,{placeholder:"Enter kit name",...n})}),e.jsx(h,{})]})}),e.jsx(d,{control:j.control,name:"state",render:({field:n})=>e.jsxs(m,{children:[e.jsx(x,{children:"State *"}),e.jsxs(M,{onValueChange:n.onChange,value:n.value,children:[e.jsx(u,{children:e.jsx(H,{children:e.jsx(q,{placeholder:"Select state"})})}),e.jsx(L,{children:Object.values(A).map(c=>e.jsx(V,{value:c,children:c},c))})]}),e.jsx(h,{})]})}),e.jsx(d,{control:j.control,name:"description",render:({field:n})=>e.jsxs(m,{className:"col-span-2",children:[e.jsx(x,{children:"Description"}),e.jsx(u,{children:e.jsx(R,{placeholder:"Enter kit description",className:"resize-none",...n})}),e.jsx(h,{})]})}),e.jsx(d,{control:j.control,name:"notes",render:({field:n})=>e.jsxs(m,{className:"col-span-2",children:[e.jsx(x,{children:"Notes"}),e.jsx(u,{children:e.jsx(R,{placeholder:"Enter notes",className:"resize-none",...n})}),e.jsx(h,{})]})}),e.jsx(d,{control:j.control,name:"tags",render:({field:n})=>e.jsxs(m,{className:"col-span-2",children:[e.jsx(x,{children:"Tags"}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{placeholder:"Type a tag and press Enter",value:I,onChange:c=>z(c.target.value),onKeyDown:i}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(n.value??[]).map(c=>e.jsxs(C,{variant:"secondary",children:[c,e.jsx(w,{type:"button",variant:"ghost",size:"sm",className:"ml-1 h-auto p-0",onClick:()=>B(c),children:e.jsx(de,{className:"h-3 w-3"})})]},c))})]})}),e.jsx(h,{})]})}),e.jsx(d,{control:j.control,name:"company",render:({field:n})=>e.jsxs(m,{children:[e.jsx(x,{children:"Company"}),e.jsx(je,{value:n.value,onValueChange:n.onChange,placeholder:"Select company"}),e.jsx(h,{})]})}),e.jsx(d,{control:j.control,name:"property",render:({field:n})=>e.jsxs(m,{children:[e.jsx(x,{children:"Property"}),e.jsxs(M,{onValueChange:c=>n.onChange(c==="none"?null:c),value:n.value||"none",children:[e.jsx(u,{children:e.jsx(H,{children:e.jsx(q,{placeholder:"Select property"})})}),e.jsxs(L,{children:[e.jsx(V,{value:"none",children:"None"}),K.map(c=>e.jsxs(V,{value:c._id,children:[c.shortAddress,c.unit&&` Unit ${c.unit}`,c.city&&c.state&&` - ${c.city}, ${c.state}`]},c._id))]})]}),e.jsx(h,{})]})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Shipping Address"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{control:j.control,name:"shippingAddress.name",render:({field:n})=>e.jsxs(m,{children:[e.jsx(x,{children:"Name"}),e.jsx(u,{children:e.jsx(f,{placeholder:"John Doe",...n})}),e.jsx(h,{})]})}),e.jsx(d,{control:j.control,name:"shippingAddress.street",render:({field:n})=>e.jsxs(m,{children:[e.jsx(x,{children:"Street"}),e.jsx(u,{children:e.jsx(f,{placeholder:"123 Main St",...n})}),e.jsx(h,{})]})}),e.jsx(d,{control:j.control,name:"shippingAddress.city",render:({field:n})=>e.jsxs(m,{children:[e.jsx(x,{children:"City"}),e.jsx(u,{children:e.jsx(f,{placeholder:"New York",...n})}),e.jsx(h,{})]})}),e.jsx(d,{control:j.control,name:"shippingAddress.state",render:({field:n})=>e.jsxs(m,{children:[e.jsx(x,{children:"State"}),e.jsx(u,{children:e.jsx(f,{placeholder:"NY",...n})}),e.jsx(h,{})]})}),e.jsx(d,{control:j.control,name:"shippingAddress.zipCode",render:({field:n})=>e.jsxs(m,{children:[e.jsx(x,{children:"Zip Code"}),e.jsx(u,{children:e.jsx(f,{placeholder:"10001",...n})}),e.jsx(h,{})]})}),e.jsx(d,{control:j.control,name:"shippingAddress.country",render:({field:n})=>e.jsxs(m,{children:[e.jsx(x,{children:"Country"}),e.jsx(u,{children:e.jsx(f,{placeholder:"USA",...n})}),e.jsx(h,{})]})})]})]}),e.jsx(d,{control:j.control,name:"hardware",render:({field:n})=>e.jsxs(m,{className:"col-span-2",children:[e.jsx(x,{children:"Hardware"}),e.jsx(u,{children:e.jsx(ye,{options:b.map(c=>({label:`${c.name} (${c.category})`,value:c._id})),onValueChange:n.onChange,value:n.value??[],placeholder:"Select hardware"})}),e.jsx(h,{})]})})]}),e.jsxs(me,{children:[e.jsx(w,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancel"}),e.jsxs(w,{type:"submit",disabled:o.isPending,children:[o.isPending&&e.jsx($,{className:"mr-2 h-4 w-4 animate-spin"}),"Update Kit"]})]})]})})]})})}function Ss(){const{isViewDialogOpen:s,setIsViewDialogOpen:t,selectedKit:a}=P();return a?e.jsx(J,{open:s,onOpenChange:t,children:e.jsxs(W,{className:"sm:max-w-[625px]",children:[e.jsxs(Z,{children:[e.jsx(X,{children:"Kit Details"}),e.jsx(ee,{children:"View detailed information about the kit."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Name"}),e.jsx("p",{className:"text-sm",children:a.name})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"State"}),e.jsx(C,{className:ve(a.state),children:a.state})]})]}),a.description&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Description"}),e.jsx("p",{className:"text-sm",children:a.description})]}),a.notes&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Notes"}),e.jsx("p",{className:"text-sm",children:a.notes})]}),a.tags&&a.tags.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.tags.map((o,l)=>e.jsx(C,{variant:"secondary",children:o},l))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Company"}),e.jsx("p",{className:"text-sm",children:a.company?.name||"-"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"User"}),a.user?e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{children:a.user.firstName&&a.user.lastName?`${a.user.firstName} ${a.user.lastName}`:a.user.email}),e.jsx("p",{className:"text-muted-foreground",children:a.user.email})]}):e.jsx("p",{className:"text-sm",children:"-"})]})]}),a.property&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Property"}),e.jsxs("p",{className:"text-sm",children:[a.property.shortAddress,a.property.unit&&` Unit ${a.property.unit}`,a.property.city&&a.property.state&&` - ${a.property.city}, ${a.property.state}`]})]}),a.shippingAddress&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Shipping Address"}),e.jsx("p",{className:"text-sm",children:Ns(a.shippingAddress)})]}),a.hardware&&a.hardware.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-2",children:["Hardware (",a.hardware.length,")"]}),e.jsx("div",{className:"space-y-1",children:a.hardware.map(o=>e.jsxs("div",{className:"text-sm",children:[o.name," ",o.category&&e.jsxs("span",{className:"text-muted-foreground",children:["(",o.category,")"]})]},o._id))})]}),a.assignedDate&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Assigned Date"}),e.jsx("p",{className:"text-sm",children:new Date(a.assignedDate).toLocaleDateString()})]}),a.device_id&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Device ID"}),e.jsx("p",{className:"text-sm font-mono",children:a.device_id})]})]})]})}):null}function As(){const{isDeleteDialogOpen:s,setIsDeleteDialogOpen:t,selectedKit:a}=P(),o=js(),l=async()=>{if(a)try{await o.mutateAsync(a._id),t(!1)}catch{v.error("Failed to delete kit")}};return e.jsx(ss,{open:s,onOpenChange:t,children:e.jsxs(ts,{children:[e.jsxs(as,{children:[e.jsx(rs,{children:"Are you absolutely sure?"}),e.jsxs(ns,{children:["This action cannot be undone. This will permanently delete the kit",a?.name&&` "${a.name}"`," and remove it from our servers."]})]}),e.jsxs(ls,{children:[e.jsx(is,{children:"Cancel"}),e.jsx(os,{onClick:l,disabled:o.isPending,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:o.isPending?"Deleting...":"Delete"})]})]})})}function Ks(){const{setIsCreateDialogOpen:s}=P();return e.jsxs(w,{onClick:()=>s(!0),children:[e.jsx(es,{className:"mr-2 h-4 w-4"}),"Add Kit"]})}function Ts(){const s=be({strict:!1}),{data:t=[],isLoading:a,error:o}=xs(s.company?{company:s.company}:void 0);return e.jsxs(Cs,{children:[e.jsxs(De,{fixed:!0,children:[e.jsx(ke,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Se,{}),e.jsx(Ae,{}),e.jsx(Ke,{})]})]}),e.jsxs(Te,{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Kits"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage and organize your hardware kits."})]}),e.jsx(Ks,{})]}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:o?e.jsxs(cs,{variant:"destructive",children:[e.jsx(ds,{className:"h-4 w-4"}),e.jsxs(ms,{children:["Failed to load kits. ",o instanceof Error?o.message:"Please try again later."]})]}):e.jsxs(e.Fragment,{children:[e.jsx(bs,{data:t,isLoading:a}),e.jsx(Ds,{}),e.jsx(ks,{}),e.jsx(Ss,{}),e.jsx(As,{})]})})]})]})}const xt=Ts;export{xt as component};
