import{k as Q,t as C,j as e,B as D,d as V,r as y,h as q,a as be}from"./index-Dv1JWxNr.js";import{u as le,b as Y,q as E,c as F,d as De,H as ke,S as Se,a as Ae,T as Ke,P as Te,M as Ie}from"./header-company-dropdown--Awgxzay.js";import{u as _e,D as Fe}from"./use-data-table-BNvWa4ET.js";import{M as Ve,P as Ee,C as Pe,a as Oe,D as ze}from"./react-icons.esm-BLmnETz0.js";import{I as f}from"./input-B_unVzQI.js";import{D as ie,B as $e,f as oe,g as Me,h as ce,z as He,e as Le,i as G,p as qe}from"./avatar-BAwvz_Zl.js";import{B as b}from"./badge-KVwFvJ3A.js";import{C as Re,a as Ue,b as Be,c as Ge,d as se,e as te,f as Qe,D as J,g as W,h as Z,i as X,j as ee,X as de,k as xe}from"./command-DcTOLZl5.js";import{P as Ye,a as Je,b as We}from"./popover-UlTbB9Ed.js";import{S as Ze}from"./separator-C7xfAAuo.js";import{o as me,a as ae,s as v,n as Xe}from"./types-Wky072k2.js";import{C as re}from"./checkbox-9cVOoBuM.js";import{D as K}from"./data-table-column-header-BQ28lyg8.js";import{L as es}from"./long-text-29-VbLTc.js";import{e as u,u as he,a as ue,F as pe,b as d,c as x,d as m,f as h}from"./form-CZQoOBB7.js";import{S as O,a as z,b as $,c as M,d as A}from"./select-C_Vy9nNB.js";import{T as R}from"./textarea-C-bf1LMq.js";import{h as je}from"./hardware-api-BkQYR9DK.js";import{s as ge,M as fe,C as ss}from"./multi-select-hyra1fT4.js";import{A as ts,a as as,b as rs,c as ns,d as ls,e as is,f as os,g as cs}from"./alert-dialog-7a_uNcYv.js";import{A as ds,I as xs,a as ms}from"./alert-QKjxu_J9.js";import"./createReactComponent-DEfHJg2M.js";import"./table-CR31dl_A.js";import"./index-CHnWnazZ.js";import"./index-jslwB8KE.js";import"./index-DF1ouENV.js";import"./index-GwslycKq.js";import"./index-D-kAnGCt.js";import"./index-BmzB4KP7.js";import"./index-CEbF_H-L.js";import"./index-mCotDcwq.js";import"./check-BqR35Gvj.js";import"./index-Bx3FAcJY.js";import"./chevrons-up-down-9TPJUjFl.js";const H={getKits:async s=>{const t=new URLSearchParams;s?.company&&t.append("companies",s.company);const a=`/api/kits/admin/list${t.toString()?`?${t.toString()}`:""}`;return F.get(a)},getKit:async s=>F.get(`/api/kits/${s}`),createKit:async s=>F.post("/api/kits",s),updateKit:async({_id:s,...t})=>F.patch(`/api/kits/${s}`,t),deleteKit:async s=>F.delete(`/api/kits/${s}`),unassignKit:async s=>F.patch(`/api/kits/unassign/${s}`,{})},hs=s=>le({queryKey:E.kits.list(s),queryFn:()=>H.getKits(s)}),us=s=>le({queryKey:E.kits.detail(s),queryFn:()=>H.getKit(s),enabled:!!s}),ps=()=>{const s=Q();return Y({mutationFn:H.createKit,onSuccess:()=>{s.invalidateQueries({queryKey:E.kits.all}),C.success("Kit created successfully")},onError:t=>{C.error(t.message||"Failed to create kit")}})},js=()=>{const s=Q();return Y({mutationFn:H.updateKit,onSuccess:(t,a)=>{s.invalidateQueries({queryKey:E.kits.all}),s.invalidateQueries({queryKey:E.kits.detail(a._id)}),C.success("Kit updated successfully")},onError:t=>{C.error(t.message||"Failed to update kit")}})},gs=()=>{const s=Q();return Y({mutationFn:H.deleteKit,onSuccess:()=>{s.invalidateQueries({queryKey:E.kits.all}),C.success("Kit deleted successfully")},onError:t=>{C.error(t.message||"Failed to delete kit")}})};function fs({table:s}){return e.jsxs(ie,{children:[e.jsx($e,{asChild:!0,children:e.jsxs(D,{variant:"outline",size:"sm",className:"ml-auto hidden h-8 lg:flex",children:[e.jsx(Ve,{className:"mr-2 h-4 w-4"}),"View"]})}),e.jsxs(oe,{align:"end",className:"w-[150px]",children:[e.jsx(Me,{children:"Toggle columns"}),e.jsx(ce,{}),s.getAllColumns().filter(t=>typeof t.accessorFn<"u"&&t.getCanHide()).map(t=>e.jsx(He,{className:"capitalize",checked:t.getIsVisible(),onCheckedChange:a=>t.toggleVisibility(!!a),children:t.id},t.id))]})]})}function ys({column:s,title:t,options:a}){const i=s?.getFacetedUniqueValues(),l=new Set(s?.getFilterValue());return e.jsxs(Ye,{children:[e.jsx(Je,{asChild:!0,children:e.jsxs(D,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),t,l?.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ze,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(b,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:l.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:l.size>2?e.jsxs(b,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[l.size," selected"]}):a.filter(p=>l.has(p.value)).map(p=>e.jsx(b,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:p.label},p.value))})]})]})}),e.jsx(We,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Re,{children:[e.jsx(Ue,{placeholder:t}),e.jsxs(Be,{children:[e.jsx(Ge,{children:"No results found."}),e.jsx(se,{children:a.map(p=>{const k=l.has(p.value);return e.jsxs(te,{onSelect:()=>{k?l.delete(p.value):l.add(p.value);const w=Array.from(l);s?.setFilterValue(w.length?w:void 0)},children:[e.jsx("div",{className:V("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",k?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(Pe,{className:V("h-4 w-4")})}),p.icon&&e.jsx(p.icon,{className:"mr-2 h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:p.label}),i?.get(p.value)&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:i.get(p.value)})]},p.value)})}),l.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(Qe,{}),e.jsx(se,{children:e.jsx(te,{onSelect:()=>s?.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}var T=(s=>(s.CHECKING_STOCK="checking stock",s.AWAITING_STOCK="awaiting stock",s.ASSEMBLING_KIT="assembling kit",s.READY_TO_SHIP="ready to ship",s.SHIPPED="shipped",s.AWAITING_CONFIRMATION="awaiting confirmation",s.CONFIRMED="confirmed",s.CANCELLED="cancelled",s.RETURNED="returned",s))(T||{});const Ns=me({name:v().optional(),street:v().optional(),city:v().optional(),state:v().optional(),zipCode:v().optional(),country:v().optional()}),ye=me({name:v().min(1,"Kit name is required"),description:v().optional(),notes:v().optional(),tags:ae(v()).optional(),state:Xe(T).optional(),shippingAddress:Ns.optional(),company:v().optional().nullable(),user:v().optional().nullable(),property:v().optional().nullable(),hardware:ae(v()).optional()}),Ne=s=>({"checking stock":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300","awaiting stock":"bg-yellow-100 text-yellow-700 dark:bg-yellow-900 dark:text-yellow-300","assembling kit":"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300","ready to ship":"bg-indigo-100 text-indigo-700 dark:bg-indigo-900 dark:text-indigo-300",shipped:"bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300","awaiting confirmation":"bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300",confirmed:"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300",cancelled:"bg-red-100 text-red-700 dark:bg-red-900 dark:text-red-300",returned:"bg-pink-100 text-pink-700 dark:bg-pink-900 dark:text-pink-300"})[s]||"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300",vs=s=>{if(!s)return"-";const t=[s.name,s.street,s.city,s.state,s.zipCode,s.country].filter(Boolean);return t.length>0?t.join(", "):"-"};function Cs({table:s}){const t=s.getState().columnFilters.length>0,a=Object.values(T).map(i=>({value:i,label:i}));return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 items-center space-x-2",children:[e.jsx(f,{placeholder:"Search kits...",value:s.getColumn("name")?.getFilterValue()??"",onChange:i=>s.getColumn("name")?.setFilterValue(i.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),s.getColumn("state")&&e.jsx(ys,{column:s.getColumn("state"),title:"State",options:a}),t&&e.jsxs(D,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["Reset",e.jsx(Oe,{className:"ml-2 h-4 w-4"})]})]}),e.jsx(fs,{table:s})]})}const ve=y.createContext(void 0);function ws({children:s}){const[t,a]=y.useState(null),[i,l]=y.useState(!1),[p,k]=y.useState(!1),[w,S]=y.useState(!1),[N,I]=y.useState(!1);return e.jsx(ve.Provider,{value:{selectedKit:t,setSelectedKit:a,isCreateDialogOpen:i,setIsCreateDialogOpen:l,isEditDialogOpen:p,setIsEditDialogOpen:k,isViewDialogOpen:w,setIsViewDialogOpen:S,isDeleteDialogOpen:N,setIsDeleteDialogOpen:I},children:s})}function P(){const s=y.useContext(ve);if(!s)throw new Error("useKitsContext must be used within KitsProvider");return s}function bs({row:s}){const t=s.original,{setSelectedKit:a,setIsEditDialogOpen:i,setIsViewDialogOpen:l,setIsDeleteDialogOpen:p}=P();return e.jsxs(ie,{children:[e.jsx(Le,{asChild:!0,children:e.jsxs(D,{variant:"ghost",className:"flex h-8 w-8 p-0 data-[state=open]:bg-muted",children:[e.jsx(ze,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Open menu"})]})}),e.jsxs(oe,{align:"end",className:"w-[160px]",children:[e.jsx(G,{onClick:()=>{a(t),l(!0)},children:"View"}),e.jsx(G,{onClick:()=>{a(t),i(!0)},children:"Edit"}),e.jsx(ce,{}),e.jsxs(G,{onClick:()=>{a(t),p(!0)},className:"text-red-600",children:["Delete",e.jsx(qe,{children:"⌘⌫"})]})]})]})}const ne=[{id:"select",header:({table:s})=>e.jsx(re,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:t=>s.toggleAllPageRowsSelected(!!t),"aria-label":"Select all",className:"translate-y-[2px]"}),meta:{className:V("sticky md:table-cell left-0 z-10 rounded-tl","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted")},cell:({row:s})=>e.jsx(re,{checked:s.getIsSelected(),onCheckedChange:t=>s.toggleSelected(!!t),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:({column:s})=>e.jsx(K,{column:s,title:"Name"}),cell:({row:s})=>{const t=s.getValue("name");return e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(es,{className:"max-w-48 font-medium",children:t})})},meta:{className:V("drop-shadow-[0_1px_2px_rgb(0_0_0_/_0.1)] dark:drop-shadow-[0_1px_2px_rgb(255_255_255_/_0.1)] lg:drop-shadow-none","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted","sticky left-6 md:table-cell")},enableHiding:!1},{accessorKey:"state",header:({column:s})=>e.jsx(K,{column:s,title:"State"}),cell:({row:s})=>{const t=s.getValue("state");return e.jsx(b,{className:V("font-medium",Ne(t)),children:t})},filterFn:(s,t,a)=>a.includes(s.getValue(t))},{id:"company",header:({column:s})=>e.jsx(K,{column:s,title:"Company"}),cell:({row:s})=>{const t=s.original.company||s.original.user?.company;return e.jsx("div",{className:"text-nowrap",children:t?.name||e.jsx("span",{className:"text-muted-foreground",children:"-"})})},enableSorting:!1},{id:"user",header:({column:s})=>e.jsx(K,{column:s,title:"User"}),cell:({row:s})=>{const t=s.original.user;return t?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm",children:t.firstName&&t.lastName?`${t.firstName} ${t.lastName}`:t.email}),e.jsx("div",{className:"text-xs text-muted-foreground",children:t.email})]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})},enableSorting:!1},{id:"property",header:({column:s})=>e.jsx(K,{column:s,title:"Property"}),cell:({row:s})=>{const t=s.original.property;return t?e.jsxs("div",{className:"text-nowrap",children:[e.jsxs("div",{className:"text-sm",children:[t.shortAddress,t.unit&&` Unit ${t.unit}`]}),t.city&&t.state&&e.jsxs("div",{className:"text-xs text-muted-foreground",children:[t.city,", ",t.state]})]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})},enableSorting:!1},{id:"hardware",header:({column:s})=>e.jsx(K,{column:s,title:"Hardware"}),cell:({row:s})=>{const t=s.original.hardware?.length||0;return e.jsx("div",{className:"text-center",children:e.jsx(b,{variant:"secondary",children:t})})},enableSorting:!1},{id:"tags",header:({column:s})=>e.jsx(K,{column:s,title:"Tags"}),cell:({row:s})=>{const t=s.original.tags||[];return t.length===0?e.jsx("span",{className:"text-muted-foreground",children:"-"}):e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.slice(0,3).map((a,i)=>e.jsx(b,{variant:"outline",className:"text-xs",children:a},i)),t.length>3&&e.jsxs(b,{variant:"outline",className:"text-xs",children:["+",t.length-3]})]})},enableSorting:!1},{id:"actions",cell:({row:s})=>e.jsx(bs,{row:s}),meta:{className:V("sticky md:table-cell right-0 z-10","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted")}}];function Ds({data:s,isLoading:t}){const{table:a}=_e({data:s,columns:ne});return e.jsx(Fe,{table:a,columns:ne,isLoading:t,toolbar:e.jsx(Cs,{table:a}),showToolbar:!0})}function Ce({value:s,onValueChange:t,placeholder:a="Select company",includeNone:i=!0,disabled:l=!1,className:p}){const{data:k=[],isLoading:w,error:S}=De();return S?e.jsx("div",{className:"text-sm text-destructive",children:"Failed to load companies"}):e.jsxs(O,{value:s||(i?"none":void 0),onValueChange:N=>t(N==="none"?null:N),disabled:l||w,children:[e.jsx(u,{children:e.jsx(z,{className:p,children:e.jsx($,{placeholder:w?"Loading companies...":a})})}),e.jsxs(M,{children:[i&&e.jsx(A,{value:"none",children:"None"}),k.map(N=>e.jsx(A,{value:N._id,children:N.name},N._id))]})]})}function ks(){const{isCreateDialogOpen:s,setIsCreateDialogOpen:t}=P(),a=ps(),[i,l]=y.useState([]),[p,k]=y.useState([]),[w,S]=y.useState(!1),[N,I]=y.useState(""),j=he({resolver:ue(ye),defaultValues:{name:"",description:"",notes:"",tags:[],state:T.CHECKING_STOCK,shippingAddress:{name:"",street:"",city:"",state:"",zipCode:"",country:""},company:null,user:null,property:null,hardware:[]}});y.useEffect(()=>{s&&_()},[s]);const _=async()=>{S(!0);try{const[r,o]=await Promise.all([je.list(),ge.getProperties()]);l(r),k(o)}catch{C.error("Failed to load form data")}finally{S(!1)}},L=async r=>{try{await a.mutateAsync(r),C.success("Kit created successfully"),j.reset(),t(!1)}catch{C.error("Failed to create kit")}},g=r=>{if(r.key==="Enter"&&N.trim()){r.preventDefault();const o=j.getValues("tags")??[];o.includes(N.trim())||j.setValue("tags",[...o,N.trim()]),I("")}},U=r=>{const o=j.getValues("tags")??[];j.setValue("tags",o.filter(B=>B!==r))};return e.jsx(J,{open:s,onOpenChange:t,children:e.jsxs(W,{className:"sm:max-w-[725px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Z,{children:[e.jsx(X,{children:"Create Kit"}),e.jsx(ee,{children:"Add a new kit to your system. Fill in the kit details below."})]}),w?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(q,{className:"h-8 w-8 animate-spin"})}):e.jsx(pe,{...j,children:e.jsxs("form",{onSubmit:j.handleSubmit(L),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{control:j.control,name:"name",render:({field:r})=>e.jsxs(x,{children:[e.jsx(m,{children:"Name *"}),e.jsx(u,{children:e.jsx(f,{placeholder:"Enter kit name",...r})}),e.jsx(h,{})]})}),e.jsx(d,{control:j.control,name:"state",render:({field:r})=>e.jsxs(x,{children:[e.jsx(m,{children:"State *"}),e.jsxs(O,{onValueChange:r.onChange,defaultValue:r.value,children:[e.jsx(u,{children:e.jsx(z,{children:e.jsx($,{placeholder:"Select state"})})}),e.jsx(M,{children:Object.values(T).map(o=>e.jsx(A,{value:o,children:o},o))})]}),e.jsx(h,{})]})}),e.jsx(d,{control:j.control,name:"description",render:({field:r})=>e.jsxs(x,{className:"col-span-2",children:[e.jsx(m,{children:"Description"}),e.jsx(u,{children:e.jsx(R,{placeholder:"Enter kit description",className:"resize-none",...r})}),e.jsx(h,{})]})}),e.jsx(d,{control:j.control,name:"notes",render:({field:r})=>e.jsxs(x,{className:"col-span-2",children:[e.jsx(m,{children:"Notes"}),e.jsx(u,{children:e.jsx(R,{placeholder:"Enter notes",className:"resize-none",...r})}),e.jsx(h,{})]})}),e.jsx(d,{control:j.control,name:"tags",render:({field:r})=>e.jsxs(x,{className:"col-span-2",children:[e.jsx(m,{children:"Tags"}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{placeholder:"Type a tag and press Enter",value:N,onChange:o=>I(o.target.value),onKeyDown:g}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(r.value??[]).map(o=>e.jsxs(b,{variant:"secondary",children:[o,e.jsx(D,{type:"button",variant:"ghost",size:"sm",className:"ml-1 h-auto p-0",onClick:()=>U(o),children:e.jsx(de,{className:"h-3 w-3"})})]},o))})]})}),e.jsx(h,{})]})}),e.jsx(d,{control:j.control,name:"company",render:({field:r})=>e.jsxs(x,{children:[e.jsx(m,{children:"Company"}),e.jsx(Ce,{value:r.value,onValueChange:r.onChange,placeholder:"Select company"}),e.jsx(h,{})]})}),e.jsx(d,{control:j.control,name:"property",render:({field:r})=>e.jsxs(x,{children:[e.jsx(m,{children:"Property"}),e.jsxs(O,{onValueChange:o=>r.onChange(o==="none"?null:o),value:r.value||"none",children:[e.jsx(u,{children:e.jsx(z,{children:e.jsx($,{placeholder:"Select property"})})}),e.jsxs(M,{children:[e.jsx(A,{value:"none",children:"None"}),p.map(o=>e.jsxs(A,{value:o._id,children:[o.shortAddress,o.unit&&` Unit ${o.unit}`,o.city&&o.state&&` - ${o.city}, ${o.state}`]},o._id))]})]}),e.jsx(h,{})]})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Shipping Address"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{control:j.control,name:"shippingAddress.name",render:({field:r})=>e.jsxs(x,{children:[e.jsx(m,{children:"Name"}),e.jsx(u,{children:e.jsx(f,{placeholder:"John Doe",...r})}),e.jsx(h,{})]})}),e.jsx(d,{control:j.control,name:"shippingAddress.street",render:({field:r})=>e.jsxs(x,{children:[e.jsx(m,{children:"Street"}),e.jsx(u,{children:e.jsx(f,{placeholder:"123 Main St",...r})}),e.jsx(h,{})]})}),e.jsx(d,{control:j.control,name:"shippingAddress.city",render:({field:r})=>e.jsxs(x,{children:[e.jsx(m,{children:"City"}),e.jsx(u,{children:e.jsx(f,{placeholder:"New York",...r})}),e.jsx(h,{})]})}),e.jsx(d,{control:j.control,name:"shippingAddress.state",render:({field:r})=>e.jsxs(x,{children:[e.jsx(m,{children:"State"}),e.jsx(u,{children:e.jsx(f,{placeholder:"NY",...r})}),e.jsx(h,{})]})}),e.jsx(d,{control:j.control,name:"shippingAddress.zipCode",render:({field:r})=>e.jsxs(x,{children:[e.jsx(m,{children:"Zip Code"}),e.jsx(u,{children:e.jsx(f,{placeholder:"10001",...r})}),e.jsx(h,{})]})}),e.jsx(d,{control:j.control,name:"shippingAddress.country",render:({field:r})=>e.jsxs(x,{children:[e.jsx(m,{children:"Country"}),e.jsx(u,{children:e.jsx(f,{placeholder:"USA",...r})}),e.jsx(h,{})]})})]})]}),e.jsx(d,{control:j.control,name:"hardware",render:({field:r})=>e.jsxs(x,{className:"col-span-2",children:[e.jsx(m,{children:"Hardware"}),e.jsx(u,{children:e.jsx(fe,{options:i.map(o=>({label:`${o.name} (${o.category})`,value:o._id})),onValueChange:r.onChange,value:r.value??[],placeholder:"Select hardware"})}),e.jsx(h,{})]})})]}),e.jsxs(xe,{children:[e.jsx(D,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancel"}),e.jsxs(D,{type:"submit",disabled:a.isPending,children:[a.isPending&&e.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Kit"]})]})]})})]})})}function Ss(){const{isEditDialogOpen:s,setIsEditDialogOpen:t,selectedKit:a}=P(),i=js(),{data:l,isLoading:p}=us(a?._id||""),[k,w]=y.useState([]),[S,N]=y.useState([]),[I,j]=y.useState(!1),[_,L]=y.useState(""),g=he({resolver:ue(ye),defaultValues:{name:"",description:"",notes:"",tags:[],state:T.CHECKING_STOCK,shippingAddress:{name:"",street:"",city:"",state:"",zipCode:"",country:""},company:null,user:null,property:null,hardware:[]}});y.useEffect(()=>{s&&l&&(U(),g.reset({name:l.name||"",description:l.description||"",notes:l.notes||"",tags:l.tags||[],state:l.state,shippingAddress:{name:l.shippingAddress?.name||"",street:l.shippingAddress?.street||"",city:l.shippingAddress?.city||"",state:l.shippingAddress?.state||"",zipCode:l.shippingAddress?.zipCode||"",country:l.shippingAddress?.country||""},company:l.company?._id||null,user:l.user?._id||null,property:l.property?._id||null,hardware:l.hardware?.map(n=>n._id)||[]}))},[s,l,g]);const U=async()=>{j(!0);try{const[n,c]=await Promise.all([je.list(),ge.getProperties()]);w(n),N(c)}catch{C.error("Failed to load form data")}finally{j(!1)}},r=async n=>{if(a)try{await i.mutateAsync({_id:a._id,...n}),C.success("Kit updated successfully"),t(!1)}catch{C.error("Failed to update kit")}},o=n=>{if(n.key==="Enter"&&_.trim()){n.preventDefault();const c=g.getValues("tags")??[];c.includes(_.trim())||g.setValue("tags",[...c,_.trim()]),L("")}},B=n=>{const c=g.getValues("tags")??[];g.setValue("tags",c.filter(we=>we!==n))};return e.jsx(J,{open:s,onOpenChange:t,children:e.jsxs(W,{className:"sm:max-w-[725px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Z,{children:[e.jsx(X,{children:"Edit Kit"}),e.jsx(ee,{children:"Update the kit details below."})]}),I||p?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(q,{className:"h-8 w-8 animate-spin"})}):e.jsx(pe,{...g,children:e.jsxs("form",{onSubmit:g.handleSubmit(r),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{control:g.control,name:"name",render:({field:n})=>e.jsxs(x,{children:[e.jsx(m,{children:"Name *"}),e.jsx(u,{children:e.jsx(f,{placeholder:"Enter kit name",...n})}),e.jsx(h,{})]})}),e.jsx(d,{control:g.control,name:"state",render:({field:n})=>e.jsxs(x,{children:[e.jsx(m,{children:"State *"}),e.jsxs(O,{onValueChange:n.onChange,value:n.value,children:[e.jsx(u,{children:e.jsx(z,{children:e.jsx($,{placeholder:"Select state"})})}),e.jsx(M,{children:Object.values(T).map(c=>e.jsx(A,{value:c,children:c},c))})]}),e.jsx(h,{})]})}),e.jsx(d,{control:g.control,name:"description",render:({field:n})=>e.jsxs(x,{className:"col-span-2",children:[e.jsx(m,{children:"Description"}),e.jsx(u,{children:e.jsx(R,{placeholder:"Enter kit description",className:"resize-none",...n})}),e.jsx(h,{})]})}),e.jsx(d,{control:g.control,name:"notes",render:({field:n})=>e.jsxs(x,{className:"col-span-2",children:[e.jsx(m,{children:"Notes"}),e.jsx(u,{children:e.jsx(R,{placeholder:"Enter notes",className:"resize-none",...n})}),e.jsx(h,{})]})}),e.jsx(d,{control:g.control,name:"tags",render:({field:n})=>e.jsxs(x,{className:"col-span-2",children:[e.jsx(m,{children:"Tags"}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{placeholder:"Type a tag and press Enter",value:_,onChange:c=>L(c.target.value),onKeyDown:o}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(n.value??[]).map(c=>e.jsxs(b,{variant:"secondary",children:[c,e.jsx(D,{type:"button",variant:"ghost",size:"sm",className:"ml-1 h-auto p-0",onClick:()=>B(c),children:e.jsx(de,{className:"h-3 w-3"})})]},c))})]})}),e.jsx(h,{})]})}),e.jsx(d,{control:g.control,name:"company",render:({field:n})=>e.jsxs(x,{children:[e.jsx(m,{children:"Company"}),e.jsx(Ce,{value:n.value,onValueChange:n.onChange,placeholder:"Select company"}),e.jsx(h,{})]})}),e.jsx(d,{control:g.control,name:"property",render:({field:n})=>e.jsxs(x,{children:[e.jsx(m,{children:"Property"}),e.jsxs(O,{onValueChange:c=>n.onChange(c==="none"?null:c),value:n.value||"none",children:[e.jsx(u,{children:e.jsx(z,{children:e.jsx($,{placeholder:"Select property"})})}),e.jsxs(M,{children:[e.jsx(A,{value:"none",children:"None"}),S.map(c=>e.jsxs(A,{value:c._id,children:[c.shortAddress,c.unit&&` Unit ${c.unit}`,c.city&&c.state&&` - ${c.city}, ${c.state}`]},c._id))]})]}),e.jsx(h,{})]})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Shipping Address"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(d,{control:g.control,name:"shippingAddress.name",render:({field:n})=>e.jsxs(x,{children:[e.jsx(m,{children:"Name"}),e.jsx(u,{children:e.jsx(f,{placeholder:"John Doe",...n})}),e.jsx(h,{})]})}),e.jsx(d,{control:g.control,name:"shippingAddress.street",render:({field:n})=>e.jsxs(x,{children:[e.jsx(m,{children:"Street"}),e.jsx(u,{children:e.jsx(f,{placeholder:"123 Main St",...n})}),e.jsx(h,{})]})}),e.jsx(d,{control:g.control,name:"shippingAddress.city",render:({field:n})=>e.jsxs(x,{children:[e.jsx(m,{children:"City"}),e.jsx(u,{children:e.jsx(f,{placeholder:"New York",...n})}),e.jsx(h,{})]})}),e.jsx(d,{control:g.control,name:"shippingAddress.state",render:({field:n})=>e.jsxs(x,{children:[e.jsx(m,{children:"State"}),e.jsx(u,{children:e.jsx(f,{placeholder:"NY",...n})}),e.jsx(h,{})]})}),e.jsx(d,{control:g.control,name:"shippingAddress.zipCode",render:({field:n})=>e.jsxs(x,{children:[e.jsx(m,{children:"Zip Code"}),e.jsx(u,{children:e.jsx(f,{placeholder:"10001",...n})}),e.jsx(h,{})]})}),e.jsx(d,{control:g.control,name:"shippingAddress.country",render:({field:n})=>e.jsxs(x,{children:[e.jsx(m,{children:"Country"}),e.jsx(u,{children:e.jsx(f,{placeholder:"USA",...n})}),e.jsx(h,{})]})})]})]}),e.jsx(d,{control:g.control,name:"hardware",render:({field:n})=>e.jsxs(x,{className:"col-span-2",children:[e.jsx(m,{children:"Hardware"}),e.jsx(u,{children:e.jsx(fe,{options:k.map(c=>({label:`${c.name} (${c.category})`,value:c._id})),onValueChange:n.onChange,value:n.value??[],placeholder:"Select hardware"})}),e.jsx(h,{})]})})]}),e.jsxs(xe,{children:[e.jsx(D,{type:"button",variant:"outline",onClick:()=>t(!1),children:"Cancel"}),e.jsxs(D,{type:"submit",disabled:i.isPending,children:[i.isPending&&e.jsx(q,{className:"mr-2 h-4 w-4 animate-spin"}),"Update Kit"]})]})]})})]})})}function As(){const{isViewDialogOpen:s,setIsViewDialogOpen:t,selectedKit:a}=P();return a?e.jsx(J,{open:s,onOpenChange:t,children:e.jsxs(W,{className:"sm:max-w-[625px]",children:[e.jsxs(Z,{children:[e.jsx(X,{children:"Kit Details"}),e.jsx(ee,{children:"View detailed information about the kit."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Name"}),e.jsx("p",{className:"text-sm",children:a.name})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"State"}),e.jsx(b,{className:Ne(a.state),children:a.state})]})]}),a.description&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Description"}),e.jsx("p",{className:"text-sm",children:a.description})]}),a.notes&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Notes"}),e.jsx("p",{className:"text-sm",children:a.notes})]}),a.tags&&a.tags.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-2",children:"Tags"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:a.tags.map((i,l)=>e.jsx(b,{variant:"secondary",children:i},l))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Company"}),e.jsx("p",{className:"text-sm",children:a.company?.name||"-"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"User"}),a.user?e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{children:a.user.firstName&&a.user.lastName?`${a.user.firstName} ${a.user.lastName}`:a.user.email}),e.jsx("p",{className:"text-muted-foreground",children:a.user.email})]}):e.jsx("p",{className:"text-sm",children:"-"})]})]}),a.property&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Property"}),e.jsxs("p",{className:"text-sm",children:[a.property.shortAddress,a.property.unit&&` Unit ${a.property.unit}`,a.property.city&&a.property.state&&` - ${a.property.city}, ${a.property.state}`]})]}),a.shippingAddress&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Shipping Address"}),e.jsx("p",{className:"text-sm",children:vs(a.shippingAddress)})]}),a.hardware&&a.hardware.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-sm font-medium text-muted-foreground mb-2",children:["Hardware (",a.hardware.length,")"]}),e.jsx("div",{className:"space-y-1",children:a.hardware.map(i=>e.jsxs("div",{className:"text-sm",children:[i.name," ",i.category&&e.jsxs("span",{className:"text-muted-foreground",children:["(",i.category,")"]})]},i._id))})]}),a.assignedDate&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Assigned Date"}),e.jsx("p",{className:"text-sm",children:new Date(a.assignedDate).toLocaleDateString()})]}),a.device_id&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground",children:"Device ID"}),e.jsx("p",{className:"text-sm font-mono",children:a.device_id})]})]})]})}):null}function Ks(){const{isDeleteDialogOpen:s,setIsDeleteDialogOpen:t,selectedKit:a}=P(),i=gs(),l=async()=>{if(a)try{await i.mutateAsync(a._id),t(!1)}catch{C.error("Failed to delete kit")}};return e.jsx(ts,{open:s,onOpenChange:t,children:e.jsxs(as,{children:[e.jsxs(rs,{children:[e.jsx(ns,{children:"Are you absolutely sure?"}),e.jsxs(ls,{children:["This action cannot be undone. This will permanently delete the kit",a?.name&&` "${a.name}"`," and remove it from our servers."]})]}),e.jsxs(is,{children:[e.jsx(os,{children:"Cancel"}),e.jsx(cs,{onClick:l,disabled:i.isPending,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:i.isPending?"Deleting...":"Delete"})]})]})})}function Ts(){const{setIsCreateDialogOpen:s}=P();return e.jsxs(D,{onClick:()=>s(!0),children:[e.jsx(ss,{className:"mr-2 h-4 w-4"}),"Add Kit"]})}function Is(){const s=be({strict:!1}),{data:t=[],isLoading:a,error:i}=hs(s.company?{company:s.company}:void 0);return e.jsxs(ws,{children:[e.jsxs(ke,{fixed:!0,children:[e.jsx(Se,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Ae,{}),e.jsx(Ke,{}),e.jsx(Te,{})]})]}),e.jsxs(Ie,{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Kits"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage and organize your hardware kits."})]}),e.jsx(Ts,{})]}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:i?e.jsxs(ds,{variant:"destructive",children:[e.jsx(xs,{className:"h-4 w-4"}),e.jsxs(ms,{children:["Failed to load kits. ",i instanceof Error?i.message:"Please try again later."]})]}):e.jsxs(e.Fragment,{children:[e.jsx(Ds,{data:t,isLoading:a}),e.jsx(ks,{}),e.jsx(Ss,{}),e.jsx(As,{}),e.jsx(Ks,{})]})})]})]})}const mt=Is;export{mt as component};
