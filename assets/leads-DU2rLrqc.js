import{c as J,r as f,j as e,B as A,t as L,k as X,h as Y,d as H,a as ve}from"./index-CvyRkeE5.js";import{c as b,u as De,b as O,q as D,H as Se,S as we,a as Ce,T as be,P as Te,M as Ee}from"./header-company-dropdown-CQYbnI8v.js";import{u as Ie,D as Le}from"./use-data-table-BURvSaac.js";import{I as y}from"./input-5vX5qBNK.js";import{a as Ae,D as T}from"./data-table-column-header-DAw5f9Xg.js";import{X as Pe,D as G,g as W,h as Z,i as ee,j as se,k as ie}from"./command-DTdQs4HX.js";import{u as oe,a as le,F as de,b as x,c as u,d as h,e as j,f as g}from"./form-BBbFGrnZ.js";import{S as me,a as pe,b as xe,c as ue,d as he}from"./select-yRulkKwZ.js";import{T as je}from"./textarea-DtY41fJS.js";import{o as ke,i as _,e as _e,a as te,s as E,l as Fe}from"./types-Wky072k2.js";import{B as w}from"./badge-Ce5hJyxp.js";import{S as F}from"./separator-D1ovcUFg.js";import{U as $,M as ae,P as Ve,a as Q,B as Re}from"./user-zmNkBf4R.js";import{C as z}from"./calendar-CN8C_RNY.js";import{C as Oe,a as ge}from"./circle-x-kOYWSQv3.js";import{F as Be}from"./file-text-DtrSjpN_.js";import{f as R}from"./format-BvUxDbfm.js";import{A as Me,a as qe,b as Ue,c as Ke,d as He,e as $e,f as Qe,g as ze}from"./alert-dialog-DBJIasGu.js";import{C as ne}from"./checkbox-DQAukn5y.js";import{L as re}from"./long-text-B2UXBo_g.js";import"./avatar-_2VmutPB.js";import"./createReactComponent-DcxUhOxs.js";import"./index-DCzpbC7R.js";import"./index-ChHWVpPk.js";import"./index-bd6ufVwP.js";import"./index-Qfb_IjkA.js";import"./index-Bt6K678h.js";import"./index-Bb0YeX9p.js";import"./index-fHPixuyN.js";import"./index-rpDruwTI.js";import"./check-DOj7a-5i.js";import"./table-CtXYL8Fg.js";import"./react-icons.esm-hx67oMTw.js";import"./index-BYO_HMiJ.js";import"./popover-NdNb9ebW.js";/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],Xe=J("circle-check",Je);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],Ge=J("download",Ye);/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const We=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],Ze=J("tag",We),fe=f.createContext(void 0);function es({children:s}){const[t,a]=f.useState(!1),[n,c]=f.useState(!1),[i,d]=f.useState(null),[v,o]=f.useState(!1),[r,l]=f.useState(null),[p,S]=f.useState(!1),[P,C]=f.useState(null),[M,q]=f.useState([]),U=()=>{a(!1),c(!1),o(!1),S(!1),d(null),l(null),C(null)},K={isCreateDialogOpen:t,setIsCreateDialogOpen:N=>{N?a(N):U()},isEditDialogOpen:n,setIsEditDialogOpen:N=>{N?c(N):(c(!1),d(null))},editingLead:i,setEditingLead:d,isViewDialogOpen:v,setIsViewDialogOpen:N=>{N?o(N):(o(!1),l(null))},viewingLead:r,setViewingLead:l,isDeleteDialogOpen:p,setIsDeleteDialogOpen:N=>{N?S(N):(S(!1),C(null))},deletingLead:P,setDeletingLead:C,selectedLeads:M,setSelectedLeads:q};return e.jsx(fe.Provider,{value:K,children:s})}function ss({columns:s,data:t,isLoading:a,pageCount:n,onPaginationChange:c,searchValue:i,onSearchChange:d,onSearchSubmit:v,onSearchClear:o}){const{table:r}=Ie({data:t,columns:s,pageCount:n,manualPagination:!0,onPaginationChange:c}),l=e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 items-center space-x-2",children:[e.jsx(y,{placeholder:"Filter leads...",value:i??"",onChange:p=>d?.(p.target.value),onKeyDown:p=>{p.key==="Enter"&&v?.()},className:"h-8 w-[150px] lg:w-[250px]"}),i&&e.jsxs(A,{variant:"ghost",onClick:o,className:"h-8 px-2 lg:px-3",children:["Clear",e.jsx(Pe,{className:"ml-2 h-4 w-4"})]})]}),e.jsx(Ae,{table:r})]});return e.jsx(Le,{table:r,columns:s,isLoading:a,toolbar:l,showToolbar:!0,emptyState:e.jsx("tr",{children:e.jsx("td",{colSpan:s.length,className:"h-24 text-center",children:"No leads found."})})})}const V=(s,t=!1)=>{const a=new Date(s);return t?a.setHours(23,59,59,999):a.setHours(0,0,0,0),a.getTime().toString()},I={getContacts:async s=>{const t=new URLSearchParams;return s.page&&t.append("page",s.page.toString()),s.pageLimit&&t.append("pageLimit",s.pageLimit.toString()),s.sort&&t.append("sort",s.sort),s.tabValue&&t.append("tabValue",s.tabValue),s.propertyIds&&t.append("propertyIds",s.propertyIds),s.companiesIds&&t.append("companiesIds",s.companiesIds),s.search&&t.append("search",s.search),s.startTimeStartTimestamp&&t.append("startTimeStartTimestamp",s.startTimeStartTimestamp),s.startTimeEndTimestamp&&t.append("startTimeEndTimestamp",s.startTimeEndTimestamp),s.createdAtStartTimestamp&&t.append("createdAtStartTimestamp",s.createdAtStartTimestamp),s.createdAtEndTimestamp&&t.append("createdAtEndTimestamp",s.createdAtEndTimestamp),b.get(`/api/contact?${t.toString()}`)},getContactsAdmin:async s=>{const t=new URLSearchParams;return s.page&&t.append("page",s.page.toString()),s.pageLimit&&t.append("pageLimit",s.pageLimit.toString()),s.sort&&t.append("sort",s.sort),s.tabValue&&t.append("tabValue",s.tabValue),s.propertyIds&&t.append("propertyIds",s.propertyIds),s.companiesIds&&t.append("companiesIds",s.companiesIds),s.search&&t.append("search",s.search),s.startTimeStartTimestamp&&t.append("startTimeStartTimestamp",s.startTimeStartTimestamp),s.startTimeEndTimestamp&&t.append("startTimeEndTimestamp",s.startTimeEndTimestamp),s.createdAtStartTimestamp&&t.append("createdAtStartTimestamp",s.createdAtStartTimestamp),s.createdAtEndTimestamp&&t.append("createdAtEndTimestamp",s.createdAtEndTimestamp),b.get(`/api/contact/admin/list?${t.toString()}`)},getContact:async s=>b.get(`/api/contact/${s}`),createContact:async s=>{const t=new FormData;return t.append("firstName",s.firstName),t.append("lastName",s.lastName),s.email&&t.append("email",s.email),s.phone&&t.append("phone",s.phone),s.address&&t.append("address",s.address),s.notes&&t.append("notes",s.notes),s.status&&t.append("status",s.status),s.tags?.length&&s.tags.forEach(a=>t.append("tags[]",a)),s.propertyIds?.length&&s.propertyIds.forEach(a=>t.append("properties[]",a)),s.idImage&&t.append("idImage",s.idImage),s.document&&t.append("document",s.document),s.documentBack&&t.append("documentBack",s.documentBack),s.face&&t.append("face",s.face),b.postFormData("/api/contact/create",t)},updateContact:async({_id:s,...t})=>{const a=new FormData;return t.firstName&&a.append("firstName",t.firstName),t.lastName&&a.append("lastName",t.lastName),t.email!==void 0&&a.append("email",t.email||""),t.phone!==void 0&&a.append("phone",t.phone||""),t.address!==void 0&&a.append("address",t.address||""),t.notes!==void 0&&a.append("notes",t.notes||""),t.status!==void 0&&a.append("status",t.status||""),t.tags&&t.tags.forEach(n=>a.append("tags[]",n)),t.propertyIds&&t.propertyIds.forEach(n=>a.append("properties[]",n)),t.idImage&&a.append("idImage",t.idImage),t.document&&a.append("document",t.document),t.documentBack&&a.append("documentBack",t.documentBack),t.face&&a.append("face",t.face),b.patchFormData(`/api/contact/update/${s}`,a)},updateContactStatus:async(s,t)=>b.patch(`/api/contact/${s}/status`,{status:t}),deleteContact:async s=>b.delete(`/api/contact/bookings/${s}`),exportContactsToCsv:async(s,t=!1)=>{const a=new URLSearchParams;s.propertyIds&&a.append("propertyIds",s.propertyIds),s.companiesIds&&a.append("companiesIds",s.companiesIds),s.search&&a.append("search",s.search),s.tabValue&&a.append("tabValue",s.tabValue);const n=t?"/api/contact/admin/toCsv":"/api/contact/toCsv";return await b.get(n+"?"+a.toString(),{responseType:"blob"})},getContactCount:async()=>b.get("/api/contact/all-count")},ts=s=>{const t={...s};s.startTimeStartDate&&(t.startTimeStartTimestamp=V(s.startTimeStartDate)),s.startTimeEndDate&&(t.startTimeEndTimestamp=V(s.startTimeEndDate,!0)),s.createdAtStartDate&&(t.createdAtStartTimestamp=V(s.createdAtStartDate)),s.createdAtEndDate&&(t.createdAtEndTimestamp=V(s.createdAtEndDate,!0));const a={...t};return["startTimeStartDate","startTimeEndDate","createdAtStartDate","createdAtEndDate"].forEach(c=>{c in a&&delete a[c]}),a},ce=s=>{const{page:t,limit:a,filters:n,sort:c}=s,i={page:t,pageLimit:a,sort:c?.order||"desc",tabValue:n?.tabValue||"leads"};return n?.search&&(i.search=n.search),n?.propertyIds?.length&&(i.propertyIds=n.propertyIds.join(",")),n?.companiesIds?.length&&(i.companiesIds=n.companiesIds.join(",")),n?.startTimeRange?.start&&(i.startTimeStartDate=n.startTimeRange.start),n?.startTimeRange?.end&&(i.startTimeEndDate=n.startTimeRange.end),n?.createdAtRange?.start&&(i.createdAtStartDate=n.createdAtRange.start),n?.createdAtRange?.end&&(i.createdAtEndDate=n.createdAtRange.end),ts(i)},k={getLeads:async s=>{const t=ce(s);return s.isAdmin?await I.getContactsAdmin(t):await I.getContacts(t)},getLead:async s=>await I.getContact(s),createLead:async s=>await I.createContact(s),updateLead:async s=>await I.updateContact(s),updateLeadStatus:async({id:s,status:t})=>await I.updateContactStatus(s,t),deleteLead:async s=>I.deleteContact(s),exportLeads:async s=>{const t=ce(s);return I.exportContactsToCsv(t,s.isAdmin)}},as=s=>De({queryKey:D.leads.list(s),queryFn:()=>k.getLeads(s),staleTime:5*60*1e3}),ns=()=>{const s=X();return O({mutationFn:k.createLead,onSuccess:()=>{s.invalidateQueries({queryKey:D.leads.all}),L.success("Lead created successfully")},onError:t=>{L.error(t.message||"Failed to create lead")}})},rs=()=>{const s=X();return O({mutationFn:k.updateLead,onMutate:async t=>{if(!t._id)throw new Error("Lead ID is required for update");await s.cancelQueries({queryKey:D.leads.detail(t._id)}),await s.cancelQueries({queryKey:D.leads.lists()});const a=s.getQueryData(D.leads.detail(t._id)),n=s.getQueriesData({queryKey:D.leads.lists()});return s.setQueryData(D.leads.detail(t._id),c=>c&&{...c,...t}),s.setQueriesData({queryKey:D.leads.lists()},c=>c?.leads?{...c,leads:c.leads.map(i=>i._id===t._id?{...i,...t}:i)}:c),{previousLead:a,previousLists:n,leadId:t._id}},onError:(t,a,n)=>{n?.previousLead&&n.leadId&&s.setQueryData(D.leads.detail(n.leadId),n.previousLead),n?.previousLists&&n.previousLists.forEach(([c,i])=>{s.setQueryData(c,i)}),L.error(t.message||"Failed to update lead")},onSuccess:t=>{L.success("Lead updated successfully")},onSettled:t=>{t&&s.invalidateQueries({queryKey:D.leads.detail(t._id)}),s.invalidateQueries({queryKey:D.leads.lists()})}})},cs=()=>{const s=X();return O({mutationFn:k.deleteLead,onSuccess:(t,a)=>{s.invalidateQueries({queryKey:D.leads.lists()}),s.removeQueries({queryKey:D.leads.detail(a)}),L.success("Lead deleted successfully")},onError:t=>{L.error(t.message||"Failed to delete lead")}})},is=()=>O({mutationFn:k.exportLeads,onSuccess:s=>{const t=window.URL.createObjectURL(s),a=document.createElement("a");a.href=t,a.download=`leads-export-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(t),L.success("Leads exported successfully")},onError:s=>{L.error(s.message||"Failed to export leads")}});function os({filters:s,isAdmin:t}){const a=is(),n=()=>{a.mutate({page:1,limit:1e4,filters:s,isAdmin:t})};return e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(A,{variant:"outline",size:"sm",onClick:n,disabled:a.isPending,children:[e.jsx(Ge,{className:"mr-2 h-4 w-4"}),"Export CSV"]})})}const m={INTERESTED:"interested",NOT_INTERESTED:"not interested",RESCHEDULED:"rescheduled",APPLICATION_SENT:"application sent",APPLIED:"applied",NEVER_ARRIVED:"never arrived",NONE:""},Ne=ke({firstName:E().min(1,"First name is required"),lastName:E().min(1,"Last name is required"),email:E().email("Invalid email").optional().or(Fe("")),phone:E().optional(),address:E().optional(),notes:E().optional(),tags:te(E()).optional(),propertyIds:te(E()).optional(),status:_e([m.INTERESTED,m.NOT_INTERESTED,m.RESCHEDULED,m.APPLICATION_SENT,m.APPLIED,m.NEVER_ARRIVED,m.NONE]).optional(),idImage:_(File).optional(),document:_(File).optional(),documentBack:_(File).optional(),face:_(File).optional()}),ls=Ne.partial().extend({_id:E()}),ye=s=>{switch(s){case m.INTERESTED:return"text-green-600 bg-green-50";case m.NOT_INTERESTED:return"text-red-600 bg-red-50";case m.RESCHEDULED:return"text-yellow-600 bg-yellow-50";case m.APPLICATION_SENT:return"text-blue-600 bg-blue-50";case m.APPLIED:return"text-purple-600 bg-purple-50";case m.NEVER_ARRIVED:return"text-gray-600 bg-gray-50";default:return"text-gray-400 bg-gray-50"}},B=s=>{switch(s){case m.INTERESTED:return"Interested";case m.NOT_INTERESTED:return"Not Interested";case m.RESCHEDULED:return"Rescheduled";case m.APPLICATION_SENT:return"Application Sent";case m.APPLIED:return"Applied";case m.NEVER_ARRIVED:return"Never Arrived";default:return"No Status"}};function ds({open:s,onClose:t}){const a=ns(),[n,c]=f.useState({}),i=oe({resolver:le(Ne),defaultValues:{firstName:"",lastName:"",email:"",phone:"",address:"",notes:"",tags:[],propertyIds:[],status:m.NONE}}),d=async o=>{try{await a.mutateAsync(o),i.reset(),c({}),t()}catch{}},v=o=>r=>{const l=r.target.files?.[0];if(l){i.setValue(o,l);const p=new FileReader;p.onloadend=()=>{c(S=>({...S,[o]:p.result}))},p.readAsDataURL(l)}};return e.jsx(G,{open:s,onOpenChange:t,children:e.jsxs(W,{className:"sm:max-w-[625px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Create New Lead"}),e.jsx(se,{children:"Add a new lead to your system. Fill in the contact details below."})]}),e.jsx(de,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(d),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(x,{control:i.control,name:"firstName",render:({field:o})=>e.jsxs(u,{children:[e.jsx(h,{children:"First Name *"}),e.jsx(j,{children:e.jsx(y,{placeholder:"John",...o})}),e.jsx(g,{})]})}),e.jsx(x,{control:i.control,name:"lastName",render:({field:o})=>e.jsxs(u,{children:[e.jsx(h,{children:"Last Name *"}),e.jsx(j,{children:e.jsx(y,{placeholder:"Doe",...o})}),e.jsx(g,{})]})}),e.jsx(x,{control:i.control,name:"email",render:({field:o})=>e.jsxs(u,{children:[e.jsx(h,{children:"Email"}),e.jsx(j,{children:e.jsx(y,{type:"email",placeholder:"john@example.com",...o})}),e.jsx(g,{})]})}),e.jsx(x,{control:i.control,name:"phone",render:({field:o})=>e.jsxs(u,{children:[e.jsx(h,{children:"Phone"}),e.jsx(j,{children:e.jsx(y,{placeholder:"+1 (555) 000-0000",...o})}),e.jsx(g,{})]})}),e.jsx(x,{control:i.control,name:"status",render:({field:o})=>e.jsxs(u,{className:"col-span-2",children:[e.jsx(h,{children:"Status"}),e.jsxs(me,{onValueChange:o.onChange,defaultValue:o.value,children:[e.jsx(j,{children:e.jsx(pe,{children:e.jsx(xe,{placeholder:"Select a status"})})}),e.jsx(ue,{children:Object.values(m).map(r=>e.jsx(he,{value:r,children:B(r)},r))})]}),e.jsx(g,{})]})}),e.jsx(x,{control:i.control,name:"address",render:({field:o})=>e.jsxs(u,{className:"col-span-2",children:[e.jsx(h,{children:"Address"}),e.jsx(j,{children:e.jsx(y,{placeholder:"123 Main St, City, State 12345",...o})}),e.jsx(g,{})]})}),e.jsx(x,{control:i.control,name:"notes",render:({field:o})=>e.jsxs(u,{className:"col-span-2",children:[e.jsx(h,{children:"Notes"}),e.jsx(j,{children:e.jsx(je,{placeholder:"Add any additional notes about this lead...",...o,rows:3})}),e.jsx(g,{})]})}),e.jsxs("div",{className:"col-span-2 space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Documents (Optional)"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(x,{control:i.control,name:"idImage",render:({field:{value:o,onChange:r,...l}})=>e.jsxs(u,{children:[e.jsx(h,{children:"ID Image"}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{type:"file",accept:"image/*",onChange:v("idImage"),...l}),n.idImage&&e.jsx("img",{src:n.idImage,alt:"ID preview",className:"h-20 w-20 object-cover rounded"})]})}),e.jsx(g,{})]})}),e.jsx(x,{control:i.control,name:"face",render:({field:{value:o,onChange:r,...l}})=>e.jsxs(u,{children:[e.jsx(h,{children:"Face Photo"}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{type:"file",accept:"image/*",onChange:v("face"),...l}),n.face&&e.jsx("img",{src:n.face,alt:"Face preview",className:"h-20 w-20 object-cover rounded"})]})}),e.jsx(g,{})]})}),e.jsx(x,{control:i.control,name:"document",render:({field:{value:o,onChange:r,...l}})=>e.jsxs(u,{children:[e.jsx(h,{children:"Document"}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{type:"file",accept:"image/*,.pdf",onChange:v("document"),...l}),n.document&&e.jsx("img",{src:n.document,alt:"Document preview",className:"h-20 w-20 object-cover rounded"})]})}),e.jsx(g,{})]})}),e.jsx(x,{control:i.control,name:"documentBack",render:({field:{value:o,onChange:r,...l}})=>e.jsxs(u,{children:[e.jsx(h,{children:"Document Back"}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{type:"file",accept:"image/*,.pdf",onChange:v("documentBack"),...l}),n.documentBack&&e.jsx("img",{src:n.documentBack,alt:"Document back preview",className:"h-20 w-20 object-cover rounded"})]})}),e.jsx(g,{})]})})]})]})]}),e.jsxs(ie,{children:[e.jsx(A,{type:"button",variant:"outline",onClick:t,disabled:a.isPending,children:"Cancel"}),e.jsxs(A,{type:"submit",disabled:a.isPending,children:[a.isPending&&e.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Lead"]})]})]})})]})})}function ms({open:s,onClose:t,lead:a}){const n=rs(),[c,i]=f.useState({}),d=oe({resolver:le(ls),defaultValues:{_id:a._id,firstName:a.contact.firstName,lastName:a.contact.lastName,email:a.contact.email||"",phone:a.contact.phone||"",address:a.contact.address||"",notes:a.contact.notes||"",tags:a.contact.tags||[],status:a.contact.status||m.NONE}});f.useEffect(()=>{d.reset({_id:a._id,firstName:a.contact.firstName,lastName:a.contact.lastName,email:a.contact.email||"",phone:a.contact.phone||"",address:a.contact.address||"",notes:a.contact.notes||"",tags:a.contact.tags||[],status:a.contact.status||m.NONE}),i({idImage:a.contact.idImage,document:a.contact.document,documentBack:a.contact.documentBack,face:a.contact.face})},[a,d]);const v=async r=>{try{await n.mutateAsync({...r,_id:a.contact._id}),t()}catch{}},o=r=>l=>{const p=l.target.files?.[0];if(p){d.setValue(r,p);const S=new FileReader;S.onloadend=()=>{i(P=>({...P,[r]:S.result}))},S.readAsDataURL(p)}};return e.jsx(G,{open:s,onOpenChange:t,children:e.jsxs(W,{className:"sm:max-w-[625px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Edit Lead"}),e.jsx(se,{children:"Update the lead information below."})]}),e.jsx(de,{...d,children:e.jsxs("form",{onSubmit:d.handleSubmit(v),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(x,{control:d.control,name:"firstName",render:({field:r})=>e.jsxs(u,{children:[e.jsx(h,{children:"First Name *"}),e.jsx(j,{children:e.jsx(y,{placeholder:"John",...r})}),e.jsx(g,{})]})}),e.jsx(x,{control:d.control,name:"lastName",render:({field:r})=>e.jsxs(u,{children:[e.jsx(h,{children:"Last Name *"}),e.jsx(j,{children:e.jsx(y,{placeholder:"Doe",...r})}),e.jsx(g,{})]})}),e.jsx(x,{control:d.control,name:"email",render:({field:r})=>e.jsxs(u,{children:[e.jsx(h,{children:"Email"}),e.jsx(j,{children:e.jsx(y,{type:"email",placeholder:"john@example.com",...r})}),e.jsx(g,{})]})}),e.jsx(x,{control:d.control,name:"phone",render:({field:r})=>e.jsxs(u,{children:[e.jsx(h,{children:"Phone"}),e.jsx(j,{children:e.jsx(y,{placeholder:"+1 (555) 000-0000",...r})}),e.jsx(g,{})]})}),e.jsx(x,{control:d.control,name:"status",render:({field:r})=>e.jsxs(u,{className:"col-span-2",children:[e.jsx(h,{children:"Status"}),e.jsxs(me,{onValueChange:r.onChange,value:r.value,children:[e.jsx(j,{children:e.jsx(pe,{children:e.jsx(xe,{placeholder:"Select a status"})})}),e.jsx(ue,{children:Object.values(m).map(l=>e.jsx(he,{value:l,children:B(l)},l))})]}),e.jsx(g,{})]})}),e.jsx(x,{control:d.control,name:"address",render:({field:r})=>e.jsxs(u,{className:"col-span-2",children:[e.jsx(h,{children:"Address"}),e.jsx(j,{children:e.jsx(y,{placeholder:"123 Main St, City, State 12345",...r})}),e.jsx(g,{})]})}),e.jsx(x,{control:d.control,name:"notes",render:({field:r})=>e.jsxs(u,{className:"col-span-2",children:[e.jsx(h,{children:"Notes"}),e.jsx(j,{children:e.jsx(je,{placeholder:"Add any additional notes about this lead...",...r,rows:3})}),e.jsx(g,{})]})}),e.jsxs("div",{className:"col-span-2 space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium",children:"Documents"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(x,{control:d.control,name:"idImage",render:({field:{value:r,onChange:l,...p}})=>e.jsxs(u,{children:[e.jsx(h,{children:"ID Image"}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{type:"file",accept:"image/*",onChange:o("idImage"),...p}),c.idImage&&e.jsx("img",{src:c.idImage,alt:"ID preview",className:"h-20 w-20 object-cover rounded"})]})}),e.jsx(g,{})]})}),e.jsx(x,{control:d.control,name:"face",render:({field:{value:r,onChange:l,...p}})=>e.jsxs(u,{children:[e.jsx(h,{children:"Face Photo"}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{type:"file",accept:"image/*",onChange:o("face"),...p}),c.face&&e.jsx("img",{src:c.face,alt:"Face preview",className:"h-20 w-20 object-cover rounded"})]})}),e.jsx(g,{})]})}),e.jsx(x,{control:d.control,name:"document",render:({field:{value:r,onChange:l,...p}})=>e.jsxs(u,{children:[e.jsx(h,{children:"Document"}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{type:"file",accept:"image/*,.pdf",onChange:o("document"),...p}),c.document&&e.jsx("img",{src:c.document,alt:"Document preview",className:"h-20 w-20 object-cover rounded"})]})}),e.jsx(g,{})]})}),e.jsx(x,{control:d.control,name:"documentBack",render:({field:{value:r,onChange:l,...p}})=>e.jsxs(u,{children:[e.jsx(h,{children:"Document Back"}),e.jsx(j,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{type:"file",accept:"image/*,.pdf",onChange:o("documentBack"),...p}),c.documentBack&&e.jsx("img",{src:c.documentBack,alt:"Document back preview",className:"h-20 w-20 object-cover rounded"})]})}),e.jsx(g,{})]})})]})]})]}),e.jsxs(ie,{children:[e.jsx(A,{type:"button",variant:"outline",onClick:t,disabled:n.isPending,children:"Cancel"}),e.jsxs(A,{type:"submit",disabled:n.isPending,children:[n.isPending&&e.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}),"Update Lead"]})]})]})})]})})}function ps({open:s,onClose:t,lead:a}){return e.jsx(G,{open:s,onOpenChange:t,children:e.jsxs(W,{className:"sm:max-w-[625px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Z,{children:[e.jsx(ee,{children:"Lead Details"}),e.jsx(se,{children:"Complete information about this lead"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Contact Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx($,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Name:"}),e.jsxs("span",{children:[a.contact.firstName," ",a.contact.lastName]})]}),a.contact.email&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(ae,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Email:"}),e.jsx("a",{href:`mailto:${a.contact.email}`,className:"text-blue-600 hover:underline",children:a.contact.email})]}),a.contact.phone&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(Ve,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Phone:"}),e.jsx("a",{href:`tel:${a.contact.phone}`,className:"text-blue-600 hover:underline",children:a.contact.phone})]})]}),e.jsxs("div",{className:"space-y-2",children:[a.contact.address&&e.jsxs("div",{className:"flex items-start space-x-2 text-sm",children:[e.jsx(Q,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Address:"}),e.jsx("p",{className:"text-muted-foreground",children:a.contact.address})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(z,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Created:"}),e.jsx("span",{children:R(new Date(a.createdAt),"MMM dd, yyyy")})]})]})]})]}),e.jsx(F,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Status Information"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Lead Status:"}),e.jsx(w,{variant:"secondary",className:ye(a.contact.status),children:B(a.contact.status)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Booking Complete:"}),a.incomplete?e.jsxs("div",{className:"flex items-center space-x-1 text-muted-foreground",children:[e.jsx(ge,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"No"})]}):e.jsxs("div",{className:"flex items-center space-x-1 text-green-600",children:[e.jsx(Oe,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Yes"})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Verified:"}),a.isVerified?e.jsx(w,{variant:"secondary",className:"bg-green-50 text-green-700",children:"Verified"}):e.jsx(w,{variant:"secondary",className:"bg-gray-50 text-gray-700",children:"Unverified"})]})]})]}),e.jsx(F,{}),a.property&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Property Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-start space-x-2 text-sm",children:[e.jsx(Q,{className:"h-4 w-4 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.property.shortAddress||a.property.address}),a.property.unit&&e.jsxs("p",{className:"text-muted-foreground",children:["Unit ",a.property.unit]}),e.jsxs("p",{className:"text-muted-foreground",children:[a.property.city,", ",a.property.state]})]})]}),a.startTime&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(z,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Showing Date:"}),e.jsx("span",{children:R(new Date(a.startTime),"MMM dd, yyyy HH:mm")})]})]})]}),e.jsx(F,{})]}),a.user&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Agent Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx($,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Name:"}),e.jsxs("span",{children:[a.user.firstName," ",a.user.lastName]})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(ae,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Email:"}),e.jsx("a",{href:`mailto:${a.user.email}`,className:"text-blue-600 hover:underline",children:a.user.email})]}),a.user.company&&e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(Re,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:"Company:"}),e.jsx("span",{children:a.user.company.name})]})]})]}),e.jsx(F,{})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"Additional Information"}),e.jsxs("div",{className:"space-y-3",children:[a.contact.notes&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm font-medium",children:[e.jsx(Be,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:"Notes:"})]}),e.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:a.contact.notes})]}),a.contact.tags&&a.contact.tags.length>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm font-medium",children:[e.jsx(Ze,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:"Tags:"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 pl-6",children:a.contact.tags.map((n,c)=>e.jsx(w,{variant:"outline",children:n},c))})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"text-sm font-medium",children:"Documents:"}),e.jsxs("div",{className:"flex flex-wrap gap-2 pl-6",children:[a.contact.idImage&&e.jsx(w,{variant:"secondary",children:"ID Image"}),a.contact.document&&e.jsx(w,{variant:"secondary",children:"Document"}),a.contact.documentBack&&e.jsx(w,{variant:"secondary",children:"Document Back"}),a.contact.face&&e.jsx(w,{variant:"secondary",children:"Face Photo"}),!a.contact.idImage&&!a.contact.document&&!a.contact.documentBack&&!a.contact.face&&e.jsx("span",{className:"text-sm text-muted-foreground",children:"No documents uploaded"})]})]})]})]})]})]})})}function xs({open:s,onClose:t,lead:a}){const n=cs(),c=async()=>{try{await n.mutateAsync(a._id),t()}catch{}};return e.jsx(Me,{open:s,onOpenChange:t,children:e.jsxs(qe,{children:[e.jsxs(Ue,{children:[e.jsx(Ke,{children:"Are you sure?"}),e.jsxs(He,{children:["This action cannot be undone. This will permanently delete the lead",e.jsxs("span",{className:"font-semibold",children:[" ",a.contact.firstName," ",a.contact.lastName]})," ","and all associated bookings from the system."]})]}),e.jsxs($e,{children:[e.jsx(Qe,{disabled:n.isPending,children:"Cancel"}),e.jsxs(ze,{onClick:c,disabled:n.isPending,className:"bg-red-600 hover:bg-red-700",children:[n.isPending&&e.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}),"Delete Lead"]})]})]})})}function us(){const s=f.useContext(fe);if(!s)throw new Error("useLeadsContext must be used within a LeadsProvider");return s}function hs(){const{isCreateDialogOpen:s,setIsCreateDialogOpen:t,isEditDialogOpen:a,setIsEditDialogOpen:n,editingLead:c,isViewDialogOpen:i,setIsViewDialogOpen:d,viewingLead:v,isDeleteDialogOpen:o,setIsDeleteDialogOpen:r,deletingLead:l}=us();return e.jsxs(e.Fragment,{children:[e.jsx(ds,{open:s,onClose:()=>t(!1)}),c&&e.jsx(ms,{open:a,onClose:()=>n(!1),lead:c}),v&&e.jsx(ps,{open:i,onClose:()=>d(!1),lead:v}),l&&e.jsx(xs,{open:o,onClose:()=>r(!1),lead:l})]})}const js=[{id:"select",header:({table:s})=>e.jsx(ne,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:t=>s.toggleAllPageRowsSelected(!!t),"aria-label":"Select all",className:"translate-y-[2px]"}),meta:{className:H("sticky md:table-cell left-0 z-10 rounded-tl","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted")},cell:({row:s})=>e.jsx(ne,{checked:s.getIsSelected(),onCheckedChange:t=>s.toggleSelected(!!t),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"contact.firstName",id:"name",header:({column:s})=>e.jsx(T,{column:s,title:"Name"}),cell:({row:s})=>{const t=s.original.contact.firstName,a=s.original.contact.lastName,n=`${t} ${a}`.trim();return e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx(re,{className:"max-w-48 font-medium",children:n}),s.original.contact.email&&e.jsx("span",{className:"text-xs text-muted-foreground",children:s.original.contact.email})]})})},meta:{className:H("drop-shadow-[0_1px_2px_rgb(0_0_0_/_0.1)] dark:drop-shadow-[0_1px_2px_rgb(255_255_255_/_0.1)] lg:drop-shadow-none","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted","sticky left-6 md:table-cell")},enableHiding:!1},{accessorKey:"contact.phone",header:({column:s})=>e.jsx(T,{column:s,title:"Phone"}),cell:({row:s})=>{const t=s.original.contact.phone;return t?e.jsx("a",{href:`tel:${t}`,className:"text-blue-600 hover:underline",children:t}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}},{accessorKey:"property",header:({column:s})=>e.jsx(T,{column:s,title:"Property"}),cell:({row:s})=>{const t=s.original.property;return t?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Q,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx(re,{className:"max-w-48 text-sm",children:t.shortAddress||t.address}),t.unit&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Unit ",t.unit]})]})]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}},{accessorKey:"contact.status",header:({column:s})=>e.jsx(T,{column:s,title:"Status"}),cell:({row:s})=>{const t=s.original.contact.status;return e.jsx(w,{variant:"secondary",className:H("text-xs",ye(t)),children:B(t)})},filterFn:(s,t,a)=>a.includes(s.getValue(t))},{accessorKey:"startTime",header:({column:s})=>e.jsx(T,{column:s,title:"Showing Date"}),cell:({row:s})=>{const t=s.getValue("startTime");return t?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm",children:R(new Date(t),"MMM dd, yyyy HH:mm")})]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}},{accessorKey:"user",header:({column:s})=>e.jsx(T,{column:s,title:"Agent"}),cell:({row:s})=>{const t=s.original.user;return t?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-sm",children:`${t.firstName} ${t.lastName}`}),t.company&&e.jsx("span",{className:"text-xs text-muted-foreground",children:t.company.name})]})]}):e.jsx("span",{className:"text-muted-foreground",children:"-"})}},{accessorKey:"incomplete",header:({column:s})=>e.jsx(T,{column:s,title:"Complete"}),cell:({row:s})=>{const t=s.getValue("incomplete");return e.jsx("div",{className:"flex items-center",children:t?e.jsx(ge,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(Xe,{className:"h-5 w-5 text-green-600"})})}},{accessorKey:"isVerified",header:({column:s})=>e.jsx(T,{column:s,title:"Verified"}),cell:({row:s})=>{const t=s.getValue("isVerified");return e.jsx("div",{className:"flex items-center",children:t?e.jsx(w,{variant:"secondary",className:"bg-green-50 text-green-700",children:"Verified"}):e.jsx(w,{variant:"secondary",className:"bg-gray-50 text-gray-700",children:"Unverified"})})}},{accessorKey:"createdAt",header:({column:s})=>e.jsx(T,{column:s,title:"Created"}),cell:({row:s})=>{const t=s.getValue("createdAt");return e.jsx("span",{className:"text-sm text-muted-foreground",children:R(new Date(t),"MMM dd, yyyy")})}}];function gs(){const t=ve({strict:!1}),[a,n]=f.useState(1),[c,i]=f.useState(10),[d,v]=f.useState(""),[o,r]=f.useState({tabValue:"leads",search:"",companiesIds:t.company?[t.company]:void 0}),[l,p]=f.useState({field:"createdAt",order:"desc"}),[S,P]=f.useState(1),{data:C,isLoading:M}=as({page:a,limit:c,filters:o,sort:l,isAdmin:!0});f.useEffect(()=>{C?.pages&&P(C.pages)},[C?.pages]),f.useEffect(()=>{r(N=>({...N,companiesIds:t.company?[t.company]:void 0})),n(1)},[t.company]);const q=N=>{n(N.pageIndex+1),i(N.pageSize)},U=()=>{r(N=>({...N,search:d})),n(1)},K=()=>{v(""),r(N=>({...N,search:""})),n(1)};return e.jsxs(es,{children:[e.jsxs(Se,{fixed:!0,children:[e.jsx(we,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Ce,{}),e.jsx(be,{}),e.jsx(Te,{})]})]}),e.jsxs(Ee,{children:[e.jsxs("div",{className:"mb-2 flex flex-wrap items-center justify-between space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Leads"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage your leads and track their status"})]}),e.jsx(os,{filters:o,isAdmin:!0})]}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-y-0 lg:space-x-12",children:e.jsx(ss,{columns:js,data:C?.data||[],isLoading:M,pageCount:C?.pages||S,pagination:{pageIndex:a-1,pageSize:c},onPaginationChange:q,searchValue:d,onSearchChange:v,onSearchSubmit:U,onSearchClear:K})})]}),e.jsx(hs,{})]})}const Zs=function(){return e.jsx(gs,{})};export{Zs as component};
