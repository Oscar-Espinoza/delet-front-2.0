import{c as Ie,r as g,j as e,B as C,d as L,t as k,h as V,a as Pe}from"./index-Dv1JWxNr.js";import{H as Le,S as ke,a as Fe,T as _e,P as Ue,M as Ae}from"./header-company-dropdown--Awgxzay.js";import{u as Ee,D as Me}from"./use-data-table-BNvWa4ET.js";import{I as w}from"./input-B_unVzQI.js";import{D as ie,e as ce,f as oe,g as Ve,h as de,z as Re,i as ee}from"./avatar-BAwvz_Zl.js";import{B as O}from"./badge-KVwFvJ3A.js";import{C as Te,a as Be,b as He,c as ze,d as se,e as re,f as Ge,X as $e,D as q,g as K,h as Z,i as J,j as Q,k as ue}from"./command-DcTOLZl5.js";import{P as Xe,a as Ye,b as qe}from"./popover-UlTbB9Ed.js";import{S as Ke}from"./separator-C7xfAAuo.js";import{C as Ze,u as Je,a as W,s as me,M as H,b as Qe,c as xe}from"./multi-select-hyra1fT4.js";import{C as We}from"./check-BqR35Gvj.js";import{o as te,a as ae,s as S,n as es}from"./types-Wky072k2.js";import{C as ne}from"./checkbox-9cVOoBuM.js";import{D as P}from"./data-table-column-header-BQ28lyg8.js";import{L as ss}from"./long-text-29-VbLTc.js";import{E as rs,P as ts}from"./pencil-BThf48U0.js";import{E as as}from"./eye-kPwYJfHv.js";import{u as he,a as pe,F as je,b as m,c as x,d as h,e as p,f as j}from"./form-CZQoOBB7.js";import{S as F,a as _,b as U,c as A,d as v}from"./select-C_Vy9nNB.js";import{g as ge}from"./users-api-DbPW515O.js";import{h as fe}from"./hardware-api-BkQYR9DK.js";import{P as ns}from"./plus-DFeVdjI_.js";import{A as ls,I as is,a as cs}from"./alert-QKjxu_J9.js";import"./createReactComponent-DEfHJg2M.js";import"./table-CR31dl_A.js";import"./react-icons.esm-BLmnETz0.js";import"./index-CHnWnazZ.js";import"./index-jslwB8KE.js";import"./index-DF1ouENV.js";import"./index-GwslycKq.js";import"./index-D-kAnGCt.js";import"./index-BmzB4KP7.js";import"./index-CEbF_H-L.js";import"./index-mCotDcwq.js";import"./chevrons-up-down-9TPJUjFl.js";import"./index-Bx3FAcJY.js";/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],ds=Ie("settings-2",os),ye=g.createContext(void 0);function us({children:s}){const[r,o]=g.useState(null),[c,u]=g.useState(!1),[a,N]=g.useState(!1),[b,E]=g.useState(!1);return e.jsx(ye.Provider,{value:{selectedStructure:r,setSelectedStructure:o,isCreateDialogOpen:c,setIsCreateDialogOpen:u,isEditDialogOpen:a,setIsEditDialogOpen:N,isViewDialogOpen:b,setIsViewDialogOpen:E},children:s})}function R(){const s=g.useContext(ye);if(!s)throw new Error("useStructuresContext must be used within StructuresProvider");return s}function ms({table:s}){return e.jsxs(ie,{children:[e.jsx(ce,{asChild:!0,children:e.jsxs(C,{variant:"outline",size:"sm",className:"ml-auto hidden h-8 lg:flex",children:[e.jsx(ds,{className:"mr-2 h-4 w-4"}),"View"]})}),e.jsxs(oe,{align:"end",className:"w-[150px]",children:[e.jsx(Ve,{children:"Toggle columns"}),e.jsx(de,{}),s.getAllColumns().filter(r=>typeof r.accessorFn<"u"&&r.getCanHide()).map(r=>e.jsx(Re,{className:"capitalize",checked:r.getIsVisible(),onCheckedChange:o=>r.toggleVisibility(!!o),children:r.id},r.id))]})]})}function xs({column:s,title:r,options:o}){const c=s?.getFacetedUniqueValues(),u=new Set(s?.getFilterValue());return e.jsxs(Xe,{children:[e.jsx(Ye,{asChild:!0,children:e.jsxs(C,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(Ze,{className:"mr-2 h-4 w-4"}),r,u?.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ke,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(O,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:u.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:u.size>2?e.jsxs(O,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[u.size," selected"]}):o.filter(a=>u.has(a.value)).map(a=>e.jsx(O,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:a.label},a.value))})]})]})}),e.jsx(qe,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Te,{children:[e.jsx(Be,{placeholder:r}),e.jsxs(He,{children:[e.jsx(ze,{children:"No results found."}),e.jsx(se,{children:o.map(a=>{const N=u.has(a.value);return e.jsxs(re,{onSelect:()=>{N?u.delete(a.value):u.add(a.value);const b=Array.from(u);s?.setFilterValue(b.length?b:void 0)},children:[e.jsx("div",{className:L("mr-2 flex h-4 w-4 items-center justify-center rounded-sm border border-primary",N?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(We,{className:L("h-4 w-4")})}),a.icon&&e.jsx(a.icon,{className:"mr-2 h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:a.label}),c?.get(a.value)&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:c.get(a.value)})]},a.value)})}),u.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(Ge,{}),e.jsx(se,{children:e.jsx(re,{onSelect:()=>s?.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}var n=(s=>(s.BUILDING="BUILDING",s.FLOOR="FLOOR",s.ROOM="ROOM",s.COMPLEX="COMPLEX",s.AREA="AREA",s))(n||{});const ve=te({name:S().optional(),type:es(n),address:te({street:S().optional(),city:S().optional(),state:S().optional(),zipCode:S().optional()}).optional(),user:S().min(1,"User is required"),parentStructure:S().optional().nullable(),properties:ae(S()).optional(),hardware:ae(S()).optional()}),we=s=>{if(!s)return"-";const r=[s.street,s.city,s.state,s.zipCode].filter(Boolean);return r.length>0?r.join(", "):"-"},Ne=s=>({BUILDING:"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300",FLOOR:"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300",ROOM:"bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300",COMPLEX:"bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300",AREA:"bg-pink-100 text-pink-700 dark:bg-pink-900 dark:text-pink-300"})[s]||"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300";function hs({table:s}){const r=s.getState().columnFilters.length>0;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 items-center space-x-2",children:[e.jsx(w,{placeholder:"Filter structures...",value:s.getColumn("name")?.getFilterValue()??"",onChange:o=>s.getColumn("name")?.setFilterValue(o.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),s.getColumn("type")&&e.jsx(xs,{column:s.getColumn("type"),title:"Type",options:[{label:"Building",value:n.BUILDING},{label:"Floor",value:n.FLOOR},{label:"Room",value:n.ROOM},{label:"Complex",value:n.COMPLEX},{label:"Area",value:n.AREA}]}),r&&e.jsxs(C,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["Reset",e.jsx($e,{className:"ml-2 h-4 w-4"})]})]}),e.jsx(ms,{table:s})]})}function ps({row:s}){const r=s.original,{setSelectedStructure:o,setIsViewDialogOpen:c,setIsEditDialogOpen:u}=R(),a=()=>{o(r),c(!0)},N=()=>{o(r),u(!0)};return e.jsxs(ie,{children:[e.jsx(ce,{asChild:!0,children:e.jsxs(C,{variant:"ghost",className:"flex h-8 w-8 p-0 data-[state=open]:bg-muted",children:[e.jsx(rs,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Open menu"})]})}),e.jsxs(oe,{align:"end",className:"w-[160px]",children:[e.jsxs(ee,{onClick:a,children:[e.jsx(as,{className:"mr-2 h-4 w-4"}),"View"]}),e.jsx(de,{}),e.jsxs(ee,{onClick:N,children:[e.jsx(ts,{className:"mr-2 h-4 w-4"}),"Edit"]})]})]})}const le=[{id:"select",header:({table:s})=>e.jsx(ne,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:r=>s.toggleAllPageRowsSelected(!!r),"aria-label":"Select all",className:"translate-y-[2px]"}),meta:{className:L("sticky md:table-cell left-0 z-10 rounded-tl","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted")},cell:({row:s})=>e.jsx(ne,{checked:s.getIsSelected(),onCheckedChange:r=>s.toggleSelected(!!r),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:({column:s})=>e.jsx(P,{column:s,title:"Name"}),cell:({row:s})=>{const r=s.getValue("name");return e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(ss,{className:"max-w-48 font-medium",children:r||e.jsx("span",{className:"text-muted-foreground",children:"Unnamed"})})})},meta:{className:L("drop-shadow-[0_1px_2px_rgb(0_0_0_/_0.1)] dark:drop-shadow-[0_1px_2px_rgb(255_255_255_/_0.1)] lg:drop-shadow-none","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted","sticky left-6 md:table-cell")},enableHiding:!1},{accessorKey:"type",header:({column:s})=>e.jsx(P,{column:s,title:"Type"}),cell:({row:s})=>{const r=s.getValue("type");return e.jsx(O,{className:L("font-medium",Ne(r)),children:r})},filterFn:(s,r,o)=>o.includes(s.getValue(r))},{id:"address",header:({column:s})=>e.jsx(P,{column:s,title:"Address"}),cell:({row:s})=>{const r=s.original.address;return e.jsx("div",{className:"text-nowrap",children:we(r)})},enableSorting:!1},{id:"user",header:({column:s})=>e.jsx(P,{column:s,title:"User / Company"}),cell:({row:s})=>{const r=s.original.user;return e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm",children:r?.email||"-"}),r?.company&&e.jsx("div",{className:"text-xs text-muted-foreground",children:r.company.name})]})},enableSorting:!1},{id:"parentStructure",header:({column:s})=>e.jsx(P,{column:s,title:"Parent Structure"}),cell:({row:s})=>{const r=s.original.parentStructure;return e.jsx("div",{className:"text-nowrap",children:r?.name||e.jsx("span",{className:"text-muted-foreground",children:"-"})})},enableSorting:!1},{id:"properties",header:({column:s})=>e.jsx(P,{column:s,title:"Properties"}),cell:({row:s})=>{const r=s.original.properties?.length||0;return e.jsx("div",{className:"text-center",children:e.jsx(O,{variant:"secondary",children:r})})},enableSorting:!1},{id:"hardware",header:({column:s})=>e.jsx(P,{column:s,title:"Hardware"}),cell:({row:s})=>{const r=s.original.hardware?.length||0;return e.jsx("div",{className:"text-center",children:e.jsx(O,{variant:"secondary",children:r})})},enableSorting:!1},{id:"actions",cell:({row:s})=>e.jsx(ps,{row:s}),meta:{className:L("sticky md:table-cell right-0 z-10","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted")}}];function js({data:s,isLoading:r}){const{table:o}=Ee({data:s,columns:le});return e.jsx(Me,{table:o,columns:le,isLoading:r,toolbar:e.jsx(hs,{table:o}),showToolbar:!0})}function gs(){const{isCreateDialogOpen:s,setIsCreateDialogOpen:r}=R(),o=Je(),{data:c=[]}=W(),[u,a]=g.useState([]),[N,b]=g.useState([]),[E,z]=g.useState([]),[G,T]=g.useState(!1),y=he({resolver:pe(ve),defaultValues:{name:"",type:n.BUILDING,address:{street:"",city:"",state:"",zipCode:""},user:"",parentStructure:null,properties:[],hardware:[]}});g.useEffect(()=>{s&&$()},[s]);const $=async()=>{T(!0);try{const[l,d,f]=await Promise.all([ge(),fe.list(),me.getProperties()]);a(l),b(d),z(f)}catch{k.error("Failed to load form data")}finally{T(!1)}},B=async l=>{try{await o.mutateAsync(l),k.success("Structure created successfully"),y.reset(),r(!1)}catch{k.error("Failed to create structure")}},D=y.watch("type"),X=()=>D===n.BUILDING||D===n.COMPLEX?c.filter(l=>l.type===n.COMPLEX):D===n.FLOOR?c.filter(l=>l.type===n.BUILDING):D===n.ROOM?c.filter(l=>l.type===n.FLOOR||l.type===n.BUILDING):D===n.AREA?c.filter(l=>l.type===n.COMPLEX||l.type===n.BUILDING||l.type===n.FLOOR):[];return e.jsx(q,{open:s,onOpenChange:r,children:e.jsxs(K,{className:"sm:max-w-[725px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Z,{children:[e.jsx(J,{children:"Create Structure"}),e.jsx(Q,{children:"Add a new structure to your system. Fill in the structure details below."})]}),G?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(V,{className:"h-8 w-8 animate-spin"})}):e.jsx(je,{...y,children:e.jsxs("form",{onSubmit:y.handleSubmit(B),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(m,{control:y.control,name:"name",render:({field:l})=>e.jsxs(x,{children:[e.jsx(h,{children:"Name"}),e.jsx(p,{children:e.jsx(w,{placeholder:"Enter structure name",...l})}),e.jsx(j,{})]})}),e.jsx(m,{control:y.control,name:"type",render:({field:l})=>e.jsxs(x,{children:[e.jsx(h,{children:"Type *"}),e.jsxs(F,{onValueChange:l.onChange,defaultValue:l.value,children:[e.jsx(p,{children:e.jsx(_,{children:e.jsx(U,{placeholder:"Select type"})})}),e.jsxs(A,{children:[e.jsx(v,{value:n.BUILDING,children:"Building"}),e.jsx(v,{value:n.FLOOR,children:"Floor"}),e.jsx(v,{value:n.ROOM,children:"Room"}),e.jsx(v,{value:n.COMPLEX,children:"Complex"}),e.jsx(v,{value:n.AREA,children:"Area"})]})]}),e.jsx(j,{})]})}),e.jsx(m,{control:y.control,name:"user",render:({field:l})=>e.jsxs(x,{children:[e.jsx(h,{children:"User *"}),e.jsxs(F,{onValueChange:l.onChange,value:l.value,children:[e.jsx(p,{children:e.jsx(_,{children:e.jsx(U,{placeholder:"Select user"})})}),e.jsx(A,{children:u.map(d=>e.jsxs(v,{value:d._id,children:[d.email," ",d.company&&typeof d.company=="object"&&`(${d.company.name})`]},d._id))})]}),e.jsx(j,{})]})}),e.jsx(m,{control:y.control,name:"parentStructure",render:({field:l})=>e.jsxs(x,{children:[e.jsx(h,{children:"Parent Structure"}),e.jsxs(F,{onValueChange:d=>l.onChange(d==="none"?null:d),value:l.value||"none",children:[e.jsx(p,{children:e.jsx(_,{children:e.jsx(U,{placeholder:"Select parent structure"})})}),e.jsxs(A,{children:[e.jsx(v,{value:"none",children:"None"}),X().map(d=>e.jsxs(v,{value:d._id,children:[d.name||"Unnamed"," (",d.type,")"]},d._id))]})]}),e.jsx(j,{})]})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Address"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(m,{control:y.control,name:"address.street",render:({field:l})=>e.jsxs(x,{children:[e.jsx(h,{children:"Street"}),e.jsx(p,{children:e.jsx(w,{placeholder:"123 Main St",...l})}),e.jsx(j,{})]})}),e.jsx(m,{control:y.control,name:"address.city",render:({field:l})=>e.jsxs(x,{children:[e.jsx(h,{children:"City"}),e.jsx(p,{children:e.jsx(w,{placeholder:"New York",...l})}),e.jsx(j,{})]})}),e.jsx(m,{control:y.control,name:"address.state",render:({field:l})=>e.jsxs(x,{children:[e.jsx(h,{children:"State"}),e.jsx(p,{children:e.jsx(w,{placeholder:"NY",...l})}),e.jsx(j,{})]})}),e.jsx(m,{control:y.control,name:"address.zipCode",render:({field:l})=>e.jsxs(x,{children:[e.jsx(h,{children:"Zip Code"}),e.jsx(p,{children:e.jsx(w,{placeholder:"10001",...l})}),e.jsx(j,{})]})})]})]}),e.jsx(m,{control:y.control,name:"properties",render:({field:l})=>e.jsxs(x,{className:"col-span-2",children:[e.jsx(h,{children:"Properties"}),e.jsx(p,{children:e.jsx(H,{options:E.map(d=>({label:`${d.shortAddress||"Unknown"}${d.unit?` Unit ${d.unit}`:""} - ${d.city||"Unknown"}, ${d.state||"Unknown"}`,value:d._id})),onValueChange:l.onChange,value:l.value??[],placeholder:"Select properties"})}),e.jsx(j,{})]})}),e.jsx(m,{control:y.control,name:"hardware",render:({field:l})=>e.jsxs(x,{className:"col-span-2",children:[e.jsx(h,{children:"Hardware"}),e.jsx(p,{children:e.jsx(H,{options:N.map(d=>({label:d.name??"Unnamed Hardware",value:d._id})),onValueChange:l.onChange,value:l.value??[],placeholder:"Select hardware"})}),e.jsx(j,{})]})})]}),e.jsxs(ue,{children:[e.jsx(C,{type:"button",variant:"outline",onClick:()=>r(!1),children:"Cancel"}),e.jsxs(C,{type:"submit",disabled:o.isPending,children:[o.isPending&&e.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Structure"]})]})]})})]})})}function fs(){const{isEditDialogOpen:s,setIsEditDialogOpen:r,selectedStructure:o}=R(),c=Qe(),{data:u=[]}=W(),{data:a,isLoading:N}=xe(o?._id||""),[b,E]=g.useState([]),[z,G]=g.useState([]),[T,y]=g.useState([]),[$,B]=g.useState(!1),[D,X]=g.useState([]),[l,d]=g.useState([]),f=he({resolver:pe(ve),defaultValues:{name:"",type:n.BUILDING,address:{street:"",city:"",state:"",zipCode:""},user:"",parentStructure:null,properties:[],hardware:[]}});g.useEffect(()=>{if(s&&a){Se();const i=a.properties?.map(I=>I._id)||[],t=a.hardware?.map(I=>I._id)||[];X(i),d(t),f.reset({name:a.name||"",type:a.type,address:{street:a.address?.street||"",city:a.address?.city||"",state:a.address?.state||"",zipCode:a.address?.zipCode||""},user:a.user._id,parentStructure:a.parentStructure?._id||null,properties:i,hardware:t})}},[s,a,f]);const Se=async()=>{B(!0);try{const[i,t,I]=await Promise.all([ge(),fe.list(),me.getProperties()]);E(i),G(t),y(I)}catch{k.error("Failed to load form data")}finally{B(!1)}},Ce=async i=>{if(o)try{const t=i.properties||[],I=i.hardware||[],Oe=D.filter(Y=>!t.includes(Y)),De=l.filter(Y=>!I.includes(Y));await c.mutateAsync({_id:o._id,...i,removedProperties:Oe,removedHardware:De}),k.success("Structure updated successfully"),r(!1)}catch{k.error("Failed to update structure")}},M=f.watch("type"),be=()=>{const i=u.filter(t=>t._id!==o?._id);return M===n.BUILDING||M===n.COMPLEX?i.filter(t=>t.type===n.COMPLEX):M===n.FLOOR?i.filter(t=>t.type===n.BUILDING):M===n.ROOM?i.filter(t=>t.type===n.FLOOR||t.type===n.BUILDING):M===n.AREA?i.filter(t=>t.type===n.COMPLEX||t.type===n.BUILDING||t.type===n.FLOOR):[]};return e.jsx(q,{open:s,onOpenChange:r,children:e.jsxs(K,{className:"sm:max-w-[725px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Z,{children:[e.jsx(J,{children:"Edit Structure"}),e.jsx(Q,{children:"Update the structure details below."})]}),$||N?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(V,{className:"h-8 w-8 animate-spin"})}):e.jsx(je,{...f,children:e.jsxs("form",{onSubmit:f.handleSubmit(Ce),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(m,{control:f.control,name:"name",render:({field:i})=>e.jsxs(x,{children:[e.jsx(h,{children:"Name"}),e.jsx(p,{children:e.jsx(w,{placeholder:"Enter structure name",...i})}),e.jsx(j,{})]})}),e.jsx(m,{control:f.control,name:"type",render:({field:i})=>e.jsxs(x,{children:[e.jsx(h,{children:"Type *"}),e.jsxs(F,{onValueChange:i.onChange,value:i.value,children:[e.jsx(p,{children:e.jsx(_,{children:e.jsx(U,{placeholder:"Select type"})})}),e.jsxs(A,{children:[e.jsx(v,{value:n.BUILDING,children:"Building"}),e.jsx(v,{value:n.FLOOR,children:"Floor"}),e.jsx(v,{value:n.ROOM,children:"Room"}),e.jsx(v,{value:n.COMPLEX,children:"Complex"}),e.jsx(v,{value:n.AREA,children:"Area"})]})]}),e.jsx(j,{})]})}),e.jsx(m,{control:f.control,name:"user",render:({field:i})=>e.jsxs(x,{children:[e.jsx(h,{children:"User *"}),e.jsxs(F,{onValueChange:i.onChange,value:i.value,children:[e.jsx(p,{children:e.jsx(_,{children:e.jsx(U,{placeholder:"Select user"})})}),e.jsx(A,{children:b.map(t=>e.jsxs(v,{value:t._id,children:[t.email," ",t.company&&typeof t.company=="object"&&`(${t.company.name})`]},t._id))})]}),e.jsx(j,{})]})}),e.jsx(m,{control:f.control,name:"parentStructure",render:({field:i})=>e.jsxs(x,{children:[e.jsx(h,{children:"Parent Structure"}),e.jsxs(F,{onValueChange:t=>i.onChange(t==="none"?null:t),value:i.value||"none",children:[e.jsx(p,{children:e.jsx(_,{children:e.jsx(U,{placeholder:"Select parent structure"})})}),e.jsxs(A,{children:[e.jsx(v,{value:"none",children:"None"}),be().map(t=>e.jsxs(v,{value:t._id,children:[t.name||"Unnamed"," (",t.type,")"]},t._id))]})]}),e.jsx(j,{})]})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Address"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(m,{control:f.control,name:"address.street",render:({field:i})=>e.jsxs(x,{children:[e.jsx(h,{children:"Street"}),e.jsx(p,{children:e.jsx(w,{placeholder:"123 Main St",...i})}),e.jsx(j,{})]})}),e.jsx(m,{control:f.control,name:"address.city",render:({field:i})=>e.jsxs(x,{children:[e.jsx(h,{children:"City"}),e.jsx(p,{children:e.jsx(w,{placeholder:"New York",...i})}),e.jsx(j,{})]})}),e.jsx(m,{control:f.control,name:"address.state",render:({field:i})=>e.jsxs(x,{children:[e.jsx(h,{children:"State"}),e.jsx(p,{children:e.jsx(w,{placeholder:"NY",...i})}),e.jsx(j,{})]})}),e.jsx(m,{control:f.control,name:"address.zipCode",render:({field:i})=>e.jsxs(x,{children:[e.jsx(h,{children:"Zip Code"}),e.jsx(p,{children:e.jsx(w,{placeholder:"10001",...i})}),e.jsx(j,{})]})})]})]}),e.jsx(m,{control:f.control,name:"properties",render:({field:i})=>e.jsxs(x,{className:"col-span-2",children:[e.jsx(h,{children:"Properties"}),e.jsx(p,{children:e.jsx(H,{options:T.map(t=>({label:`${t.shortAddress||"Unknown"}${t.unit?` Unit ${t.unit}`:""} - ${t.city||"Unknown"}, ${t.state||"Unknown"}`,value:t._id})),onValueChange:i.onChange,value:i.value??[],placeholder:"Select properties"})}),e.jsx(j,{})]})}),e.jsx(m,{control:f.control,name:"hardware",render:({field:i})=>e.jsxs(x,{className:"col-span-2",children:[e.jsx(h,{children:"Hardware"}),e.jsx(p,{children:e.jsx(H,{options:z.map(t=>({label:t.name??"Unnamed Hardware",value:t._id})),onValueChange:i.onChange,value:i.value??[],placeholder:"Select hardware"})}),e.jsx(j,{})]})})]}),e.jsxs(ue,{children:[e.jsx(C,{type:"button",variant:"outline",onClick:()=>r(!1),children:"Cancel"}),e.jsxs(C,{type:"submit",disabled:c.isPending,children:[c.isPending&&e.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Update Structure"]})]})]})})]})})}function ys(){const{isViewDialogOpen:s,setIsViewDialogOpen:r,selectedStructure:o}=R(),{data:c,isLoading:u}=xe(o?._id||"");return o?e.jsx(q,{open:s,onOpenChange:r,children:e.jsxs(K,{className:"sm:max-w-[625px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(Z,{children:[e.jsx(J,{children:"Structure Details"}),e.jsx(Q,{children:"View detailed information about the structure"})]}),u?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(V,{className:"h-8 w-8 animate-spin"})}):c?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"Name"}),e.jsx("p",{className:"mt-1 text-sm",children:c.name||"Unnamed"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"Type"}),e.jsx(O,{className:L("mt-1",Ne(c.type)),children:c.type})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"User"}),e.jsx("p",{className:"mt-1 text-sm",children:c.user.email}),c.user.company&&e.jsx("p",{className:"text-xs text-muted-foreground",children:c.user.company.name})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"Parent Structure"}),e.jsx("p",{className:"mt-1 text-sm",children:c.parentStructure?.name||e.jsx("span",{className:"text-muted-foreground",children:"None"})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"Address"}),e.jsx("p",{className:"mt-1 text-sm",children:we(c.address)})]}),c.properties&&c.properties.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-muted-foreground mb-2",children:["Properties (",c.properties.length,")"]}),e.jsx("div",{className:"space-y-2",children:c.properties.map(a=>e.jsx("div",{className:"text-sm p-2 bg-muted rounded-md",children:a.address||`${a.shortAddress}${a.unit?` Unit ${a.unit}`:""}`},a._id))})]}),c.hardware&&c.hardware.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium text-muted-foreground mb-2",children:["Hardware (",c.hardware.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.hardware.map(a=>e.jsx(O,{variant:"secondary",children:a.name},a._id))})]})]}):e.jsx("p",{children:"No structure data available"})]})}):null}function vs(){return e.jsxs(e.Fragment,{children:[e.jsx(gs,{}),e.jsx(fs,{}),e.jsx(ys,{})]})}function ws(){const{setIsCreateDialogOpen:s}=R();return e.jsxs(C,{onClick:()=>s(!0),children:[e.jsx(ns,{className:"mr-2 h-4 w-4"}),"Add Structure"]})}function Ns(){const s=Pe({strict:!1}),{data:r=[],isLoading:o,error:c}=W(),u=s.company?r.filter(a=>a.user?.company?._id===s.company):r;return e.jsxs(us,{children:[e.jsxs(Le,{fixed:!0,children:[e.jsx(ke,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Fe,{}),e.jsx(_e,{}),e.jsx(Ue,{})]})]}),e.jsxs(Ae,{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Structures"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage buildings, floors, rooms, complexes, and areas"})]}),e.jsx(ws,{})]}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-x-12 lg:space-y-0",children:c?e.jsxs(ls,{variant:"destructive",children:[e.jsx(is,{className:"h-4 w-4"}),e.jsx(cs,{children:"Failed to load structures. Please try again later."})]}):e.jsx(js,{data:u,isLoading:o})})]}),e.jsx(vs,{})]})}const nr=Ns;export{nr as component};
