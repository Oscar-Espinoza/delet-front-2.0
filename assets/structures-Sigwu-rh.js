import{c as De,r as f,j as e,t as A,e as V,B as S,d as I,a as ke}from"./index-LjicKyT0.js";import{A as Pe,I as Ie,a as Le}from"./alert-Df5zkjER.js";import{H as Fe,S as Ae,a as Ee,T as _e,P as Ve,M as Me}from"./theme-switch-cMSK6cqB.js";import{u as Re,a as Z,s as ie,M as U,b as Ue,c as ce,C as Te}from"./multi-select-PwKyrFR3.js";import{u as de,a as ue,F as me,b as m,c as x,d as h,e as p,f as j}from"./form-Bf5yBnbc.js";import{D as q,a as J,b as Q,c as W,d as ee,e as xe,C as Be,f as ze,g as Ge,h as He,i as se,j as re,k as Xe,X as $e}from"./command-X9JjFxyP.js";import{I as N}from"./input-Dlu4Ie9G.js";import{S as T,a as B,b as z,c as G,d as y}from"./select-w6OWzPxW.js";import{C as he}from"./company-select-YLwP_2QB.js";import{h as pe}from"./hardware-api-BZ6QlUk5.js";import{o as te,a as ae,s as w,n as Ye}from"./types-Wky072k2.js";import{B as D}from"./badge-4kjocfwo.js";import{P as Ke}from"./plus-D8USiGGy.js";import{u as Ze,D as qe}from"./use-data-table-Bb2GNchX.js";import{P as Je,a as Qe,b as We}from"./popover-Bpz0jySH.js";import{S as es}from"./separator-CLg1W5b9.js";import{C as ss}from"./check-D7e09AXV.js";import{D as je,e as ge,f as fe,g as rs,h as ye,z as ts,i as ne}from"./avatar-ZyuV-nlZ.js";import{C as le}from"./checkbox-w55iTThu.js";import{D as P}from"./data-table-column-header-NxjSLUJQ.js";import{L as as}from"./long-text-BEJQdRNd.js";import{E as ns,P as ls}from"./pencil-CMl5EI2J.js";import{E as os}from"./eye-D5U1iGxZ.js";import"./createReactComponent-Dm51iCRd.js";import"./chevrons-up-down-DsmrhQjg.js";import"./index-BWm_iZMh.js";import"./index-CVPNRdpP.js";import"./index-BK3YptDx.js";import"./index-BqMrZ-WO.js";import"./index-DgBTolnX.js";import"./index-DbJ88n5W.js";import"./index-CJhIcW8r.js";import"./index-BvwaI8vX.js";import"./table-zh_l_sMN.js";import"./react-icons.esm-_L3V94na.js";import"./index-DVkuEz9K.js";/**
 * @license lucide-react v0.523.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=[["path",{d:"M14 17H5",key:"gfn3mx"}],["path",{d:"M19 7h-9",key:"6i9tg"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],cs=De("settings-2",is),ve=f.createContext(void 0);function ds({children:s}){const[r,d]=f.useState(null),[c,u]=f.useState(!1),[a,v]=f.useState(!1),[b,E]=f.useState(!1);return e.jsx(ve.Provider,{value:{selectedStructure:r,setSelectedStructure:d,isCreateDialogOpen:c,setIsCreateDialogOpen:u,isEditDialogOpen:a,setIsEditDialogOpen:v,isViewDialogOpen:b,setIsViewDialogOpen:E},children:s})}function M(){const s=f.useContext(ve);if(!s)throw new Error("useStructuresContext must be used within StructuresProvider");return s}var o=(s=>(s.BUILDING="BUILDING",s.FLOOR="FLOOR",s.ROOM="ROOM",s.COMPLEX="COMPLEX",s.AREA="AREA",s))(o||{});const Ne=te({name:w().optional(),type:Ye(o),address:te({street:w().optional(),city:w().optional(),state:w().optional(),zipCode:w().optional()}).optional(),company:w().optional().nullable(),parentStructure:w().optional().nullable(),properties:ae(w()).optional(),hardware:ae(w()).optional()}),Ce=s=>{if(!s)return"-";const r=[s.street,s.city,s.state,s.zipCode].filter(Boolean);return r.length>0?r.join(", "):"-"},we=s=>({BUILDING:"bg-blue-100 text-blue-700 dark:bg-blue-900 dark:text-blue-300",FLOOR:"bg-green-100 text-green-700 dark:bg-green-900 dark:text-green-300",ROOM:"bg-purple-100 text-purple-700 dark:bg-purple-900 dark:text-purple-300",COMPLEX:"bg-orange-100 text-orange-700 dark:bg-orange-900 dark:text-orange-300",AREA:"bg-pink-100 text-pink-700 dark:bg-pink-900 dark:text-pink-300"})[s]||"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-300";function us(){const{isCreateDialogOpen:s,setIsCreateDialogOpen:r}=M(),d=Re(),{data:c=[]}=Z(),[u,a]=f.useState([]),[v,b]=f.useState([]),[E,L]=f.useState(!1),g=de({resolver:ue(Ne),defaultValues:{name:"",type:o.BUILDING,address:{street:"",city:"",state:"",zipCode:""},company:null,parentStructure:null,properties:[],hardware:[]}});f.useEffect(()=>{s&&R()},[s]);const F=g.watch("properties");f.useEffect(()=>{if(F&&F.length>0){const n=F[0],t=v.find(O=>O._id===n);t&&g.setValue("address",{street:t.shortAddress||"",city:t.city||"",state:t.state||"",zipCode:t.zipCode||""})}},[F,v,g]);const R=async()=>{L(!0);try{const[n,t]=await Promise.all([pe.list(),ie.getProperties()]),O=n.filter($=>$.category==="lockbox");a(O),b(t)}catch{A.error("Failed to load form data")}finally{L(!1)}},H=async n=>{try{await d.mutateAsync(n),A.success("Structure created successfully"),g.reset(),r(!1)}catch{A.error("Failed to create structure")}},k=g.watch("type"),X=()=>k===o.BUILDING||k===o.COMPLEX?c.filter(n=>n.type===o.COMPLEX):k===o.FLOOR?c.filter(n=>n.type===o.BUILDING):k===o.ROOM?c.filter(n=>n.type===o.FLOOR||n.type===o.BUILDING):k===o.AREA?c.filter(n=>n.type===o.COMPLEX||n.type===o.BUILDING||n.type===o.FLOOR):[];return e.jsx(q,{open:s,onOpenChange:r,children:e.jsxs(J,{className:"max-h-[90vh] overflow-y-auto sm:max-w-[725px]",children:[e.jsxs(Q,{children:[e.jsx(W,{children:"Create Structure"}),e.jsx(ee,{children:"Add a new structure to your system. Fill in the structure details below."})]}),E?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(V,{className:"h-8 w-8 animate-spin"})}):e.jsx(me,{...g,children:e.jsxs("form",{onSubmit:g.handleSubmit(H),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(m,{control:g.control,name:"name",render:({field:n})=>e.jsxs(x,{children:[e.jsx(h,{children:"Name"}),e.jsx(p,{children:e.jsx(N,{placeholder:"Enter structure name",...n})}),e.jsx(j,{})]})}),e.jsx(m,{control:g.control,name:"type",render:({field:n})=>e.jsxs(x,{children:[e.jsx(h,{children:"Type *"}),e.jsxs(T,{onValueChange:n.onChange,defaultValue:n.value,children:[e.jsx(p,{children:e.jsx(B,{children:e.jsx(z,{placeholder:"Select type"})})}),e.jsxs(G,{children:[e.jsx(y,{value:o.BUILDING,children:"Building"}),e.jsx(y,{value:o.FLOOR,children:"Floor"}),e.jsx(y,{value:o.ROOM,children:"Room"}),e.jsx(y,{value:o.COMPLEX,children:"Complex"}),e.jsx(y,{value:o.AREA,children:"Area"})]})]}),e.jsx(j,{})]})}),e.jsx(m,{control:g.control,name:"company",render:({field:n})=>e.jsxs(x,{children:[e.jsx(h,{children:"Company"}),e.jsx(p,{children:e.jsx(he,{value:n.value,onValueChange:n.onChange,placeholder:"Select company"})}),e.jsx(j,{})]})}),e.jsx(m,{control:g.control,name:"parentStructure",render:({field:n})=>e.jsxs(x,{children:[e.jsx(h,{children:"Parent Structure"}),e.jsxs(T,{onValueChange:t=>n.onChange(t==="none"?null:t),value:n.value||"none",children:[e.jsx(p,{children:e.jsx(B,{children:e.jsx(z,{placeholder:"Select parent structure"})})}),e.jsxs(G,{children:[e.jsx(y,{value:"none",children:"None"}),X().map(t=>e.jsxs(y,{value:t._id,children:[t.name||"Unnamed"," (",t.type,")"]},t._id))]})]}),e.jsx(j,{})]})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Address"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(m,{control:g.control,name:"address.street",render:({field:n})=>e.jsxs(x,{children:[e.jsx(h,{children:"Street"}),e.jsx(p,{children:e.jsx(N,{placeholder:"123 Main St",...n})}),e.jsx(j,{})]})}),e.jsx(m,{control:g.control,name:"address.city",render:({field:n})=>e.jsxs(x,{children:[e.jsx(h,{children:"City"}),e.jsx(p,{children:e.jsx(N,{placeholder:"New York",...n})}),e.jsx(j,{})]})}),e.jsx(m,{control:g.control,name:"address.state",render:({field:n})=>e.jsxs(x,{children:[e.jsx(h,{children:"State"}),e.jsx(p,{children:e.jsx(N,{placeholder:"NY",...n})}),e.jsx(j,{})]})}),e.jsx(m,{control:g.control,name:"address.zipCode",render:({field:n})=>e.jsxs(x,{children:[e.jsx(h,{children:"Zip Code"}),e.jsx(p,{children:e.jsx(N,{placeholder:"10001",...n})}),e.jsx(j,{})]})})]})]}),e.jsx(m,{control:g.control,name:"properties",render:({field:n})=>e.jsxs(x,{className:"col-span-2",children:[e.jsx(h,{children:"Properties"}),e.jsx(p,{children:e.jsx(U,{options:v.map(t=>({label:`${t.shortAddress||"Unknown"}${t.unit?` Unit ${t.unit}`:""} - ${t.city||"Unknown"}, ${t.state||"Unknown"}`,value:t._id})),onValueChange:n.onChange,value:n.value??[],placeholder:"Select properties"})}),e.jsx(j,{})]})}),e.jsx(m,{control:g.control,name:"hardware",render:({field:n})=>e.jsxs(x,{className:"col-span-2",children:[e.jsx(h,{children:"Lockboxes"}),e.jsx(p,{children:e.jsx(U,{options:u.map(t=>({label:t.name??"Unnamed Lockbox",value:t._id})),onValueChange:n.onChange,value:n.value??[],placeholder:"Select lockboxes"})}),e.jsx(j,{})]})})]}),e.jsxs(xe,{children:[e.jsx(S,{type:"button",variant:"outline",onClick:()=>r(!1),children:"Cancel"}),e.jsxs(S,{type:"submit",disabled:d.isPending,children:[d.isPending&&e.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Structure"]})]})]})})]})})}function ms(){const{isEditDialogOpen:s,setIsEditDialogOpen:r,selectedStructure:d}=M(),c=Ue(),{data:u=[]}=Z(),{data:a,isLoading:v}=ce(d?._id||""),[b,E]=f.useState([]),[L,g]=f.useState([]),[F,R]=f.useState(!1),[H,k]=f.useState([]),[X,n]=f.useState([]),t=de({resolver:ue(Ne),defaultValues:{name:"",type:o.BUILDING,address:{street:"",city:"",state:"",zipCode:""},company:null,parentStructure:null,properties:[],hardware:[]}});f.useEffect(()=>{if(s&&a){$();const i=a.properties?.map(C=>C._id)||[],l=a.hardware?.map(C=>C._id)||[];k(i),n(l),t.reset({name:a.name||"",type:a.type,address:{street:a.address?.street||"",city:a.address?.city||"",state:a.address?.state||"",zipCode:a.address?.zipCode||""},company:a.company?._id||null,parentStructure:a.parentStructure?._id||null,properties:i,hardware:l})}},[s,a,t]);const O=t.watch("properties");f.useEffect(()=>{if(O&&O.length>0){const i=O[0],l=L.find(C=>C._id===i);l&&t.setValue("address",{street:l.shortAddress||"",city:l.city||"",state:l.state||"",zipCode:l.zipCode||""})}},[O,L,t]);const $=async()=>{R(!0);try{const[i,l]=await Promise.all([pe.list(),ie.getProperties()]),C=i.filter(Y=>Y.category==="lockbox");E(C),g(l)}catch{A.error("Failed to load form data")}finally{R(!1)}},Se=async i=>{if(d)try{const l=i.properties||[],C=i.hardware||[],Y=H.filter(K=>!l.includes(K)),Oe=X.filter(K=>!C.includes(K));await c.mutateAsync({_id:d._id,...i,removedProperties:Y,removedHardware:Oe}),A.success("Structure updated successfully"),r(!1)}catch{A.error("Failed to update structure")}},_=t.watch("type"),be=()=>{const i=u.filter(l=>l._id!==d?._id);return _===o.BUILDING||_===o.COMPLEX?i.filter(l=>l.type===o.COMPLEX):_===o.FLOOR?i.filter(l=>l.type===o.BUILDING):_===o.ROOM?i.filter(l=>l.type===o.FLOOR||l.type===o.BUILDING):_===o.AREA?i.filter(l=>l.type===o.COMPLEX||l.type===o.BUILDING||l.type===o.FLOOR):[]};return e.jsx(q,{open:s,onOpenChange:r,children:e.jsxs(J,{className:"max-h-[90vh] overflow-y-auto sm:max-w-[725px]",children:[e.jsxs(Q,{children:[e.jsx(W,{children:"Edit Structure"}),e.jsx(ee,{children:"Update the structure details below."})]}),F||v?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(V,{className:"h-8 w-8 animate-spin"})}):e.jsx(me,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(Se),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(m,{control:t.control,name:"name",render:({field:i})=>e.jsxs(x,{children:[e.jsx(h,{children:"Name"}),e.jsx(p,{children:e.jsx(N,{placeholder:"Enter structure name",...i})}),e.jsx(j,{})]})}),e.jsx(m,{control:t.control,name:"type",render:({field:i})=>e.jsxs(x,{children:[e.jsx(h,{children:"Type *"}),e.jsxs(T,{onValueChange:i.onChange,value:i.value,children:[e.jsx(p,{children:e.jsx(B,{children:e.jsx(z,{placeholder:"Select type"})})}),e.jsxs(G,{children:[e.jsx(y,{value:o.BUILDING,children:"Building"}),e.jsx(y,{value:o.FLOOR,children:"Floor"}),e.jsx(y,{value:o.ROOM,children:"Room"}),e.jsx(y,{value:o.COMPLEX,children:"Complex"}),e.jsx(y,{value:o.AREA,children:"Area"})]})]}),e.jsx(j,{})]})}),e.jsx(m,{control:t.control,name:"company",render:({field:i})=>e.jsxs(x,{children:[e.jsx(h,{children:"Company"}),e.jsx(p,{children:e.jsx(he,{value:i.value,onValueChange:i.onChange,placeholder:"Select company"})}),e.jsx(j,{})]})}),e.jsx(m,{control:t.control,name:"parentStructure",render:({field:i})=>e.jsxs(x,{children:[e.jsx(h,{children:"Parent Structure"}),e.jsxs(T,{onValueChange:l=>i.onChange(l==="none"?null:l),value:i.value||"none",children:[e.jsx(p,{children:e.jsx(B,{children:e.jsx(z,{placeholder:"Select parent structure"})})}),e.jsxs(G,{children:[e.jsx(y,{value:"none",children:"None"}),be().map(l=>e.jsxs(y,{value:l._id,children:[l.name||"Unnamed"," (",l.type,")"]},l._id))]})]}),e.jsx(j,{})]})}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("h3",{className:"mb-2 text-sm font-medium",children:"Address"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(m,{control:t.control,name:"address.street",render:({field:i})=>e.jsxs(x,{children:[e.jsx(h,{children:"Street"}),e.jsx(p,{children:e.jsx(N,{placeholder:"123 Main St",...i})}),e.jsx(j,{})]})}),e.jsx(m,{control:t.control,name:"address.city",render:({field:i})=>e.jsxs(x,{children:[e.jsx(h,{children:"City"}),e.jsx(p,{children:e.jsx(N,{placeholder:"New York",...i})}),e.jsx(j,{})]})}),e.jsx(m,{control:t.control,name:"address.state",render:({field:i})=>e.jsxs(x,{children:[e.jsx(h,{children:"State"}),e.jsx(p,{children:e.jsx(N,{placeholder:"NY",...i})}),e.jsx(j,{})]})}),e.jsx(m,{control:t.control,name:"address.zipCode",render:({field:i})=>e.jsxs(x,{children:[e.jsx(h,{children:"Zip Code"}),e.jsx(p,{children:e.jsx(N,{placeholder:"10001",...i})}),e.jsx(j,{})]})})]})]}),e.jsx(m,{control:t.control,name:"properties",render:({field:i})=>e.jsxs(x,{className:"col-span-2",children:[e.jsx(h,{children:"Properties"}),e.jsx(p,{children:e.jsx(U,{options:L.map(l=>({label:`${l.shortAddress||"Unknown"}${l.unit?` Unit ${l.unit}`:""} - ${l.city||"Unknown"}, ${l.state||"Unknown"}`,value:l._id})),onValueChange:i.onChange,value:i.value??[],placeholder:"Select properties"})}),e.jsx(j,{})]})}),e.jsx(m,{control:t.control,name:"hardware",render:({field:i})=>e.jsxs(x,{className:"col-span-2",children:[e.jsx(h,{children:"Lockboxes"}),e.jsx(p,{children:e.jsx(U,{options:b.map(l=>({label:l.name??"Unnamed Lockbox",value:l._id})),onValueChange:i.onChange,value:i.value??[],placeholder:"Select lockboxes"})}),e.jsx(j,{})]})})]}),e.jsxs(xe,{children:[e.jsx(S,{type:"button",variant:"outline",onClick:()=>r(!1),children:"Cancel"}),e.jsxs(S,{type:"submit",disabled:c.isPending,children:[c.isPending&&e.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Update Structure"]})]})]})})]})})}function xs(){const{isViewDialogOpen:s,setIsViewDialogOpen:r,selectedStructure:d}=M(),{data:c,isLoading:u}=ce(d?._id||"");return d?e.jsx(q,{open:s,onOpenChange:r,children:e.jsxs(J,{className:"max-h-[90vh] overflow-y-auto sm:max-w-[625px]",children:[e.jsxs(Q,{children:[e.jsx(W,{children:"Structure Details"}),e.jsx(ee,{children:"View detailed information about the structure"})]}),u?e.jsx("div",{className:"flex items-center justify-center py-6",children:e.jsx(V,{className:"h-8 w-8 animate-spin"})}):c?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Name"}),e.jsx("p",{className:"mt-1 text-sm",children:c.name||"Unnamed"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Type"}),e.jsx(D,{className:I("mt-1",we(c.type)),children:c.type})]}),c.user&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"User"}),e.jsx("p",{className:"mt-1 text-sm",children:c.user.email}),c.user.company&&e.jsx("p",{className:"text-muted-foreground text-xs",children:c.user.company.name})]}),c.company&&e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Company"}),e.jsx("p",{className:"mt-1 text-sm",children:c.company.name})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Parent Structure"}),e.jsx("p",{className:"mt-1 text-sm",children:c.parentStructure?.name||e.jsx("span",{className:"text-muted-foreground",children:"None"})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-muted-foreground text-sm font-medium",children:"Address"}),e.jsx("p",{className:"mt-1 text-sm",children:Ce(c.address)})]}),c.properties&&c.properties.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-muted-foreground mb-2 text-sm font-medium",children:["Properties (",c.properties.length,")"]}),e.jsx("div",{className:"space-y-2",children:c.properties.map(a=>e.jsx("div",{className:"bg-muted rounded-md p-2 text-sm",children:a.address||`${a.shortAddress}${a.unit?` Unit ${a.unit}`:""}`},a._id))})]}),c.hardware&&c.hardware.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-muted-foreground mb-2 text-sm font-medium",children:["Hardware (",c.hardware.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.hardware.map(a=>e.jsx(D,{variant:"secondary",children:a.name},a._id))})]})]}):e.jsx("p",{children:"No structure data available"})]})}):null}function hs(){return e.jsxs(e.Fragment,{children:[e.jsx(us,{}),e.jsx(ms,{}),e.jsx(xs,{})]})}function ps(){const{setIsCreateDialogOpen:s}=M();return e.jsxs(S,{onClick:()=>s(!0),children:[e.jsx(Ke,{className:"mr-2 h-4 w-4"}),"Add Structure"]})}function js({column:s,title:r,options:d}){const c=s?.getFacetedUniqueValues(),u=new Set(s?.getFilterValue());return e.jsxs(Je,{children:[e.jsx(Qe,{asChild:!0,children:e.jsxs(S,{variant:"outline",size:"sm",className:"h-8 border-dashed",children:[e.jsx(Te,{className:"mr-2 h-4 w-4"}),r,u?.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(es,{orientation:"vertical",className:"mx-2 h-4"}),e.jsx(D,{variant:"secondary",className:"rounded-sm px-1 font-normal lg:hidden",children:u.size}),e.jsx("div",{className:"hidden space-x-1 lg:flex",children:u.size>2?e.jsxs(D,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:[u.size," selected"]}):d.filter(a=>u.has(a.value)).map(a=>e.jsx(D,{variant:"secondary",className:"rounded-sm px-1 font-normal",children:a.label},a.value))})]})]})}),e.jsx(We,{className:"w-[200px] p-0",align:"start",children:e.jsxs(Be,{children:[e.jsx(ze,{placeholder:r}),e.jsxs(Ge,{children:[e.jsx(He,{children:"No results found."}),e.jsx(se,{children:d.map(a=>{const v=u.has(a.value);return e.jsxs(re,{onSelect:()=>{v?u.delete(a.value):u.add(a.value);const b=Array.from(u);s?.setFilterValue(b.length?b:void 0)},children:[e.jsx("div",{className:I("border-primary mr-2 flex h-4 w-4 items-center justify-center rounded-sm border",v?"bg-primary text-primary-foreground":"opacity-50 [&_svg]:invisible"),children:e.jsx(ss,{className:I("h-4 w-4")})}),a.icon&&e.jsx(a.icon,{className:"text-muted-foreground mr-2 h-4 w-4"}),e.jsx("span",{children:a.label}),c?.get(a.value)&&e.jsx("span",{className:"ml-auto flex h-4 w-4 items-center justify-center font-mono text-xs",children:c.get(a.value)})]},a.value)})}),u.size>0&&e.jsxs(e.Fragment,{children:[e.jsx(Xe,{}),e.jsx(se,{children:e.jsx(re,{onSelect:()=>s?.setFilterValue(void 0),className:"justify-center text-center",children:"Clear filters"})})]})]})]})})]})}function gs({table:s}){return e.jsxs(je,{children:[e.jsx(ge,{asChild:!0,children:e.jsxs(S,{variant:"outline",size:"sm",className:"ml-auto hidden h-8 lg:flex",children:[e.jsx(cs,{className:"mr-2 h-4 w-4"}),"View"]})}),e.jsxs(fe,{align:"end",className:"w-[150px]",children:[e.jsx(rs,{children:"Toggle columns"}),e.jsx(ye,{}),s.getAllColumns().filter(r=>typeof r.accessorFn<"u"&&r.getCanHide()).map(r=>e.jsx(ts,{className:"capitalize",checked:r.getIsVisible(),onCheckedChange:d=>r.toggleVisibility(!!d),children:r.id},r.id))]})]})}function fs({table:s}){const r=s.getState().columnFilters.length>0;return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-1 items-center space-x-2",children:[e.jsx(N,{placeholder:"Filter structures...",value:s.getColumn("name")?.getFilterValue()??"",onChange:d=>s.getColumn("name")?.setFilterValue(d.target.value),className:"h-8 w-[150px] lg:w-[250px]"}),s.getColumn("type")&&e.jsx(js,{column:s.getColumn("type"),title:"Type",options:[{label:"Building",value:o.BUILDING},{label:"Floor",value:o.FLOOR},{label:"Room",value:o.ROOM},{label:"Complex",value:o.COMPLEX},{label:"Area",value:o.AREA}]}),r&&e.jsxs(S,{variant:"ghost",onClick:()=>s.resetColumnFilters(),className:"h-8 px-2 lg:px-3",children:["Reset",e.jsx($e,{className:"ml-2 h-4 w-4"})]})]}),e.jsx(gs,{table:s})]})}function ys({row:s}){const r=s.original,{setSelectedStructure:d,setIsViewDialogOpen:c,setIsEditDialogOpen:u}=M(),a=()=>{d(r),c(!0)},v=()=>{d(r),u(!0)};return e.jsxs(je,{children:[e.jsx(ge,{asChild:!0,children:e.jsxs(S,{variant:"ghost",className:"data-[state=open]:bg-muted flex h-8 w-8 p-0",children:[e.jsx(ns,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Open menu"})]})}),e.jsxs(fe,{align:"end",className:"w-[160px]",children:[e.jsxs(ne,{onClick:a,children:[e.jsx(os,{className:"mr-2 h-4 w-4"}),"View"]}),e.jsx(ye,{}),e.jsxs(ne,{onClick:v,children:[e.jsx(ls,{className:"mr-2 h-4 w-4"}),"Edit"]})]})]})}const oe=[{id:"select",header:({table:s})=>e.jsx(le,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:r=>s.toggleAllPageRowsSelected(!!r),"aria-label":"Select all",className:"translate-y-[2px]"}),meta:{className:I("sticky md:table-cell left-0 z-10 rounded-tl","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted")},cell:({row:s})=>e.jsx(le,{checked:s.getIsSelected(),onCheckedChange:r=>s.toggleSelected(!!r),"aria-label":"Select row",className:"translate-y-[2px]"}),enableSorting:!1,enableHiding:!1},{accessorKey:"name",header:({column:s})=>e.jsx(P,{column:s,title:"Name"}),cell:({row:s})=>{const r=s.getValue("name");return e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(as,{className:"max-w-48 font-medium",children:r||e.jsx("span",{className:"text-muted-foreground",children:"Unnamed"})})})},meta:{className:I("drop-shadow-[0_1px_2px_rgb(0_0_0_/_0.1)] dark:drop-shadow-[0_1px_2px_rgb(255_255_255_/_0.1)] lg:drop-shadow-none","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted","sticky left-6 md:table-cell")},enableHiding:!1},{accessorKey:"type",header:({column:s})=>e.jsx(P,{column:s,title:"Type"}),cell:({row:s})=>{const r=s.getValue("type");return e.jsx(D,{className:I("font-medium",we(r)),children:r})},filterFn:(s,r,d)=>d.includes(s.getValue(r))},{id:"address",header:({column:s})=>e.jsx(P,{column:s,title:"Address"}),cell:({row:s})=>{const r=s.original.address;return e.jsx("div",{className:"text-nowrap",children:Ce(r)})},enableSorting:!1},{id:"user",header:({column:s})=>e.jsx(P,{column:s,title:"User / Company"}),cell:({row:s})=>{const r=s.original.user;return e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-sm",children:r?.email||"-"}),r?.company&&e.jsx("div",{className:"text-muted-foreground text-xs",children:r.company.name})]})},enableSorting:!1},{id:"parentStructure",header:({column:s})=>e.jsx(P,{column:s,title:"Parent Structure"}),cell:({row:s})=>{const r=s.original.parentStructure;return e.jsx("div",{className:"text-nowrap",children:r?.name||e.jsx("span",{className:"text-muted-foreground",children:"-"})})},enableSorting:!1},{id:"properties",header:({column:s})=>e.jsx(P,{column:s,title:"Properties"}),cell:({row:s})=>{const r=s.original.properties?.length||0;return e.jsx("div",{className:"text-center",children:e.jsx(D,{variant:"secondary",children:r})})},enableSorting:!1},{id:"hardware",header:({column:s})=>e.jsx(P,{column:s,title:"Hardware"}),cell:({row:s})=>{const r=s.original.hardware?.length||0;return e.jsx("div",{className:"text-center",children:e.jsx(D,{variant:"secondary",children:r})})},enableSorting:!1},{id:"actions",cell:({row:s})=>e.jsx(ys,{row:s}),meta:{className:I("sticky md:table-cell right-0 z-10","bg-background transition-colors duration-200 group-hover/row:bg-muted group-data-[state=selected]/row:bg-muted")}}];function vs({data:s,isLoading:r}){const{table:d}=Ze({data:s,columns:oe});return e.jsx(qe,{table:d,columns:oe,isLoading:r,toolbar:e.jsx(fs,{table:d}),showToolbar:!0})}function Ns(){const s=ke({strict:!1}),{data:r=[],isLoading:d,error:c}=Z(),u=s.company?r.filter(a=>a.user?.company?._id===s.company):r;return e.jsxs(ds,{children:[e.jsxs(Fe,{fixed:!0,children:[e.jsx(Ae,{}),e.jsxs("div",{className:"ml-auto flex items-center space-x-4",children:[e.jsx(Ee,{}),e.jsx(_e,{}),e.jsx(Ve,{})]})]}),e.jsxs(Me,{children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between space-y-2",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight",children:"Structures"}),e.jsx("p",{className:"text-muted-foreground",children:"Manage buildings, floors, rooms, complexes, and areas"})]}),e.jsx(ps,{})]}),e.jsx("div",{className:"-mx-4 flex-1 overflow-auto px-4 py-1 lg:flex-row lg:space-y-0 lg:space-x-12",children:c?e.jsxs(Pe,{variant:"destructive",children:[e.jsx(Ie,{className:"h-4 w-4"}),e.jsx(Le,{children:"Failed to load structures. Please try again later."})]}):e.jsx(vs,{data:u,isLoading:d})})]}),e.jsx(hs,{})]})}const ar=Ns;export{ar as component};
