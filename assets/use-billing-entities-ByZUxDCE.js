import{r as o,j as s,d as O,f as I,t as w}from"./index-LjicKyT0.js";import{C as X,g as H,i as J,j as ee}from"./command-X9JjFxyP.js";import{I as $}from"./input-Dlu4Ie9G.js";import{M as te}from"./map-pin-Drz5NG2-.js";import{c as k,u as z,b as L,h as G,q as u}from"./theme-switch-cMSK6cqB.js";let T=!1,b=!1,M=null;const se="AIzaSyDjDX1Ec8iwj6F_CTYWagwKdlMqQl7xUZc",ie=()=>T&&window.google?.maps?.places?Promise.resolve():(b&&M||(b=!0,M=new Promise((e,t)=>{const r=document.getElementById("google-maps-script");if(r){r.addEventListener("load",()=>{T=!0,b=!1,e()}),r.addEventListener("error",()=>{b=!1,t(new Error("Failed to load Google Maps script"))});return}const a=document.createElement("script");a.id="google-maps-script",a.src=`https://maps.googleapis.com/maps/api/js?key=${se}&libraries=places&callback=initGoogleMaps`,a.async=!0,a.defer=!0,window.initGoogleMaps=()=>{T=!0,b=!1,e(),delete window.initGoogleMaps},a.onerror=()=>{b=!1,t(new Error("Failed to load Google Maps script")),delete window.initGoogleMaps},document.head.appendChild(a)})),M);function ge({value:e,onChange:t,placeholder:r="Start typing an address...",disabled:a=!1,className:v}){const f=o.useRef(null),c=o.useRef(null),[y,m]=o.useState(!0),[E,U]=o.useState(null),[p,j]=o.useState([]),[Q,x]=o.useState(!1),[C,S]=o.useState(-1),[V,P]=o.useState(e?.street||"");o.useEffect(()=>{P(e?.street||"")},[e?.street]);const B=o.useRef(null),D=o.useRef(null),A=o.useRef(void 0),_=o.useRef(void 0);o.useEffect(()=>{let i=!0;return ie().then(()=>{if(!i)return;B.current=new google.maps.places.AutocompleteService;const n=document.createElement("div");D.current=new google.maps.places.PlacesService(n),A.current=new google.maps.places.AutocompleteSessionToken,m(!1)}).catch(n=>{i&&(U(n.message),m(!1))}),()=>{i=!1,_.current&&clearTimeout(_.current)}},[]);const F=o.useCallback(i=>{if(!B.current||!i.trim()){j([]);return}_.current&&clearTimeout(_.current),_.current=setTimeout(()=>{B.current&&B.current.getPlacePredictions({input:i,types:["address"],componentRestrictions:{country:["us","ca"]},sessionToken:A.current},(n,h)=>{h===google.maps.places.PlacesServiceStatus.OK&&n?(j(n.map(l=>({description:l.description,place_id:l.place_id,structured_formatting:l.structured_formatting}))),x(!0)):j([])})},300)},[]),q=o.useCallback(i=>{D.current&&D.current.getDetails({placeId:i,fields:["address_components","formatted_address","name","geometry"],sessionToken:A.current},(n,h)=>{if(h===google.maps.places.PlacesServiceStatus.OK&&n?.address_components){const l={street:"",city:"",state:"",zipCode:"",country:""};let N="",K="";n.address_components.forEach(R=>{const d=R.types,g=R.long_name,W=R.short_name;d.includes("street_number")?N=g:d.includes("route")?K=g:d.includes("locality")||d.includes("sublocality_level_1")&&!l.city||d.includes("administrative_area_level_2")&&!l.city?l.city=g:d.includes("administrative_area_level_1")?l.state=W:d.includes("postal_code")||d.includes("postal_code_prefix")&&!l.zipCode?l.zipCode=g:d.includes("country")&&(l.country=g)}),l.street=N?`${N} ${K}`:K,P(l.street),t(l),x(!1),j([]),S(-1),A.current=new google.maps.places.AutocompleteSessionToken}})},[t]),Y=o.useCallback(i=>{const n=i.target.value;P(n),n.trim()?F(n):(j([]),x(!1))},[F]),Z=o.useCallback(i=>{if(!(!Q||p.length===0))switch(i.key){case"ArrowDown":i.preventDefault(),S(n=>n<p.length-1?n+1:n);break;case"ArrowUp":i.preventDefault(),S(n=>n>0?n-1:-1);break;case"Enter":i.preventDefault(),C>=0&&p[C]&&q(p[C].place_id);break;case"Escape":x(!1),S(-1);break}},[Q,p,C,q]);return o.useEffect(()=>{const i=n=>{const h=n.target,l=f.current&&f.current.contains(h),N=c.current&&c.current.contains(h);!l&&!N&&x(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]),E?s.jsxs("div",{className:v,children:[s.jsx($,{disabled:!0,placeholder:"Error loading address autocomplete",className:"border-destructive mt-2"}),s.jsx("p",{className:"text-destructive mt-1 text-sm",children:E})]}):s.jsxs("div",{className:v,children:[s.jsxs("div",{className:"relative",children:[s.jsx($,{ref:f,type:"text",value:V,onChange:Y,onKeyDown:Z,onFocus:()=>{p.length>0&&x(!0)},placeholder:y?"Loading...":r,disabled:a||y,className:O("mt-2",y&&"opacity-50"),autoComplete:"off"}),Q&&p.length>0&&s.jsx("div",{ref:c,className:"absolute z-50 mt-1 w-full",children:s.jsx(X,{className:"rounded-lg border shadow-md",children:s.jsx(H,{children:s.jsx(J,{children:p.map((i,n)=>s.jsxs(ee,{value:i.description,onSelect:()=>q(i.place_id),onClick:()=>q(i.place_id),className:O("cursor-pointer",C===n&&"bg-accent"),onMouseEnter:()=>S(n),children:[s.jsx(te,{className:"text-muted-foreground mr-2 h-4 w-4"}),s.jsx("div",{className:"flex-1",children:i.structured_formatting?s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:i.structured_formatting.main_text}),s.jsx("p",{className:"text-muted-foreground text-sm",children:i.structured_formatting.secondary_text})]}):s.jsx("p",{children:i.description})})]},i.place_id))})})})})]}),e?.street&&s.jsxs("div",{className:"bg-muted/50 mt-3 grid gap-2 rounded-lg p-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-muted-foreground text-sm",children:"City:"}),s.jsx("p",{className:"font-medium",children:e.city||"-"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-muted-foreground text-sm",children:"State:"}),s.jsx("p",{className:"font-medium",children:e.state||"-"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-muted-foreground text-sm",children:"Zip Code:"}),s.jsx("p",{className:"font-medium",children:e.zipCode||"-"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-muted-foreground text-sm",children:"Country:"}),s.jsx("p",{className:"font-medium",children:e.country||"-"})]})]})]})]})}const ne=async e=>(await k.get(`/api/billing-entities/admin/company/${e}`)).data,re=async(e={})=>{const t=new URLSearchParams;e.page&&t.set("page",e.page.toString()),e.limit&&t.set("limit",e.limit.toString()),e.search&&t.set("search",e.search),e.entityType&&t.set("entityType",e.entityType),e.isActive!==void 0&&t.set("isActive",e.isActive.toString()),e.sortBy&&t.set("sortBy",e.sortBy),e.sortOrder&&t.set("sortOrder",e.sortOrder);const r=`/api/billing-entities${t.toString()?`?${t.toString()}`:""}`;return await k.get(r)},le=async e=>await k.post("/api/billing-entities/admin/create",e),oe=async(e,t)=>await k.put(`/api/billing-entities/${e}`,t),ae=async e=>{await k.delete(`/api/billing-entities/${e}`)},fe=e=>z({queryKey:u.billingEntities.byCompany(e||""),queryFn:()=>{if(!e)throw new Error("Company ID is required");return ne(e)},enabled:!!e}),ye=(e={})=>z({queryKey:u.billingEntities.list(e),queryFn:()=>re(e)}),Ee=()=>{const e=I();return L({mutationFn:t=>le(t),onSuccess:t=>{e.invalidateQueries({queryKey:u.billingEntities.byCompany(t.company)}),e.invalidateQueries({queryKey:u.billingEntities.all}),w.success("Billing entity created successfully")},onError:t=>{const r=G(t);w.error(r)}})},xe=()=>{const e=I();return L({mutationFn:({_id:t,...r})=>oe(t,r),onMutate:async({_id:t,...r})=>{await e.cancelQueries({queryKey:u.billingEntities.detail(t)});const a=e.getQueryData(u.billingEntities.detail(t));return a&&e.setQueryData(u.billingEntities.detail(t),{...a,...r}),e.getQueriesData({queryKey:u.billingEntities.all}).forEach(([f,c])=>{if(c){if(Array.isArray(c)){const y=c.map(m=>m._id===t?{...m,...r}:m);e.setQueryData(f,y)}else if(c&&typeof c=="object"&&"billingEntities"in c&&Array.isArray(c.billingEntities)){const m=c.billingEntities.map(E=>E._id===t?{...E,...r}:E);e.setQueryData(f,{...c,billingEntities:m})}}}),{previousEntity:a}},onError:(t,{_id:r},a)=>{a?.previousEntity&&e.setQueryData(u.billingEntities.detail(r),a.previousEntity);const v=G(t);w.error(v)},onSuccess:t=>{e.invalidateQueries({queryKey:u.billingEntities.detail(t._id)}),e.invalidateQueries({queryKey:u.billingEntities.byCompany(t.company)}),w.success("Billing entity updated successfully")}})},he=()=>{const e=I();return L({mutationFn:t=>ae(t),onError:t=>{const r=G(t);w.error(r)},onSuccess:()=>{e.invalidateQueries({queryKey:u.billingEntities.all}),w.success("Billing entity deleted successfully")}})};export{ge as A,he as a,xe as b,fe as c,ye as d,Ee as u};
