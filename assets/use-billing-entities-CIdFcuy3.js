import{r as l,j as s,d as O,f as I,t as w}from"./index-CsPbyjqq.js";import{C as X,g as H,i as J,j as ee}from"./command-DOxIIFlo.js";import{I as $}from"./input-5SQVrAtH.js";import{M as te}from"./map-pin-eHjt42m6.js";import{c as A,u as z,b as L,q as u}from"./theme-switch-BkO31Og6.js";let T=!1,h=!1,M=null;const se="AIzaSyDjDX1Ec8iwj6F_CTYWagwKdlMqQl7xUZc",ie=()=>T&&window.google?.maps?.places?Promise.resolve():(h&&M||(h=!0,M=new Promise((e,t)=>{const r=document.getElementById("google-maps-script");if(r){r.addEventListener("load",()=>{T=!0,h=!1,e()}),r.addEventListener("error",()=>{h=!1,t(new Error("Failed to load Google Maps script"))});return}const a=document.createElement("script");a.id="google-maps-script",a.src=`https://maps.googleapis.com/maps/api/js?key=${se}&libraries=places&callback=initGoogleMaps`,a.async=!0,a.defer=!0,window.initGoogleMaps=()=>{T=!0,h=!1,e(),delete window.initGoogleMaps},a.onerror=()=>{h=!1,t(new Error("Failed to load Google Maps script")),delete window.initGoogleMaps},document.head.appendChild(a)})),M);function ge({value:e,onChange:t,placeholder:r="Start typing an address...",disabled:a=!1,className:v}){const f=l.useRef(null),c=l.useRef(null),[y,m]=l.useState(!0),[E,U]=l.useState(null),[p,j]=l.useState([]),[Q,x]=l.useState(!1),[C,S]=l.useState(-1),[V,P]=l.useState(e?.street||"");l.useEffect(()=>{P(e?.street||"")},[e?.street]);const k=l.useRef(null),D=l.useRef(null),B=l.useRef(void 0),_=l.useRef(void 0);l.useEffect(()=>{let i=!0;return ie().then(()=>{if(!i)return;k.current=new google.maps.places.AutocompleteService;const n=document.createElement("div");D.current=new google.maps.places.PlacesService(n),B.current=new google.maps.places.AutocompleteSessionToken,m(!1)}).catch(n=>{i&&(U(n.message),m(!1))}),()=>{i=!1,_.current&&clearTimeout(_.current)}},[]);const F=l.useCallback(i=>{if(!k.current||!i.trim()){j([]);return}_.current&&clearTimeout(_.current),_.current=setTimeout(()=>{k.current&&k.current.getPlacePredictions({input:i,types:["address"],componentRestrictions:{country:["us","ca"]},sessionToken:B.current},(n,b)=>{b===google.maps.places.PlacesServiceStatus.OK&&n?(j(n.map(o=>({description:o.description,place_id:o.place_id,structured_formatting:o.structured_formatting}))),x(!0)):j([])})},300)},[]),q=l.useCallback(i=>{D.current&&D.current.getDetails({placeId:i,fields:["address_components","formatted_address","name","geometry"],sessionToken:B.current},(n,b)=>{if(b===google.maps.places.PlacesServiceStatus.OK&&n?.address_components){const o={street:"",city:"",state:"",zipCode:"",country:""};let N="",K="";n.address_components.forEach(R=>{const d=R.types,g=R.long_name,W=R.short_name;d.includes("street_number")?N=g:d.includes("route")?K=g:d.includes("locality")||d.includes("sublocality_level_1")&&!o.city||d.includes("administrative_area_level_2")&&!o.city?o.city=g:d.includes("administrative_area_level_1")?o.state=W:d.includes("postal_code")||d.includes("postal_code_prefix")&&!o.zipCode?o.zipCode=g:d.includes("country")&&(o.country=g)}),o.street=N?`${N} ${K}`:K,P(o.street),t(o),x(!1),j([]),S(-1),B.current=new google.maps.places.AutocompleteSessionToken}})},[t]),Y=l.useCallback(i=>{const n=i.target.value;P(n),n.trim()?F(n):(j([]),x(!1))},[F]),Z=l.useCallback(i=>{if(!(!Q||p.length===0))switch(i.key){case"ArrowDown":i.preventDefault(),S(n=>n<p.length-1?n+1:n);break;case"ArrowUp":i.preventDefault(),S(n=>n>0?n-1:-1);break;case"Enter":i.preventDefault(),C>=0&&p[C]&&q(p[C].place_id);break;case"Escape":x(!1),S(-1);break}},[Q,p,C,q]);return l.useEffect(()=>{const i=n=>{const b=n.target,o=f.current&&f.current.contains(b),N=c.current&&c.current.contains(b);!o&&!N&&x(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[]),E?s.jsxs("div",{className:v,children:[s.jsx($,{disabled:!0,placeholder:"Error loading address autocomplete",className:"border-destructive mt-2"}),s.jsx("p",{className:"text-destructive mt-1 text-sm",children:E})]}):s.jsxs("div",{className:v,children:[s.jsxs("div",{className:"relative",children:[s.jsx($,{ref:f,type:"text",value:V,onChange:Y,onKeyDown:Z,onFocus:()=>{p.length>0&&x(!0)},placeholder:y?"Loading...":r,disabled:a||y,className:O("mt-2",y&&"opacity-50"),autoComplete:"off"}),Q&&p.length>0&&s.jsx("div",{ref:c,className:"absolute z-50 mt-1 w-full",children:s.jsx(X,{className:"rounded-lg border shadow-md",children:s.jsx(H,{children:s.jsx(J,{children:p.map((i,n)=>s.jsxs(ee,{value:i.description,onSelect:()=>q(i.place_id),onClick:()=>q(i.place_id),className:O("cursor-pointer",C===n&&"bg-accent"),onMouseEnter:()=>S(n),children:[s.jsx(te,{className:"text-muted-foreground mr-2 h-4 w-4"}),s.jsx("div",{className:"flex-1",children:i.structured_formatting?s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:i.structured_formatting.main_text}),s.jsx("p",{className:"text-muted-foreground text-sm",children:i.structured_formatting.secondary_text})]}):s.jsx("p",{children:i.description})})]},i.place_id))})})})})]}),e?.street&&s.jsxs("div",{className:"bg-muted/50 mt-3 grid gap-2 rounded-lg p-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-muted-foreground text-sm",children:"City:"}),s.jsx("p",{className:"font-medium",children:e.city||"-"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-muted-foreground text-sm",children:"State:"}),s.jsx("p",{className:"font-medium",children:e.state||"-"})]})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[s.jsxs("div",{children:[s.jsx("span",{className:"text-muted-foreground text-sm",children:"Zip Code:"}),s.jsx("p",{className:"font-medium",children:e.zipCode||"-"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"text-muted-foreground text-sm",children:"Country:"}),s.jsx("p",{className:"font-medium",children:e.country||"-"})]})]})]})]})}const ne=async e=>(await A.get(`/api/billing-entities/admin/company/${e}`)).data,re=async(e={})=>{const t=new URLSearchParams;e.page&&t.set("page",e.page.toString()),e.limit&&t.set("limit",e.limit.toString()),e.search&&t.set("search",e.search),e.entityType&&t.set("entityType",e.entityType),e.isActive!==void 0&&t.set("isActive",e.isActive.toString()),e.sortBy&&t.set("sortBy",e.sortBy),e.sortOrder&&t.set("sortOrder",e.sortOrder);const r=`/api/billing-entities${t.toString()?`?${t.toString()}`:""}`;return await A.get(r)},oe=async e=>await A.post("/api/billing-entities",e),le=async(e,t)=>await A.put(`/api/billing-entities/${e}`,t),ae=async e=>{await A.delete(`/api/billing-entities/${e}`)},G=e=>{if(e&&typeof e=="object"&&"response"in e&&e.response&&typeof e.response=="object"&&"data"in e.response&&e.response.data&&typeof e.response.data=="object"){const t=e.response.data;if(t.errors&&Array.isArray(t.errors)){const r=t.errors[0];if(r&&typeof r=="object"&&"message"in r)return String(r.message)}if(t.message&&typeof t.message=="string")return t.message}return e&&typeof e=="object"&&"message"in e&&typeof e.message=="string"?e.message:"An unexpected error occurred"},fe=e=>z({queryKey:u.billingEntities.byCompany(e||""),queryFn:()=>{if(!e)throw new Error("Company ID is required");return ne(e)},enabled:!!e}),ye=(e={})=>z({queryKey:u.billingEntities.list(e),queryFn:()=>re(e)}),Ee=()=>{const e=I();return L({mutationFn:t=>oe(t),onSuccess:t=>{e.invalidateQueries({queryKey:u.billingEntities.byCompany(t.company)}),e.invalidateQueries({queryKey:u.billingEntities.all}),w.success("Billing entity created successfully")},onError:t=>{const r=G(t);w.error(r)}})},xe=()=>{const e=I();return L({mutationFn:({_id:t,...r})=>le(t,r),onMutate:async({_id:t,...r})=>{await e.cancelQueries({queryKey:u.billingEntities.detail(t)});const a=e.getQueryData(u.billingEntities.detail(t));return a&&e.setQueryData(u.billingEntities.detail(t),{...a,...r}),e.getQueriesData({queryKey:u.billingEntities.all}).forEach(([f,c])=>{if(c){if(Array.isArray(c)){const y=c.map(m=>m._id===t?{...m,...r}:m);e.setQueryData(f,y)}else if(c&&typeof c=="object"&&"billingEntities"in c&&Array.isArray(c.billingEntities)){const m=c.billingEntities.map(E=>E._id===t?{...E,...r}:E);e.setQueryData(f,{...c,billingEntities:m})}}}),{previousEntity:a}},onError:(t,{_id:r},a)=>{a?.previousEntity&&e.setQueryData(u.billingEntities.detail(r),a.previousEntity);const v=G(t);w.error(v)},onSuccess:t=>{e.invalidateQueries({queryKey:u.billingEntities.detail(t._id)}),e.invalidateQueries({queryKey:u.billingEntities.byCompany(t.company)}),w.success("Billing entity updated successfully")}})},be=()=>{const e=I();return L({mutationFn:t=>ae(t),onError:t=>{const r=G(t);w.error(r)},onSuccess:()=>{e.invalidateQueries({queryKey:u.billingEntities.all}),w.success("Billing entity deleted successfully")}})};export{ge as A,be as a,xe as b,fe as c,ye as d,Ee as u};
