import{M as lt,P as ut,o as Ie,D as Te,Q as Ce,p as we,q as De,R as be,S as b,T as Qe,U as ht,V as et,W as dt,X as gt,x as C,Y as ft,Z as F,_ as pt,$ as St,a0 as mt,a1 as tt,a2 as ue,K as P,I as v,z as H,C as x,F as V,J as K,a3 as nt,E as L,a4 as te,a5 as Et,a6 as At,v as ne,r as yt,m as It,a as Tt,l as Ct,j as y,d as wt,L as Dt,B as Pt,t as X}from"./index-CvyRkeE5.js";import{u as vt,a as Rt,F as Nt,b as Be,c as xe,d as ke,e as He,f as Le}from"./form-BBbFGrnZ.js";import{I as _t}from"./input-5vX5qBNK.js";import{P as Ft}from"./password-input-CUpVFB6t.js";import{I as We}from"./errors-CS9alWEK.js";import{b as he,a as w,A as D}from"./assertValidationError-0sZnGol9.js";import{r as k,a as Ut}from"./autoSignIn-BMLW60Lb.js";import{o as Mt,s as Ve}from"./types-Wky072k2.js";const Ot=async()=>{const{userAgentData:e}=navigator;if(!e)return navigator.userAgent;const{platform:t="",platformVersion:n="",model:s="",architecture:i="",fullVersionList:o=[]}=await e.getHighEntropyValues(["platform","platformVersion","architecture","model","fullVersionList"]),a=o.map(c=>`${c.brand}/${c.version}`).join(";");return[t,n,i,s,t,a].filter(c=>c).join(" ")||navigator.userAgent};function bt(e){return Array.from(e,t=>String.fromCodePoint(t)).join("")}const ee={convert(e,t={urlSafe:!1,skipPadding:!1}){const n=typeof e=="string"?e:bt(e);let s=lt()(n);return t.urlSafe&&(s=s.replace(/\+/g,"-").replace(/\//g,"_")),t.skipPadding&&(s=s.replace(/=/g,"")),s}};function Bt(){return ut().getRandomValues(new Uint32Array(1))[0]}function xt(e){const{words:t}=e,{sigBytes:n}=e,s=[];for(let i=0;i<n;i++){const o=t[i>>>2]>>>24-i%4*8&255;s.push((o>>>4).toString(16)),s.push((o&15).toString(16))}return s.join("")}class Pe{constructor(t,n){this.words=[];let s=t;s=this.words=s||[],n!==void 0?this.sigBytes=n:this.sigBytes=s.length*4}random(t){const n=[];for(let s=0;s<t;s+=4)n.push(Bt());return new Pe(n,t)}toString(){return xt(this)}}const ge=e=>Ie(De,we("RespondToAuthChallenge"),Ce(),{...Te,...e}),kt=e=>Ie(De,we("AssociateSoftwareToken"),Ce(),{...Te,...e});async function G(e){if(e.AccessToken){const t=be(e.AccessToken),n=(t.payload.iat||0)*1e3,s=new Date().getTime(),i=n>0?n-s:0;let o,a,r;e.RefreshToken&&(a=e.RefreshToken),e.IdToken&&(o=be(e.IdToken)),e?.NewDeviceMetadata&&(r=e.NewDeviceMetadata);const c={accessToken:t,idToken:o,refreshToken:a,clockDrift:i,deviceMetadata:r,username:e.username};e?.signInDetails&&(c.signInDetails=e.signInDetails),await b.setTokens({tokens:c})}else throw new Qe({message:"Invalid tokens",name:"InvalidTokens",recoverySuggestion:"Check Cognito UserPool settings"})}const Ht="Unable to get user session following successful sign-in.",j=async()=>{try{ht.dispatch("auth",{event:"signedIn",data:await et()},"Auth",dt)}catch(e){throw e.name===gt?new C({name:ft,message:Ht,recoverySuggestion:"This most likely is due to auth tokens not being persisted. If you are using cookie store, please ensure cookies can be correctly set from your server."}):e}},Lt=3*60*1e3,ae="CognitoSignInState",U={username:`${ae}.username`,challengeName:`${ae}.challengeName`,signInSession:`${ae}.signInSession`,expiry:`${ae}.expiry`},Wt=(e,t)=>{switch(t.type){case"SET_SIGN_IN_SESSION":return re({signInSession:t.value}),{...e,signInSession:t.value};case"SET_SIGN_IN_STATE":return re(t.value),{...t.value};case"SET_CHALLENGE_NAME":return re({challengeName:t.value}),{...e,challengeName:t.value};case"SET_USERNAME":return re({username:t.value}),{...e,username:t.value};case"SET_INITIAL_STATE":return Kt();case"RESET_STATE":return st(),ve();default:return e}},Vt=e=>{const t=Number(e),n=Date.now();return t<=n},R=()=>{B.dispatch({type:"RESET_STATE"})},st=()=>{for(const e of Object.values(U))F.removeItem(e)},ve=()=>({username:void 0,challengeName:void 0,signInSession:void 0}),Kt=()=>{const e=F.getItem(U.expiry);if(!e||Vt(e))return st(),ve();const t=F.getItem(U.username)??void 0,n=F.getItem(U.challengeName)??void 0,s=F.getItem(U.signInSession)??void 0;return{username:t,challengeName:n,signInSession:s}},Gt=e=>{let t=e(ve(),{type:"SET_INITIAL_STATE"});return{getState:()=>t,dispatch:n=>{t=e(t,n)}}},B=Gt(Wt);function $(e){B.dispatch({type:"SET_SIGN_IN_STATE",value:e})}const re=({challengeName:e,signInSession:t,username:n})=>{n&&F.setItem(U.username,n),e&&F.setItem(U.challengeName,e),t&&(F.setItem(U.signInSession,t),F.setItem(U.expiry,String(Date.now()+Lt)))};class M extends Qe{constructor(t){super(t),this.constructor=M,Object.setPrototypeOf(this,M.prototype)}}var S;(function(e){e.PasskeyNotSupported="PasskeyNotSupported",e.PasskeyAlreadyExists="PasskeyAlreadyExists",e.InvalidPasskeyRegistrationOptions="InvalidPasskeyRegistrationOptions",e.InvalidPasskeyAuthenticationOptions="InvalidPasskeyAuthenticationOptions",e.RelyingPartyMismatch="RelyingPartyMismatch",e.PasskeyRegistrationFailed="PasskeyRegistrationFailed",e.PasskeyRetrievalFailed="PasskeyRetrievalFailed",e.PasskeyRegistrationCanceled="PasskeyRegistrationCanceled",e.PasskeyAuthenticationCanceled="PasskeyAuthenticationCanceled",e.PasskeyOperationAborted="PasskeyOperationAborted"})(S||(S={}));const Ke="Passkeys may not be supported on this device. Ensure your application is running in a secure context (HTTPS) and Web Authentication API is supported.",Ee="User may have canceled the ceremony or another interruption has occurred. Check underlying error for details.",Ge="Ensure your user pool is configured to support the WEB_AUTHN as an authentication factor.",de={[S.PasskeyNotSupported]:{message:"Passkeys may not be supported on this device.",recoverySuggestion:Ke},[S.InvalidPasskeyRegistrationOptions]:{message:"Invalid passkey registration options.",recoverySuggestion:Ge},[S.InvalidPasskeyAuthenticationOptions]:{message:"Invalid passkey authentication options.",recoverySuggestion:Ge},[S.PasskeyRegistrationFailed]:{message:"Device failed to create passkey.",recoverySuggestion:Ke},[S.PasskeyRetrievalFailed]:{message:"Device failed to retrieve passkey.",recoverySuggestion:"Passkeys may not be available on this device. Try an alternative authentication factor like PASSWORD, EMAIL_OTP, or SMS_OTP."},[S.PasskeyAlreadyExists]:{message:"Passkey already exists in authenticator.",recoverySuggestion:"Proceed with existing passkey or try again after deleting the credential."},[S.PasskeyRegistrationCanceled]:{message:"Passkey registration ceremony has been canceled.",recoverySuggestion:Ee},[S.PasskeyAuthenticationCanceled]:{message:"Passkey authentication ceremony has been canceled.",recoverySuggestion:Ee},[S.PasskeyOperationAborted]:{message:"Passkey operation has been aborted.",recoverySuggestion:Ee},[S.RelyingPartyMismatch]:{message:"Relying party does not match current domain.",recoverySuggestion:"Ensure relying party identifier matches current domain."}},Re=pt(de,M),jt=e=>{if(e instanceof M)return e;if(e instanceof Error&&e.name==="NotAllowedError"){const{message:t,recoverySuggestion:n}=de[S.PasskeyAuthenticationCanceled];return new M({name:S.PasskeyAuthenticationCanceled,message:t,recoverySuggestion:n,underlyingError:e})}return $t(e)},$t=e=>{if(e instanceof Error){if(e.name==="AbortError"){const{message:t,recoverySuggestion:n}=de[S.PasskeyOperationAborted];return new M({name:S.PasskeyOperationAborted,message:t,recoverySuggestion:n,underlyingError:e})}if(e.name==="SecurityError"){const{message:t,recoverySuggestion:n}=de[S.RelyingPartyMismatch];return new M({name:S.RelyingPartyMismatch,message:t,recoverySuggestion:n,underlyingError:e})}}return new M({name:St.Unknown,message:"An unknown error has occurred.",underlyingError:e})},qt=()=>mt()&&window.isSecureContext&&"credentials"in navigator&&typeof window.PublicKeyCredential=="function",Q=e=>ee.convert(new Uint8Array(e),{urlSafe:!0,skipPadding:!0}),je=e=>Uint8Array.from(tt.convert(e,{urlSafe:!0}),t=>t.charCodeAt(0)).buffer,Yt=e=>{const t=je(e.challenge),n=(e.allowCredentials||[]).map(s=>({...s,id:je(s.id)}));return{...e,challenge:t,allowCredentials:n}},Jt=e=>{const t={clientDataJSON:Q(e.response.clientDataJSON),authenticatorData:Q(e.response.authenticatorData),signature:Q(e.response.signature)};e.response.userHandle&&(t.userHandle=Q(e.response.userHandle));const n={id:e.id,rawId:Q(e.rawId),type:e.type,clientExtensionResults:e.getClientExtensionResults(),response:t};return e.authenticatorAttachment&&(n.authenticatorAttachment=e.authenticatorAttachment),n};function Zt(e){Re(e&&e instanceof PublicKeyCredential&&e.response instanceof AuthenticatorAssertionResponse,S.PasskeyRetrievalFailed)}const zt=async e=>{try{const t=qt();Re(t,S.PasskeyNotSupported);const n=Yt(e),s=await navigator.credentials.get({publicKey:n});return Zt(s),Jt(s)}catch(t){throw jt(t)}},Xt=e=>Ie(De,we("ConfirmDevice"),Ce(),{...Te,...e}),ce={convert(e){return new TextEncoder().encode(e)}};function h(e,t){e!=null&&this.fromString(e,t)}function I(){return new h(null,null)}let O;const Qt=0xdeadbeefcafe,$e=(Qt&16777215)===15715070;function en(e,t,n,s,i,o){for(;--o>=0;){const a=t*this[e++]+n[s]+i;i=Math.floor(a/67108864),n[s++]=a&67108863}return i}function tn(e,t,n,s,i,o){const a=t&32767,r=t>>15;for(;--o>=0;){let c=this[e]&32767;const l=this[e++]>>15,u=r*c+l*a;c=a*c+((u&32767)<<15)+n[s]+(i&1073741823),i=(c>>>30)+(u>>>15)+r*l+(i>>>30),n[s++]=c&1073741823}return i}function nn(e,t,n,s,i,o){const a=t&16383,r=t>>14;for(;--o>=0;){let c=this[e]&16383;const l=this[e++]>>14,u=r*c+l*a;c=a*c+((u&16383)<<14)+n[s]+i,i=(c>>28)+(u>>14)+r*l,n[s++]=c&268435455}return i}const qe=typeof navigator<"u";qe&&$e&&navigator.appName==="Microsoft Internet Explorer"?(h.prototype.am=tn,O=30):qe&&$e&&navigator.appName!=="Netscape"?(h.prototype.am=en,O=26):(h.prototype.am=nn,O=28);h.prototype.DB=O;h.prototype.DM=(1<<O)-1;h.prototype.DV=1<<O;const Ne=52;h.prototype.FV=Math.pow(2,Ne);h.prototype.F1=Ne-O;h.prototype.F2=2*O-Ne;const sn="0123456789abcdefghijklmnopqrstuvwxyz",fe=[];let q,T;q=48;for(T=0;T<=9;++T)fe[q++]=T;q=97;for(T=10;T<36;++T)fe[q++]=T;q=65;for(T=10;T<36;++T)fe[q++]=T;function Ye(e){return sn.charAt(e)}function on(e,t){const n=fe[e.charCodeAt(t)];return n??-1}function an(e){for(let t=this.t-1;t>=0;--t)e[t]=this[t];e.t=this.t,e.s=this.s}function rn(e){this.t=1,this.s=e<0?-1:0,e>0?this[0]=e:e<-1?this[0]=e+this.DV:this.t=0}function _e(e){const t=I();return t.fromInt(e),t}function cn(e,t){let n;if(t===16)n=4;else if(t===8)n=3;else if(t===2)n=1;else if(t===32)n=5;else if(t===4)n=2;else throw new Error("Only radix 2, 4, 8, 16, 32 are supported");this.t=0,this.s=0;let s=e.length,i=!1,o=0;for(;--s>=0;){const a=on(e,s);if(a<0){e.charAt(s)==="-"&&(i=!0);continue}i=!1,o===0?this[this.t++]=a:o+n>this.DB?(this[this.t-1]|=(a&(1<<this.DB-o)-1)<<o,this[this.t++]=a>>this.DB-o):this[this.t-1]|=a<<o,o+=n,o>=this.DB&&(o-=this.DB)}this.clamp(),i&&h.ZERO.subTo(this,this)}function ln(){const e=this.s&this.DM;for(;this.t>0&&this[this.t-1]==e;)--this.t}function un(e){if(this.s<0)return"-"+this.negate().toString(e);let t;if(e==16)t=4;else if(e===8)t=3;else if(e===2)t=1;else if(e===32)t=5;else if(e===4)t=2;else throw new Error("Only radix 2, 4, 8, 16, 32 are supported");const n=(1<<t)-1;let s,i=!1,o="",a=this.t,r=this.DB-a*this.DB%t;if(a-- >0)for(r<this.DB&&(s=this[a]>>r)>0&&(i=!0,o=Ye(s));a>=0;)r<t?(s=(this[a]&(1<<r)-1)<<t-r,s|=this[--a]>>(r+=this.DB-t)):(s=this[a]>>(r-=t)&n,r<=0&&(r+=this.DB,--a)),s>0&&(i=!0),i&&(o+=Ye(s));return i?o:"0"}function hn(){const e=I();return h.ZERO.subTo(this,e),e}function dn(){return this.s<0?this.negate():this}function gn(e){let t=this.s-e.s;if(t!=0)return t;let n=this.t;if(t=n-e.t,t!=0)return this.s<0?-t:t;for(;--n>=0;)if((t=this[n]-e[n])!=0)return t;return 0}function Fe(e){let t=1,n;return(n=e>>>16)!==0&&(e=n,t+=16),(n=e>>8)!==0&&(e=n,t+=8),(n=e>>4)!==0&&(e=n,t+=4),(n=e>>2)!==0&&(e=n,t+=2),(n=e>>1)!==0&&(e=n,t+=1),t}function fn(){return this.t<=0?0:this.DB*(this.t-1)+Fe(this[this.t-1]^this.s&this.DM)}function pn(e,t){let n;for(n=this.t-1;n>=0;--n)t[n+e]=this[n];for(n=e-1;n>=0;--n)t[n]=0;t.t=this.t+e,t.s=this.s}function Sn(e,t){for(let n=e;n<this.t;++n)t[n-e]=this[n];t.t=Math.max(this.t-e,0),t.s=this.s}function mn(e,t){const n=e%this.DB,s=this.DB-n,i=(1<<s)-1,o=Math.floor(e/this.DB);let a=this.s<<n&this.DM,r;for(r=this.t-1;r>=0;--r)t[r+o+1]=this[r]>>s|a,a=(this[r]&i)<<n;for(r=o-1;r>=0;--r)t[r]=0;t[o]=a,t.t=this.t+o+1,t.s=this.s,t.clamp()}function En(e,t){t.s=this.s;const n=Math.floor(e/this.DB);if(n>=this.t){t.t=0;return}const s=e%this.DB,i=this.DB-s,o=(1<<s)-1;t[0]=this[n]>>s;for(let a=n+1;a<this.t;++a)t[a-n-1]|=(this[a]&o)<<i,t[a-n]=this[a]>>s;s>0&&(t[this.t-n-1]|=(this.s&o)<<i),t.t=this.t-n,t.clamp()}function An(e,t){let n=0,s=0;const i=Math.min(e.t,this.t);for(;n<i;)s+=this[n]-e[n],t[n++]=s&this.DM,s>>=this.DB;if(e.t<this.t){for(s-=e.s;n<this.t;)s+=this[n],t[n++]=s&this.DM,s>>=this.DB;s+=this.s}else{for(s+=this.s;n<e.t;)s-=e[n],t[n++]=s&this.DM,s>>=this.DB;s-=e.s}t.s=s<0?-1:0,s<-1?t[n++]=this.DV+s:s>0&&(t[n++]=s),t.t=n,t.clamp()}function yn(e,t){const n=this.abs(),s=e.abs();let i=n.t;for(t.t=i+s.t;--i>=0;)t[i]=0;for(i=0;i<s.t;++i)t[i+n.t]=n.am(0,s[i],t,i,0,n.t);t.s=0,t.clamp(),this.s!==e.s&&h.ZERO.subTo(t,t)}function In(e){const t=this.abs();let n=e.t=2*t.t;for(;--n>=0;)e[n]=0;for(n=0;n<t.t-1;++n){const s=t.am(n,t[n],e,2*n,0,1);(e[n+t.t]+=t.am(n+1,2*t[n],e,2*n+1,s,t.t-n-1))>=t.DV&&(e[n+t.t]-=t.DV,e[n+t.t+1]=1)}e.t>0&&(e[e.t-1]+=t.am(n,t[n],e,2*n,0,1)),e.s=0,e.clamp()}function Tn(e,t,n){const s=e.abs();if(s.t<=0)return;const i=this.abs();if(i.t<s.t){t?.fromInt(0),n!=null&&this.copyTo(n);return}n===null&&(n=I());const o=I(),a=this.s,r=e.s,c=this.DB-Fe(s[s.t-1]);c>0?(s.lShiftTo(c,o),i.lShiftTo(c,n)):(s.copyTo(o),i.copyTo(n));const l=o.t,u=o[l-1];if(u===0)return;const d=u*(1<<this.F1)+(l>1?o[l-2]>>this.F2:0),g=this.FV/d,f=(1<<this.F1)/d,p=1<<this.F2;let m=n.t,A=m-l;const E=t===null?I():t;for(o.dlShiftTo(A,E),n.compareTo(E)>=0&&(n[n.t++]=1,n.subTo(E,n)),h.ONE.dlShiftTo(l,E),E.subTo(o,o);o.t<l;)o[o.t++]=0;for(;--A>=0;){let N=n[--m]===u?this.DM:Math.floor(n[m]*g+(n[m-1]+p)*f);if((n[m]+=o.am(0,N,n,A,0,l))<N)for(o.dlShiftTo(A,E),n.subTo(E,n);n[m]<--N;)n.subTo(E,n)}t!==null&&(n.drShiftTo(l,t),a!==r&&h.ZERO.subTo(t,t)),n.t=l,n.clamp(),c>0&&n.rShiftTo(c,n),a<0&&h.ZERO.subTo(n,n)}function Cn(e){const t=I();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(h.ZERO)>0&&e.subTo(t,t),t}function wn(){if(this.t<1)return 0;const e=this[0];if((e&1)===0)return 0;let t=e&3;return t=t*(2-(e&15)*t)&15,t=t*(2-(e&255)*t)&255,t=t*(2-((e&65535)*t&65535))&65535,t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t}function Dn(e){return this.compareTo(e)===0}function Pn(e,t){let n=0,s=0;const i=Math.min(e.t,this.t);for(;n<i;)s+=this[n]+e[n],t[n++]=s&this.DM,s>>=this.DB;if(e.t<this.t){for(s+=e.s;n<this.t;)s+=this[n],t[n++]=s&this.DM,s>>=this.DB;s+=this.s}else{for(s+=this.s;n<e.t;)s+=e[n],t[n++]=s&this.DM,s>>=this.DB;s+=e.s}t.s=s<0?-1:0,s>0?t[n++]=s:s<-1&&(t[n++]=this.DV+s),t.t=n,t.clamp()}function vn(e){const t=I();return this.addTo(e,t),t}function Rn(e){const t=I();return this.subTo(e,t),t}function Nn(e){const t=I();return this.multiplyTo(e,t),t}function _n(e){const t=I();return this.divRemTo(e,t,null),t}function Y(e){this.m=e,this.mp=e.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function Fn(e){const t=I();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(h.ZERO)>0&&this.m.subTo(t,t),t}function Un(e){const t=I();return e.copyTo(t),this.reduce(t),t}function Mn(e){for(;e.t<=this.mt2;)e[e.t++]=0;for(let t=0;t<this.m.t;++t){let n=e[t]&32767;const s=n*this.mpl+((n*this.mph+(e[t]>>15)*this.mpl&this.um)<<15)&e.DM;for(n=t+this.m.t,e[n]+=this.m.am(0,s,e,t,0,this.m.t);e[n]>=e.DV;)e[n]-=e.DV,e[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function On(e,t){e.squareTo(t),this.reduce(t)}function bn(e,t,n){e.multiplyTo(t,n),this.reduce(n)}Y.prototype.convert=Fn;Y.prototype.revert=Un;Y.prototype.reduce=Mn;Y.prototype.mulTo=bn;Y.prototype.sqrTo=On;function Bn(e,t,n){let s=e.bitLength(),i,o=_e(1);const a=new Y(t);if(s<=0)return o;s<18?i=1:s<48?i=3:s<144?i=4:s<768?i=5:i=6;const r=[];let c=3;const l=i-1,u=(1<<i)-1;if(r[1]=a.convert(this),i>1){const E=I();for(a.sqrTo(r[1],E);c<=u;)r[c]=I(),a.mulTo(E,r[c-2],r[c]),c+=2}let d=e.t-1,g,f=!0,p=I(),m;for(s=Fe(e[d])-1;d>=0;){for(s>=l?g=e[d]>>s-l&u:(g=(e[d]&(1<<s+1)-1)<<l-s,d>0&&(g|=e[d-1]>>this.DB+s-l)),c=i;(g&1)===0;)g>>=1,--c;if((s-=c)<0&&(s+=this.DB,--d),f)r[g].copyTo(o),f=!1;else{for(;c>1;)a.sqrTo(o,p),a.sqrTo(p,o),c-=2;c>0?a.sqrTo(o,p):(m=o,o=p,p=m),a.mulTo(p,r[g],o)}for(;d>=0&&(e[d]&1<<s)===0;)a.sqrTo(o,p),m=o,o=p,p=m,--s<0&&(s=this.DB-1,--d)}const A=a.revert(o);return n(null,A),A}h.prototype.copyTo=an;h.prototype.fromInt=rn;h.prototype.fromString=cn;h.prototype.clamp=ln;h.prototype.dlShiftTo=pn;h.prototype.drShiftTo=Sn;h.prototype.lShiftTo=mn;h.prototype.rShiftTo=En;h.prototype.subTo=An;h.prototype.multiplyTo=yn;h.prototype.squareTo=In;h.prototype.divRemTo=Tn;h.prototype.invDigit=wn;h.prototype.addTo=Pn;h.prototype.toString=un;h.prototype.negate=hn;h.prototype.abs=dn;h.prototype.compareTo=gn;h.prototype.bitLength=fn;h.prototype.mod=Cn;h.prototype.equals=Dn;h.prototype.add=vn;h.prototype.subtract=Rn;h.prototype.multiply=Nn;h.prototype.divide=_n;h.prototype.modPow=Bn;h.ZERO=_e(0);h.ONE=_e(1);const xn=async({a:e,g:t,k:n,x:s,B:i,N:o,U:a})=>new Promise((r,c)=>{t.modPow(s,o,(l,u)=>{if(l){c(l);return}i.subtract(n.multiply(u)).modPow(e.add(a.multiply(s)),o,(d,g)=>{if(d){c(d);return}r(g.mod(o))})})}),kn="FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF6955817183995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7DB3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D2261AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200CBBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFCE0FD108E4B82D120A93AD2CAFFFFFFFFFFFFFFFF",ot={},Ae={};for(let e=0;e<256;e++){let t=e.toString(16).toLowerCase();t.length===1&&(t=`0${t}`),ot[e]=t,Ae[t]=e}const W=e=>{if(e.length%2!==0)throw new Error("Hex encoded strings must have an even number length");const t=new Uint8Array(e.length/2);for(let n=0;n<e.length;n+=2){const s=e.slice(n,n+2).toLowerCase();if(s in Ae)t[n/2]=Ae[s];else throw new Error(`Cannot decode unrecognized sequence ${s} as hexadecimal`)}return t},Ue=e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=ot[e[n]];return t},ye=e=>{const t=new ue;t.update(e);const n=t.digestSync(),s=Ue(n);return new Array(64-s.length).join("0")+s},le=e=>ye(W(e)),Hn=/^[89a-f]/i,_=e=>{if(!(e instanceof h))throw new Error("Not a BigInteger");const t=e.compareTo(h.ZERO)<0;let n=e.abs().toString(16);if(n=n.length%2!==0?`0${n}`:n,n=Hn.test(n)?`00${n}`:n,t){const s=n.split("").map(o=>{const a=~parseInt(o,16)&15;return"0123456789ABCDEF".charAt(a)}).join("");n=new h(s,16).add(h.ONE).toString(16),n.toUpperCase().startsWith("FF8")&&(n=n.substring(2))}return n},Ln=({A:e,B:t})=>{const n=new h(le(_(e)+_(t)),16);if(n.equals(h.ZERO))throw new Error("U cannot be zero.");return n},Wn=(e,t,n)=>{const s=new ue(t);s.update(e);const i=s.digestSync(),o=new ue(i);return o.update(n),o.digestSync().slice(0,16)},Me=e=>{const t=new Pe().random(e).toString();return W(t)},Vn=()=>ee.convert(Me(40));class Kn{constructor({userPoolName:t,a:n,g:s,A:i,N:o}){this.encoder=ce,this.userPoolName=t,this.a=n,this.g=s,this.A=i,this.N=o,this.k=new h(le(`${_(o)}${_(s)}`),16)}getRandomPassword(){if(!this.randomPassword)throw new C({name:"EmptyBigIntegerRandomPassword",message:"random password is empty"});return this.randomPassword}getSaltToHashDevices(){if(!this.saltToHashDevices)throw new C({name:"EmptyBigIntegersaltToHashDevices",message:"saltToHashDevices is empty"});return this.saltToHashDevices}getVerifierDevices(){if(!this.verifierDevices)throw new C({name:"EmptyBigIntegerVerifierDevices",message:"verifyDevices is empty"});return this.verifierDevices}async generateHashDevice(t,n){this.randomPassword=Vn();const s=`${t}${n}:${this.randomPassword}`,i=ye(s),o=Ue(Me(16));return this.saltToHashDevices=_(new h(o,16)),new Promise((a,r)=>{this.g.modPow(new h(le(this.saltToHashDevices+i),16),this.N,(c,l)=>{if(c){r(c);return}this.verifierDevices=_(l),a()})})}async getPasswordAuthenticationKey({username:t,password:n,serverBValue:s,salt:i}){if(s.mod(this.N).equals(h.ZERO))throw new Error("B cannot be zero.");const o=Ln({A:this.A,B:s}),a=`${this.userPoolName}${t}:${n}`,r=ye(a),c=new h(le(_(i)+r),16),l=await xn({a:this.a,g:this.g,k:this.k,x:c,B:s,N:this.N,U:o}),u=this.encoder.convert("Caldera Derived Key"),d=this.encoder.convert(""),g=new Uint8Array(u.byteLength+d.byteLength);return g.set(u,0),g.set(d,u.byteLength),Wn(W(_(l)),W(_(o)),g)}}const Gn=async({a:e,g:t,N:n})=>new Promise((s,i)=>{t.modPow(e,n,(o,a)=>{if(o){i(o);return}if(a.mod(n).equals(h.ZERO)){i(new Error("Illegal parameter. A mod N cannot be 0."));return}s(a)})}),pe=async e=>{const t=new h(kn,16),n=new h("2",16),s=jn(),i=await Gn({a:s,g:n,N:t});return new Kn({userPoolName:e,a:s,g:n,A:i,N:t})},jn=()=>{const e=Ue(Me(128));return new h(e,16)};async function J({userPoolId:e,userPoolEndpoint:t,newDeviceMetadata:n,accessToken:s}){if(!n)return;const i=e.split("_")[1]||"",o=await pe(i),a=n?.DeviceKey,r=n?.DeviceGroupKey;try{await o.generateHashDevice(r??"",a??"")}catch{return}const c={Salt:ee.convert(W(o.getSaltToHashDevices())),PasswordVerifier:ee.convert(W(o.getVerifierDevices()))},l=o.getRandomPassword();try{return await Xt({endpointResolver:P({endpointOverride:t})})({region:v(e)},{AccessToken:s,DeviceName:await Ot(),DeviceKey:n?.DeviceKey,DeviceSecretVerifierConfig:c}),{deviceKey:a,deviceGroupKey:r,randomPassword:l}}catch{return}}async function $n(e){const t=H.getConfig().Auth?.Cognito;x(t);const{username:n,signInSession:s,signInDetails:i,challengeName:o}=B.getState();if(o!=="WEB_AUTHN"||!n)throw new C({name:he.SignInException,message:"Unable to proceed due to invalid sign in state."});const{CREDENTIAL_REQUEST_OPTIONS:a}=e;Re(!!a,S.InvalidPasskeyAuthenticationOptions);const r=await zt(JSON.parse(a)),c=ge({endpointResolver:P({endpointOverride:t.userPoolEndpoint})}),{ChallengeName:l,ChallengeParameters:u,AuthenticationResult:d,Session:g}=await c({region:v(t.userPoolId),userAgentValue:V(K.ConfirmSignIn)},{ChallengeName:"WEB_AUTHN",ChallengeResponses:{USERNAME:n,CREDENTIAL:JSON.stringify(r)},ClientId:t.userPoolClientId,Session:s});if($({signInSession:g,username:n,challengeName:l,signInDetails:i}),d)return await G({...d,username:n,NewDeviceMetadata:await J({userPoolId:t.userPoolId,userPoolEndpoint:t.userPoolEndpoint,newDeviceMetadata:d.NewDeviceMetadata,accessToken:d.AccessToken}),signInDetails:i}),B.dispatch({type:"RESET_STATE"}),await j(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}};if(l==="WEB_AUTHN")throw new C({name:he.SignInException,message:"Sequential WEB_AUTHN challenges returned from underlying service cannot be handled."});return{challengeName:l,challengeParameters:u}}const qn=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Yn=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],it=()=>{const e=new Date,t=Yn[e.getUTCDay()],n=qn[e.getUTCMonth()],s=e.getUTCDate();let i=e.getUTCHours();i<10&&(i=`0${i}`);let o=e.getUTCMinutes();o<10&&(o=`0${o}`);let a=e.getUTCSeconds();a<10&&(a=`0${a}`);const r=e.getUTCFullYear();return`${t} ${n} ${s} ${i}:${o}:${a} UTC ${r}`},at=({userPoolName:e,username:t,challengeParameters:n,dateNow:s,hkdf:i})=>{const o=ce.convert(e),a=ce.convert(t),r=Jn(n.SECRET_BLOCK),c=ce.convert(s),l=new Uint8Array(o.byteLength+a.byteLength+r.byteLength+c.byteLength);l.set(o,0),l.set(a,o.byteLength),l.set(r,o.byteLength+a.byteLength),l.set(c,o.byteLength+a.byteLength+r.byteLength);const u=new ue(i);u.update(l);const d=u.digestSync();return ee.convert(d)},Jn=e=>{const t="=".repeat((4-e.length%4)%4),n=(e+t).replace(/-/g,"+").replace(/_/g,"/"),s=tt.convert(n),i=new Uint8Array(s.length);for(let o=0;o<s.length;++o)i[o]=s.charCodeAt(o);return i};async function Oe({username:e,config:t,clientMetadata:n,session:s,tokenOrchestrator:i}){const{userPoolId:o,userPoolEndpoint:a}=t,r=t.userPoolClientId,c=await i?.getDeviceMetadata(e);nt(c);const l=await pe(c.deviceGroupKey),u={USERNAME:e,SRP_A:l.A.toString(16),DEVICE_KEY:c.deviceKey},d={ChallengeName:"DEVICE_SRP_AUTH",ClientId:r,ChallengeResponses:u,ClientMetadata:n,Session:s},g=ge({endpointResolver:P({endpointOverride:a})}),{ChallengeParameters:f,Session:p}=await g({region:v(o)},d);return Zn(e,f,n,p,l,t,i)}async function Zn(e,t,n,s,i,{userPoolId:o,userPoolClientId:a,userPoolEndpoint:r},c){const l=await c?.getDeviceMetadata(e);nt(l);const u=new h(t?.SRP_B,16),d=new h(t?.SALT,16),{deviceKey:g}=l,{deviceGroupKey:f}=l,p=await i.getPasswordAuthenticationKey({username:l.deviceKey,password:l.randomPassword,serverBValue:u,salt:d}),m=it(),A={USERNAME:t?.USERNAME??e,PASSWORD_CLAIM_SECRET_BLOCK:t?.SECRET_BLOCK,TIMESTAMP:m,PASSWORD_CLAIM_SIGNATURE:at({username:g,userPoolName:f,challengeParameters:t,dateNow:m,hkdf:p}),DEVICE_KEY:g},E=L({username:e,userPoolId:o,userPoolClientId:a}),N={ChallengeName:"DEVICE_PASSWORD_VERIFIER",ClientId:a,ChallengeResponses:A,Session:s,ClientMetadata:n,UserContextData:E};return ge({endpointResolver:P({endpointOverride:r})})({region:v(o)},N)}async function rt(e,t,n,s,i,o,a){const{userPoolId:r,userPoolClientId:c,userPoolEndpoint:l}=o,u=r?.split("_")[1]||"",d=new h(t?.SRP_B,16),g=new h(t?.SALT,16),f=t?.USER_ID_FOR_SRP;if(!f)throw new C({name:"EmptyUserIdForSRPException",message:"USER_ID_FOR_SRP was not found in challengeParameters"});const p=await i.getPasswordAuthenticationKey({username:f,password:e,serverBValue:d,salt:g}),m=it(),A={USERNAME:f,PASSWORD_CLAIM_SECRET_BLOCK:t?.SECRET_BLOCK,TIMESTAMP:m,PASSWORD_CLAIM_SIGNATURE:at({username:f,userPoolName:u,challengeParameters:t,dateNow:m,hkdf:p})},E=await a.getDeviceMetadata(f);E&&E.deviceKey&&(A.DEVICE_KEY=E.deviceKey);const N=L({username:f,userPoolId:r,userPoolClientId:c}),z={ChallengeName:"PASSWORD_VERIFIER",ChallengeResponses:A,ClientMetadata:n,Session:s,ClientId:c,UserContextData:N},me=await ge({endpointResolver:P({endpointOverride:l})})({region:v(r)},z);return me.ChallengeName==="DEVICE_SRP_AUTH"?Oe({username:f,config:o,clientMetadata:n,session:me.Session,tokenOrchestrator:a}):me}async function Se(e,t,n,s){try{return await e(...t)}catch(i){if(i instanceof C&&i.name==="ResourceNotFoundException"&&i.message.includes("Device does not exist."))return await s.clearDeviceMetadata(n),e(...t);throw i}}function se(e){const{dispatch:t}=B;t({type:"SET_USERNAME",value:e})}async function ct({username:e,password:t,clientMetadata:n,config:s,tokenOrchestrator:i,authFlow:o,preferredChallenge:a}){const{userPoolId:r,userPoolClientId:c,userPoolEndpoint:l}=s,u=r?.split("_")[1]||"",d=await pe(u),g={USERNAME:e,SRP_A:d.A.toString(16)};o==="USER_AUTH"&&a&&(g.PREFERRED_CHALLENGE=a);const f=L({username:e,userPoolId:r,userPoolClientId:c}),p={AuthFlow:o,AuthParameters:g,ClientMetadata:n,ClientId:c,UserContextData:f},A=await te({endpointResolver:P({endpointOverride:l})})({region:v(r),userAgentValue:V(K.SignIn)},p),{ChallengeParameters:E,Session:N}=A,z=E?.USERNAME??e;return se(z),A.ChallengeName==="PASSWORD_VERIFIER"?Se(rt,[t,E,n,N,d,s,i],z,i):A}const Je="userAttributes.";function zn(e){return"isSignedIn"in e&&"nextStep"in e}async function Xn(e,t,n,s,i){const{userPoolClientId:o,userPoolId:a,userPoolEndpoint:r}=s,c={USERNAME:e,PASSWORD:t},l=await i.getDeviceMetadata(e);l&&l.deviceKey&&(c.DEVICE_KEY=l.deviceKey);const u=L({username:e,userPoolId:a,userPoolClientId:o}),d={AuthFlow:"USER_PASSWORD_AUTH",AuthParameters:c,ClientMetadata:n,ClientId:o,UserContextData:u},f=await te({endpointResolver:P({endpointOverride:r})})({region:v(a),userAgentValue:V(K.SignIn)},d),p=f.ChallengeParameters?.USERNAME??f.ChallengeParameters?.USER_ID_FOR_SRP??e;return se(p),f.ChallengeName==="DEVICE_SRP_AUTH"?Oe({username:p,config:s,clientMetadata:n,session:f.Session,tokenOrchestrator:i}):f}async function Qn(e,t,n,s,i){return ct({username:e,password:t,clientMetadata:n,config:s,tokenOrchestrator:i,authFlow:"USER_SRP_AUTH"})}async function es(e,t,n,s){const{userPoolClientId:i,userPoolId:o,userPoolEndpoint:a}=n,r={USERNAME:e},c=await s.getDeviceMetadata(e);c&&c.deviceKey&&(r.DEVICE_KEY=c.deviceKey);const l=L({username:e,userPoolId:o,userPoolClientId:i}),u={AuthFlow:"CUSTOM_AUTH",AuthParameters:r,ClientMetadata:t,ClientId:i,UserContextData:l},g=await te({endpointResolver:P({endpointOverride:a})})({region:v(o),userAgentValue:V(K.SignIn)},u),f=g.ChallengeParameters?.USERNAME??e;return se(f),g.ChallengeName==="DEVICE_SRP_AUTH"?Oe({username:f,config:n,clientMetadata:t,session:g.Session,tokenOrchestrator:s}):g}async function ts(e,t,n,s,i){x(s);const{userPoolId:o,userPoolClientId:a,userPoolEndpoint:r}=s,c=o?.split("_")[1]||"",l=await pe(c),u={USERNAME:e,SRP_A:l.A.toString(16),CHALLENGE_NAME:"SRP_A"},d=L({username:e,userPoolId:o,userPoolClientId:a}),g={AuthFlow:"CUSTOM_AUTH",AuthParameters:u,ClientMetadata:n,ClientId:a,UserContextData:d},f=te({endpointResolver:P({endpointOverride:r})}),{ChallengeParameters:p,Session:m}=await f({region:v(o),userAgentValue:V(K.SignIn)},g),A=p?.USERNAME??e;return se(A),Se(rt,[t,p,n,m,l,s,i],A,i)}async function Z(e){const{challengeName:t,challengeParameters:n,availableChallenges:s}=e,i=H.getConfig().Auth?.Cognito;switch(x(i),t){case"CUSTOM_CHALLENGE":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_CUSTOM_CHALLENGE",additionalInfo:n}};case"MFA_SETUP":{const{signInSession:o,username:a}=B.getState(),r=Ze(ze(n.MFAS_CAN_SETUP))||[],c=is(r),l=c.includes("TOTP"),u=c.includes("EMAIL");if(l&&u)return{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_MFA_SETUP_SELECTION",allowedMFATypes:c}};if(u)return{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_EMAIL_SETUP"}};if(l){const d=kt({endpointResolver:P({endpointOverride:i.userPoolEndpoint})}),{Session:g,SecretCode:f}=await d({region:v(i.userPoolId)},{Session:o});return B.dispatch({type:"SET_SIGN_IN_SESSION",value:g}),{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_TOTP_SETUP",totpSetupDetails:ns(f,a)}}}throw new C({name:he.SignInException,message:`Cannot initiate MFA setup from available types: ${r}`})}case"NEW_PASSWORD_REQUIRED":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_NEW_PASSWORD_REQUIRED",missingAttributes:ss(n.requiredAttributes)}};case"SELECT_MFA_TYPE":return{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_MFA_SELECTION",allowedMFATypes:Ze(ze(n.MFAS_CAN_CHOOSE))}};case"SMS_OTP":case"SMS_MFA":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_SMS_CODE",codeDeliveryDetails:{deliveryMedium:n.CODE_DELIVERY_DELIVERY_MEDIUM,destination:n.CODE_DELIVERY_DESTINATION}}};case"SOFTWARE_TOKEN_MFA":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_TOTP_CODE"}};case"EMAIL_OTP":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_EMAIL_CODE",codeDeliveryDetails:{deliveryMedium:n.CODE_DELIVERY_DELIVERY_MEDIUM,destination:n.CODE_DELIVERY_DESTINATION}}};case"WEB_AUTHN":{const o=await $n(n);return zn(o)?o:Z(o)}case"PASSWORD":case"PASSWORD_SRP":return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_IN_WITH_PASSWORD"}};case"SELECT_CHALLENGE":return{isSignedIn:!1,nextStep:{signInStep:"CONTINUE_SIGN_IN_WITH_FIRST_FACTOR_SELECTION",availableChallenges:s}}}throw new C({name:he.SignInException,message:`An error occurred during the sign in process. ${t} challengeName returned by the underlying service was not addressed.`})}function ns(e,t){return{sharedSecret:e,getSetupUri:(n,s)=>{const i=`otpauth://totp/${n}:${s??t}?secret=${e}&issuer=${n}`;return new At(i)}}}function oe(e){if(e===We.PasswordResetRequiredException)return{isSignedIn:!1,nextStep:{signInStep:"RESET_PASSWORD"}};if(e===We.UserNotConfirmedException)return{isSignedIn:!1,nextStep:{signInStep:"CONFIRM_SIGN_UP"}}}function ss(e){return e?JSON.parse(e).map(n=>n.includes(Je)?n.replace(Je,""):n):[]}function os(e){if(e==="SMS_MFA")return"SMS";if(e==="SOFTWARE_TOKEN_MFA")return"TOTP";if(e==="EMAIL_OTP")return"EMAIL"}function Ze(e){if(e)return e.map(os).filter(Boolean)}function ze(e){return e?JSON.parse(e):[]}function is(e){return e.filter(t=>t==="EMAIL"||t==="TOTP")}async function as(){let e;try{e=await et()}catch{}if(e&&e.userId&&e.username)throw new C({name:Et,message:"There is already a signed in user.",recoverySuggestion:"Call signOut before calling signIn again."})}function ie(e){return B.getState().username??e}async function rs(e){const t=H.getConfig().Auth?.Cognito;x(t);const{username:n,password:s,options:i}=e,o={loginId:n,authFlowType:"CUSTOM_WITHOUT_SRP"},a=i?.clientMetadata;w(!!n,D.EmptySignInUsername),w(!s,D.CustomAuthSignInPassword);try{const{ChallengeName:r,ChallengeParameters:c,AuthenticationResult:l,Session:u}=await Se(es,[n,a,t,b],n,b),d=ie(n);return $({signInSession:u,username:d,challengeName:r,signInDetails:o}),l?(await G({username:d,...l,NewDeviceMetadata:await J({userPoolId:t.userPoolId,userPoolEndpoint:t.userPoolEndpoint,newDeviceMetadata:l.NewDeviceMetadata,accessToken:l.AccessToken}),signInDetails:o}),R(),await j(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Z({challengeName:r,challengeParameters:c})}catch(r){R(),ne(r);const c=oe(r.name);if(c)return c;throw r}}async function cs(e){const{username:t,password:n,options:s}=e,i={loginId:t,authFlowType:"CUSTOM_WITH_SRP"},o=H.getConfig().Auth?.Cognito;x(o);const a=s?.clientMetadata;w(!!t,D.EmptySignInUsername),w(!!n,D.EmptySignInPassword);try{const{ChallengeName:r,ChallengeParameters:c,AuthenticationResult:l,Session:u}=await ts(t,n,a,o,b),d=ie(t);return $({signInSession:u,username:d,challengeName:r,signInDetails:i}),l?(await G({username:d,...l,NewDeviceMetadata:await J({userPoolId:o.userPoolId,userPoolEndpoint:o.userPoolEndpoint,newDeviceMetadata:l.NewDeviceMetadata,accessToken:l.AccessToken}),signInDetails:i}),R(),await j(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Z({challengeName:r,challengeParameters:c})}catch(r){R(),ne(r);const c=oe(r.name);if(c)return c;throw r}}async function Xe(e){const{username:t,password:n}=e,s=H.getConfig().Auth?.Cognito,i={loginId:t,authFlowType:"USER_SRP_AUTH"};x(s);const o=e.options?.clientMetadata;w(!!t,D.EmptySignInUsername),w(!!n,D.EmptySignInPassword);try{const{ChallengeName:a,ChallengeParameters:r,AuthenticationResult:c,Session:l}=await Qn(t,n,o,s,b),u=ie(t);return $({signInSession:l,username:u,challengeName:a,signInDetails:i}),c?(await G({username:u,...c,NewDeviceMetadata:await J({userPoolId:s.userPoolId,userPoolEndpoint:s.userPoolEndpoint,newDeviceMetadata:c.NewDeviceMetadata,accessToken:c.AccessToken}),signInDetails:i}),R(),await j(),k(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Z({challengeName:a,challengeParameters:r})}catch(a){R(),k(),ne(a);const r=oe(a.name);if(r)return r;throw a}}async function ls(e){const{username:t,password:n,options:s}=e,i=H.getConfig().Auth?.Cognito,o={loginId:t,authFlowType:"USER_PASSWORD_AUTH"};x(i);const a=s?.clientMetadata;w(!!t,D.EmptySignInUsername),w(!!n,D.EmptySignInPassword);try{const{ChallengeName:r,ChallengeParameters:c,AuthenticationResult:l,Session:u}=await Se(Xn,[t,n,a,i,b],t,b),d=ie(t);return $({signInSession:u,username:d,challengeName:r,signInDetails:o}),l?(await G({...l,username:d,NewDeviceMetadata:await J({userPoolId:i.userPoolId,userPoolEndpoint:i.userPoolEndpoint,newDeviceMetadata:l.NewDeviceMetadata,accessToken:l.AccessToken}),signInDetails:o}),R(),await j(),k(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Z({challengeName:r,challengeParameters:c})}catch(r){R(),k(),ne(r);const c=oe(r.name);if(c)return c;throw r}}async function us({username:e,clientMetadata:t,config:n,tokenOrchestrator:s,preferredChallenge:i,password:o,session:a}){const{userPoolId:r,userPoolClientId:c,userPoolEndpoint:l}=n,u=L({username:e,userPoolId:r,userPoolClientId:c}),d={USERNAME:e};if(i){if(i==="PASSWORD_SRP")return w(!!o,D.EmptySignInPassword),ct({username:e,password:o,clientMetadata:t,config:n,tokenOrchestrator:s,authFlow:"USER_AUTH",preferredChallenge:i});i==="PASSWORD"&&(w(!!o,D.EmptySignInPassword),d.PASSWORD=o),d.PREFERRED_CHALLENGE=i}const g={AuthFlow:"USER_AUTH",AuthParameters:d,ClientMetadata:t,ClientId:c,UserContextData:u};a&&(g.Session=a);const p=await te({endpointResolver:P({endpointOverride:l})})({region:v(r),userAgentValue:V(K.SignIn)},g);return se(e),p}async function hs(e){const{username:t,password:n,options:s}=e,i=H.getConfig().Auth?.Cognito,o={loginId:t,authFlowType:"USER_AUTH"};x(i);const a=s?.clientMetadata,r=s?.preferredChallenge;w(!!t,D.EmptySignInUsername);try{const c={username:t,config:i,tokenOrchestrator:b,clientMetadata:a,preferredChallenge:r,password:n},l=Ut.getState();l.active&&l.username===t&&(c.session=l.session);const u=await us(c),d=ie(t);return $({signInSession:u.Session,username:d,challengeName:u.ChallengeName,signInDetails:o}),u.AuthenticationResult?(await G({username:d,...u.AuthenticationResult,NewDeviceMetadata:await J({userPoolId:i.userPoolId,userPoolEndpoint:i.userPoolEndpoint,newDeviceMetadata:u.AuthenticationResult.NewDeviceMetadata,accessToken:u.AuthenticationResult.AccessToken}),signInDetails:o}),R(),await j(),k(),{isSignedIn:!0,nextStep:{signInStep:"DONE"}}):Z({challengeName:u.ChallengeName,challengeParameters:u.ChallengeParameters,availableChallenges:"AvailableChallenges"in u?u.AvailableChallenges:void 0})}catch(c){R(),k(),ne(c);const l=oe(c.name);if(l)return l;throw c}}async function ds(e){k(!1);const t=e.options?.authFlowType;switch(await as(),t){case"USER_SRP_AUTH":return Xe(e);case"USER_PASSWORD_AUTH":return ls(e);case"CUSTOM_WITHOUT_SRP":return rs(e);case"CUSTOM_WITH_SRP":return cs(e);case"USER_AUTH":return hs(e);default:return Xe(e)}}const gs=Mt({email:Ve().min(1,{message:"Please enter your email"}).email({message:"Invalid email address"}),password:Ve().min(1,{message:"Please enter your password"}).min(7,{message:"Password must be at least 7 characters long"})});function Cs({className:e,...t}){const[n,s]=yt.useState(!1),i=It(),o=Tt({from:"/(auth)/sign-in"}),{checkAuthStatus:a}=Ct(l=>l.auth),r=vt({resolver:Rt(gs),defaultValues:{email:"",password:""}});async function c(l){s(!0);try{await ds({username:l.email,password:l.password}),await a(),X.success("Successfully signed in!"),i({to:o.redirect||"/"})}catch(u){const d=u;d.name==="UserNotConfirmedException"?(X.error("Please confirm your email before signing in"),i({to:"/otp",search:{email:l.email}})):d.name==="NotAuthorizedException"?X.error("Invalid email or password"):d.name==="UserNotFoundException"?X.error("User not found"):X.error(d.message||"Failed to sign in")}finally{s(!1)}}return y.jsx(Nt,{...r,children:y.jsxs("form",{onSubmit:r.handleSubmit(c),className:wt("grid gap-3",e),...t,children:[y.jsx(Be,{control:r.control,name:"email",render:({field:l})=>y.jsxs(xe,{children:[y.jsx(ke,{children:"Email"}),y.jsx(He,{children:y.jsx(_t,{placeholder:"name@example.com",...l})}),y.jsx(Le,{})]})}),y.jsx(Be,{control:r.control,name:"password",render:({field:l})=>y.jsxs(xe,{className:"relative",children:[y.jsx(ke,{children:"Password"}),y.jsx(He,{children:y.jsx(Ft,{placeholder:"********",...l})}),y.jsx(Le,{}),y.jsx(Dt,{to:"/forgot-password",className:"text-muted-foreground absolute -top-0.5 right-0 text-sm font-medium hover:opacity-75",children:"Forgot password?"})]})}),y.jsx(Pt,{className:"mt-2",disabled:n,children:n?"Signing in...":"Login"})]})})}export{Cs as U};
